---
uuid: 48f4517f-7767-4711-80e6-46364b0878f3
created_at: '2025-10-16T23:25:39Z'
title: 2025.10.16.23.25.39
filename: 2025.10.16.23.25.39
description: DocOps summary for 2025.10.16.23.25.39
tags:
  - 2025.10.16.23.25.39
  - docops
  - autogenerated
related_to_uuid: []
related_to_title: []
references: []
---
{# I. Summary

A. I traced the `kanban search` subcommand to `packages/kanban/src/cli/command-handlers.ts` where it’s registered as `search` and mapped to `handleSearch`.
B. `handleSearch` loads the current board and calls `searchTasks(board, term)` from `packages/kanban/src/lib/kanban.ts`.
C. The search returns two lists: `exact` (title/content substring match) and `similar` (token-overlap score across title, content, and labels), capped to 20.
D. It **does not** use the JSONL index or the task-cache; it searches whatever the in-memory board loaded, which means **content matches only work when tasks were loaded from files** (or after regenerate/sync).
E. Docs that show flags like `--status`/`--priority` for `search` are out-of-date; the current CLI only takes a **single search term**.

# II. Analysis

A. Risk: If your board is built from the Markdown board file (checkbox list), task `content` isn’t present (parser sets `content: ''`), so “content search” becomes “title search”.
B. Risk: Recommendation doc (`docs/agile/recommendations/*`) suggests `--status`/`--priority` flags that `kanban search` doesn’t implement—users may rely on nonexistent options.
C. Tradeoff: Using the simple in-memory scan keeps `search` fast and dependency-free, but it duplicates logic vs. the directory adapter/cache which already have a richer search pipeline.
D. Unknown: Whether you want `kanban search` to delegate to the indexed/cache search (faster, richer) or keep it pure board-based (WYSIWYG to current board).
E. Improvement: Normalize labels in similarity scoring (hyphenated labels like `bug-fix` won’t match “bug fix” tokens right now).
F. Improvement: Expose `--fields` / `--limit` / `--column` filters at the CLI layer, consistent with adapter options.
G. Process: We should align help text with actual behavior and add a runbook snippet to avoid confusion.

# III. Decisions

A. Treat `kanban search` as **board-scoped** search (current behavior), and document how to get file-content search (regenerate/sync).
B. Propose a follow-on task to add **optional** index/cache-backed search mode (e.g., `kanban search --mode=cache`), preserving current default.
C. Update the docs/help to remove unsupported flags and add concrete usage examples.

# IV. Artifacts

A. **How it works (short):**

* **Entry:** `packages/kanban/src/cli/command-handlers.ts` → `handleSearch` (registered as `search`).
* **Config:** Paths come from `loadKanbanConfig` (`--board-file`, `--tasks-dir`, envs like `KANBAN_BOARD_FILE`, `KANBAN_TASKS_DIR`).
* **Core:** `packages/kanban/src/lib/kanban.ts` → `searchTasks(board, term)`

  * Exact: `title.includes(term)` or `content.includes(term)` (case-insensitive).
  * Similar: tokenize(term) vs. bag(tokenize(title) ∪ tokenize(content) ∪ labels), sort by score desc, top 20.
* **Output:** One JSON object (JSONL) with `{ exact: Task[], similar: Task[] }`.

**Usage examples (today):**

```bash
# 1) Using env for config
KANBAN_BOARD_FILE=docs/agile/boards/generated.md \
KANBAN_TASKS_DIR=docs/agile/tasks \
kanban search "login timeout"

# 2) Using flags (modern names)
kanban --board-file docs/agile/boards/generated.md \
       --tasks-dir docs/agile/tasks \
       search "login timeout"
```

**Sample output shape:**

```json
{
  "exact": [
    {"uuid":"...","title":"Investigate login timeout","status":"In Progress","labels":["auth","bug"], "content":"..."}
  ],
  "similar": [
    {"uuid":"...","title":"Session keepalive policy","status":"Ready","labels":["auth"], "content":"..."}
  ]
}
```

**Pro tips to make content search actually work:**

* If your board file has the tasks (checkbox list), `content` is empty → run one of:

  * `kanban regenerate` (rebuild board from task files, which *do* include content)
  * or `kanban sync` (pull file data then push board; keeps things aligned)

**Related commands present but not used by `search`:**

* `indexForSearch` builds a JSONL task index; `search` does **not** read it.
* Directory adapter (`packages/kanban/src/lib/directory-adapter/adapter.ts`) has `searchTaskFiles(query, {fields, limit})` and cache support; currently used by UI/adapter workflows, not the CLI `search`.

# V. Actions

1. **Create Task**

   * `title:` Align CLI search behavior and docs
   * `tags:` ["kanban", "cli", "docs", "search"]
   * `priority:` P1
   * `complexity:` M
   * `urgency:` Now

2. **Review Task Transition**

   * `title:` “Align CLI search behavior and docs”
   * `current_status:` Ready
   * `valid_transitions:` ["Ready→In-Progress", "Ready→Blocked"]
   * `desired_transition:` Ready→In-Progress
   * `rationale:` We have clear scope (doc fix + help text + examples) and no WIP breach (<=3). This unblocks confused users immediately.

3. **Produce Documentation Artifact**

   * `type:` Runbook
   * `title:` “Search: board-scoped vs. file-scoped”
   * `rationale:` Remove ambiguity and show correct steps for content search.
   * `abstract:` One-page guide covering `kanban search` behavior, when `content` is present, and how to use `regenerate`/`sync` to enable full-text content search. Includes env/flag matrix and JSONL output example.

4. Start a **Spec** task: `Add --mode=(board|cache), --fields, --limit to kanban search`. Scope: wire to directory adapter when `--mode=cache`, default remains `board`.

5. Board triage: Update `HELP_TEXT` in `packages/kanban/src/cli.ts` to (a) remove unsupported flags shown in external docs, (b) add a one-liner noting “search scans current board; run regenerate/sync for file contents.”

6. Evaluate label normalization: Update similarity scoring to tokenize labels (hyphen/underscore handling) to improve recall (“bug-fix” vs “bug fix”).

7. Run checks (dev-only plan): `pnpm -w -r build && pnpm -w -r test` and surface any regressions in CLI output formatting for `printJSONL`.

8. Process improvement: Add a pre-merge **docs consistency check** ensuring examples in `/docs/agile/**/*` match actual CLI flags (simple grep/test harness).

---

If you want, I can also drop a minimal “quick start” in your repo’s docs with the exact env/flag combos you use locally.
