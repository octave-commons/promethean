---
uuid: a71ab2e1-0a26-45ac-bd43-488f6f766d52
created_at: per-domain-policy-system-for-js-crawler.md
filename: per-domain-policy-system-for-js-crawler
title: per-domain-policy-system-for-js-crawler
description: >-
  A YAML-based policy system for configuring JS crawlers with per-domain rules,
  throttling, authentication, and resource handling without Python or SaaS
  dependencies.
tags:
  - yaml
  - crawler
  - policy
  - throttling
  - authentication
  - resource-handling
  - domain-specific
  - extraction
related_to_uuid:
  - bd4f0976-0d5b-47f6-a20a-0601d1842dc1
  - 4330e8f0-5f46-4235-918b-39b6b93fa561
  - 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
  - 5020e892-8f18-443a-b707-6d0f3efcfe22
  - 30ec3ba6-fbca-4606-ac3e-89b747fbeb7c
  - 54382370-1931-4a19-a634-46735708a9ea
  - d8059b6a-c1ec-487d-8e0b-3ce33d6b4d06
  - f7702bf8-f7db-473c-9a5b-8dbf66ad3b9e
  - 5e8b2388-022b-46cf-952c-36ae9b8f0037
  - 938eca9c-97e2-4bcc-8653-b0ef1a5ac7a3
  - 7cfc230d-8ec2-4cdb-b931-8aec26de2a00
  - 5e408692-0e74-400e-a617-84247c7353ad
  - 71726f04-eb1c-42a5-a5fe-d8209de6e159
  - 73d3dbf6-9240-46fd-ada9-cc2e7e00dc5f
  - b09141b7-544f-4c8e-8f49-bf76cecaacbb
  - 0f6f8f38-98d0-438f-9601-58f478acc0b7
  - 10d98225-12e0-4212-8e15-88b57cf7bee5
  - 13951643-1741-46bb-89dc-1beebb122633
  - 18344cf9-0c49-4a71-b6c8-b8d84d660fca
  - 78eeedf7-75bc-4692-a5a7-bb6857270621
  - 7b7ca860-780c-44fa-8d3f-be8bd9496fba
  - 62bec6f0-4e13-4f38-aca4-72c84ba02367
  - ffb9b2a9-744d-4a53-9565-130fceae0832
  - ae24a280-678e-4c0b-8cc4-56667fa04172
  - 1d3d6c3a-039e-4b96-93c1-95854945e248
related_to_title:
  - Prompt_Folder_Bootstrap
  - Stateful Partitions and Rebalancing
  - eidolon-field-math-foundations
  - Chroma Toolkit Consolidation Plan
  - Unique Info Dump Index
  - Migrate to Provider-Tenant Architecture
  - schema-evolution-workflow
  - Dynamic Context Model for Web Components
  - Eidolon Field Abstract Model
  - eidolon-node-lifecycle
  - field-dynamics-math-blocks
  - i3-bluetooth-setup
  - Duck's Self-Referential Perceptual Loop
  - Debugging Broker Connections and Agent Behavior
  - field-interaction-equations
  - windows-tiling-with-autohotkey
  - Creative Moments
  - Duck's Attractor States
  - Promethean Chat Activity Report
  - typed-struct-compiler
  - TypeScript Patch for Tool Calling Support
  - zero-copy-snapshots-and-workers
  - obsidian-ignore-node-modules-regex
  - Promethean-Copilot-Intent-Engine
  - Obsidian ChatGPT Plugin Integration Guide
references:
  - uuid: ac9d3ac5-9a6a-4180-a67f-1ab7e229d981
    line: 483
    col: 0
    score: 1
  - uuid: 4330e8f0-5f46-4235-918b-39b6b93fa561
    line: 1321
    col: 0
    score: 1
  - uuid: c3cd4f65-2bb3-4fca-a32e-2ac667e03f40
    line: 561
    col: 0
    score: 1
  - uuid: ba11486b-b0b0-4d9d-a0d1-1d91ae34de55
    line: 522
    col: 0
    score: 1
  - uuid: 78eeedf7-75bc-4692-a5a7-bb6857270621
    line: 1015
    col: 0
    score: 1
  - uuid: 7b7ca860-780c-44fa-8d3f-be8bd9496fba
    line: 1228
    col: 0
    score: 1
  - uuid: ed6f3fc9-5eb1-482c-8b3c-f0abc5aff2a2
    line: 173
    col: 0
    score: 1
  - uuid: 62bec6f0-4e13-4f38-aca4-72c84ba02367
    line: 1057
    col: 0
    score: 1
  - uuid: 1b1338fc-bb4d-41df-828f-e219cc9442eb
    line: 513
    col: 0
    score: 1
  - uuid: bb7f0835-c347-474f-bfad-eabd873b51ad
    line: 618
    col: 0
    score: 1
  - uuid: 930054b3-ba95-4acf-bb92-0e3ead25ed0b
    line: 187
    col: 0
    score: 1
  - uuid: 5020e892-8f18-443a-b707-6d0f3efcfe22
    line: 999
    col: 0
    score: 1
  - uuid: 78eeedf7-75bc-4692-a5a7-bb6857270621
    line: 1016
    col: 0
    score: 1
  - uuid: ed6f3fc9-5eb1-482c-8b3c-f0abc5aff2a2
    line: 175
    col: 0
    score: 1
  - uuid: 30ec3ba6-fbca-4606-ac3e-89b747fbeb7c
    line: 1221
    col: 0
    score: 1
  - uuid: 62bec6f0-4e13-4f38-aca4-72c84ba02367
    line: 1058
    col: 0
    score: 1
  - uuid: 1b1338fc-bb4d-41df-828f-e219cc9442eb
    line: 515
    col: 0
    score: 1
  - uuid: 10d98225-12e0-4212-8e15-88b57cf7bee5
    line: 251
    col: 0
    score: 1
  - uuid: 13951643-1741-46bb-89dc-1beebb122633
    line: 559
    col: 0
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 1033
    col: 0
    score: 1
  - uuid: cdbd21ee-25a0-4bfa-884c-c1b948e9b0b2
    line: 55
    col: 0
    score: 1
  - uuid: 2792d448-c3b5-4050-93dd-93768529d99c
    line: 89
    col: 0
    score: 1
  - uuid: 71726f04-eb1c-42a5-a5fe-d8209de6e159
    line: 110
    col: 0
    score: 1
  - uuid: f7702bf8-f7db-473c-9a5b-8dbf66ad3b9e
    line: 477
    col: 0
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 215
    col: 0
    score: 1
  - uuid: 938eca9c-97e2-4bcc-8653-b0ef1a5ac7a3
    line: 127
    col: 0
    score: 1
  - uuid: a4d90289-798d-44a0-a8e8-a055ae12fb52
    line: 224
    col: 0
    score: 1
  - uuid: 7cfc230d-8ec2-4cdb-b931-8aec26de2a00
    line: 233
    col: 0
    score: 1
  - uuid: 10d98225-12e0-4212-8e15-88b57cf7bee5
    line: 53
    col: 0
    score: 1
  - uuid: d144aa62-348c-4e5d-ae8f-38084c67ceca
    line: 209
    col: 0
    score: 1
  - uuid: 1d3d6c3a-039e-4b96-93c1-95854945e248
    line: 137
    col: 0
    score: 1
  - uuid: ca8e1399-77bf-4f77-82a3-3f703b68706d
    line: 138
    col: 0
    score: 1
  - uuid: b39dc9d4-63e2-42d4-bbcd-041ef3167bca
    line: 207
    col: 0
    score: 1
  - uuid: e2135d9f-c69d-47ee-9b17-0b05e98dc748
    line: 59
    col: 0
    score: 1
  - uuid: b22d79c6-825b-4cd3-b0d3-1cef0532bb54
    line: 1100
    col: 0
    score: 1
  - uuid: 9c79206d-4cb9-4f00-87e0-782dcea37bc7
    line: 230
    col: 0
    score: 1
  - uuid: 6bcff92c-4224-453d-9993-1be8d37d47c3
    line: 125
    col: 0
    score: 1
  - uuid: 18344cf9-0c49-4a71-b6c8-b8d84d660fca
    line: 147
    col: 0
    score: 1
  - uuid: 10d98225-12e0-4212-8e15-88b57cf7bee5
    line: 47
    col: 0
    score: 1
  - uuid: 73d3dbf6-9240-46fd-ada9-cc2e7e00dc5f
    line: 105
    col: 0
    score: 1
  - uuid: cdbd21ee-25a0-4bfa-884c-c1b948e9b0b2
    line: 97
    col: 0
    score: 1
  - uuid: 2792d448-c3b5-4050-93dd-93768529d99c
    line: 128
    col: 0
    score: 1
  - uuid: e979c50f-69bb-48b0-8417-e1ee1b31c0c0
    line: 31
    col: 0
    score: 1
  - uuid: 13951643-1741-46bb-89dc-1beebb122633
    line: 90
    col: 0
    score: 1
  - uuid: 71726f04-eb1c-42a5-a5fe-d8209de6e159
    line: 33
    col: 0
    score: 1
  - uuid: f7702bf8-f7db-473c-9a5b-8dbf66ad3b9e
    line: 462
    col: 0
    score: 1
  - uuid: 10d98225-12e0-4212-8e15-88b57cf7bee5
    line: 28
    col: 0
    score: 1
  - uuid: cdbd21ee-25a0-4bfa-884c-c1b948e9b0b2
    line: 65
    col: 0
    score: 1
  - uuid: 2792d448-c3b5-4050-93dd-93768529d99c
    line: 86
    col: 0
    score: 1
  - uuid: 71726f04-eb1c-42a5-a5fe-d8209de6e159
    line: 34
    col: 0
    score: 1
  - uuid: f7702bf8-f7db-473c-9a5b-8dbf66ad3b9e
    line: 442
    col: 0
    score: 1
  - uuid: 5e8b2388-022b-46cf-952c-36ae9b8f0037
    line: 218
    col: 0
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 176
    col: 0
    score: 1
  - uuid: 938eca9c-97e2-4bcc-8653-b0ef1a5ac7a3
    line: 70
    col: 0
    score: 1
  - uuid: 13951643-1741-46bb-89dc-1beebb122633
    line: 123
    col: 0
    score: 1
  - uuid: f7702bf8-f7db-473c-9a5b-8dbf66ad3b9e
    line: 412
    col: 0
    score: 1
  - uuid: 5e8b2388-022b-46cf-952c-36ae9b8f0037
    line: 261
    col: 0
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 181
    col: 0
    score: 1
  - uuid: 938eca9c-97e2-4bcc-8653-b0ef1a5ac7a3
    line: 90
    col: 0
    score: 1
  - uuid: a4d90289-798d-44a0-a8e8-a055ae12fb52
    line: 157
    col: 0
    score: 1
  - uuid: 7cfc230d-8ec2-4cdb-b931-8aec26de2a00
    line: 205
    col: 0
    score: 1
  - uuid: b09141b7-544f-4c8e-8f49-bf76cecaacbb
    line: 149
    col: 0
    score: 1
  - uuid: 1f32c94a-4da4-4266-8ac0-6c282cfb401f
    line: 110
    col: 0
    score: 1
  - uuid: 22b989d5-f4aa-4880-8632-709c21830f83
    line: 203
    col: 0
    score: 1
  - uuid: e9b27b06-f608-4734-ae6c-f03a8b1fcf5f
    line: 95
    col: 0
    score: 1
  - uuid: 7b7ca860-780c-44fa-8d3f-be8bd9496fba
    line: 541
    col: 0
    score: 1
  - uuid: 62bec6f0-4e13-4f38-aca4-72c84ba02367
    line: 375
    col: 0
    score: 1
  - uuid: 71726f04-eb1c-42a5-a5fe-d8209de6e159
    line: 78
    col: 0
    score: 1
  - uuid: a4d90289-798d-44a0-a8e8-a055ae12fb52
    line: 176
    col: 0
    score: 1
  - uuid: 1f32c94a-4da4-4266-8ac0-6c282cfb401f
    line: 154
    col: 0
    score: 1
  - uuid: 22b989d5-f4aa-4880-8632-709c21830f83
    line: 175
    col: 0
    score: 1
  - uuid: e9b27b06-f608-4734-ae6c-f03a8b1fcf5f
    line: 123
    col: 0
    score: 1
  - uuid: fc21f824-4244-4030-a48e-c4170160ea1d
    line: 274
    col: 0
    score: 1
  - uuid: a4a25141-6380-40b9-9cd7-b554b246b303
    line: 327
    col: 0
    score: 1
  - uuid: 6620e2f2-de6d-45d8-a722-5d26e160b370
    line: 412
    col: 0
    score: 1
  - uuid: dd00677a-2280-45a7-91af-0728b21af3ad
    line: 159
    col: 0
    score: 1
  - uuid: 291c7d91-da8c-486c-9bc0-bd2254536e2d
    line: 95
    col: 0
    score: 1
  - uuid: 10d98225-12e0-4212-8e15-88b57cf7bee5
    line: 33
    col: 0
    score: 1
  - uuid: 73d3dbf6-9240-46fd-ada9-cc2e7e00dc5f
    line: 99
    col: 0
    score: 1
  - uuid: 2792d448-c3b5-4050-93dd-93768529d99c
    line: 46
    col: 0
    score: 1
  - uuid: e979c50f-69bb-48b0-8417-e1ee1b31c0c0
    line: 10
    col: 0
    score: 1
  - uuid: 10d98225-12e0-4212-8e15-88b57cf7bee5
    line: 8
    col: 0
    score: 1
  - uuid: 73d3dbf6-9240-46fd-ada9-cc2e7e00dc5f
    line: 38
    col: 0
    score: 1
  - uuid: cdbd21ee-25a0-4bfa-884c-c1b948e9b0b2
    line: 56
    col: 0
    score: 1
  - uuid: 10d98225-12e0-4212-8e15-88b57cf7bee5
    line: 38
    col: 0
    score: 1
  - uuid: cdbd21ee-25a0-4bfa-884c-c1b948e9b0b2
    line: 51
    col: 0
    score: 1
  - uuid: 2792d448-c3b5-4050-93dd-93768529d99c
    line: 79
    col: 0
    score: 1
  - uuid: e979c50f-69bb-48b0-8417-e1ee1b31c0c0
    line: 77
    col: 0
    score: 1
  - uuid: 13951643-1741-46bb-89dc-1beebb122633
    line: 115
    col: 0
    score: 1
  - uuid: 71726f04-eb1c-42a5-a5fe-d8209de6e159
    line: 61
    col: 0
    score: 1
  - uuid: 5e8b2388-022b-46cf-952c-36ae9b8f0037
    line: 212
    col: 0
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 150
    col: 0
    score: 1
  - uuid: 10d98225-12e0-4212-8e15-88b57cf7bee5
    line: 94
    col: 0
    score: 1
  - uuid: 73d3dbf6-9240-46fd-ada9-cc2e7e00dc5f
    line: 63
    col: 0
    score: 1
  - uuid: cdbd21ee-25a0-4bfa-884c-c1b948e9b0b2
    line: 66
    col: 0
    score: 1
  - uuid: e979c50f-69bb-48b0-8417-e1ee1b31c0c0
    line: 93
    col: 0
    score: 1
  - uuid: 71726f04-eb1c-42a5-a5fe-d8209de6e159
    line: 73
    col: 0
    score: 1
  - uuid: f7702bf8-f7db-473c-9a5b-8dbf66ad3b9e
    line: 403
    col: 0
    score: 1
  - uuid: 6620e2f2-de6d-45d8-a722-5d26e160b370
    line: 371
    col: 0
    score: 1
  - uuid: dd00677a-2280-45a7-91af-0728b21af3ad
    line: 141
    col: 0
    score: 1
---
Roger. Here’s a clean **per-domain policy system** wired into your JS crawler — no Python, no SaaS. You get a single YAML file to tune throttles, allow/deny rules, login steps, headers/cookies, extraction rules, proxy overrides (e.g., Tor via Privoxy), and per-domain limits. Drop these files in, set one env var, and go. ^ref-c03020e1-1-0

---

## 0) Compose tweak (point crawler at policies file)

Add one env var + mount (keeps your code immutable): ^ref-c03020e1-7-0

```yaml
  crawler-js:
    # ...
    environment:
      - POLICY_FILE=/workspace/policies.yaml
      # rest unchanged (PROXY_URL still works as global default)
    volumes:
      - ./infra/crawler-js:/workspace:rw
      - crawl_data:/data
      - crawl_storage:/workspace/storage
```
^ref-c03020e1-9-0 ^ref-c03020e1-20-0

---

## 1) Policy file (YAML)

`infra/crawler-js/policies.yaml` ^ref-c03020e1-26-0
 ^ref-c03020e1-27-0
```yaml
# Global defaults (used when no domain match)
defaults:
  sameDomainOnly: true
  respectRobots: true
  concurrency: 4          # per crawler (we still cap globally)
  rpm: 120                # requests per minute cap
  maxPages: 200           # global cap (crawler’s maxRequestsPerCrawl)
  maxDepth: 3             # link hop depth (0 = only seed)
  delayMs: 250            # base delay between requests
  jitterMs: 200           # random +/- added to delay
  retries: 2              # per-request retries
  dedupNormalize: true
  sitemapDiscover: true
  rssDiscover: true
  blockResources: ["image", "media", "font", "stylesheet"]  # save bandwidth
  allow: []              # regex list (case-insensitive); empty = allow all
  deny: []               # regex list; any match = block
  headers:               # sent on every request for matching domains
    Accept-Language: "en-US,en;q=0.9"
  cookies: []            # [{ name, value, domain, path, httpOnly, secure }]
  proxy: ""              # override (e.g.,  Empty = use PROXY_URL env.
  extractor:
    mode: "article"      # 'article' | 'simple' | 'raw'
    keepHtml: false

# Domain-specific overrides (first match wins). domains: list of host globs or regex.
domains:

  - name: "Hacker News"
    domains: ["news.ycombinator.com"]
    sameDomainOnly: true
    rpm: 60
    concurrency: 2
    maxPages: 500
    allow: ["^
    deny: ["\\.gif$", "\\.png$", "\\.jpg$"]
    extractor:
      mode: "simple"
      keepHtml: false

  - name: "Example Blog with login"
    domains: ["blog.example.com", "/^sub\\d+\\.example\\.com$/"]
    rpm: 30
    concurrency: 2
    maxDepth: 2
    proxy: "         # force Tor just for this domain
    headers:
      User-Agent: "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome Safari"
    cookies:
      - name: "cookie_consent"
        value: "yes"
        domain: ".example.com"
        path: "/"
        httpOnly: false
        secure: false
    login:                                # run once per origin before crawling links
      steps:
        - goto: "
        - type: { selector: "input[name='username']", text: "local_user" }
        - type: { selector: "input[name='password']", text: "local_pass" }
        - click: { selector: "button[type='submit']" }
        - waitForSelector: { selector: "nav .user-avatar", timeoutMs: 15000 }
    extractor:
      mode: "article"
      keepHtml: false

  - name: "Docs site (HTML only, no JS)"
    domains: ["docs.example.org"]
    blockResources: ["*"]  # block all non-doc requests
    sitemapDiscover: true
    rssDiscover: false
    extractor:
      mode: "raw"
      keepHtml: true

# Optional: explicit seeds (in addition to CRAWL_SEED env)
seeds:
  - "
  - "
^ref-c03020e1-27-0
``` ^ref-c03020e1-109-0

**How matching works:** `domains[].domains` accepts either host globs (e.g., `*.example.com`) or regex strings delimited with `/.../`. First match wins.

---

## 2) Add a tiny YAML dep ^ref-c03020e1-115-0

`infra/crawler-js/package.json` — add `yaml` ^ref-c03020e1-117-0

```json
{
  "name": "crawler-js",
  "private": true,
  "type": "module",
  "scripts": { "start": "node src/crawl.js" },
  "dependencies": {
    "crawlee": "^3.9.2",
    "playwright": "^1.47.2",
    "robots-parser": "^3.0.1",
    "node-fetch": "^3.3.2",
    "fast-xml-parser": "^4.5.0",
    "p-limit": "^6.2.0",
    "yaml": "^2.5.1"
  }
^ref-c03020e1-117-0
}
```

---

## 3) Wire policies into the crawler
 ^ref-c03020e1-141-0
### `infra/crawler-js/src/utils.js` (additions)

```js
import fs from 'node:fs';
import path from 'node:path';
import YAML from 'yaml';

export function loadPolicies(filePath) {
  const p = filePath || process.env.POLICY_FILE || '/workspace/policies.yaml';
  const raw = fs.readFileSync(p, 'utf8');
  const cfg = YAML.parse(raw);
  cfg.defaults ||= {};
  cfg.domains ||= [];
  cfg.seeds ||= [];
  // preprocess domain matchers
  for (const d of cfg.domains) {
    d._matchers = (d.domains || []).map(s => {
      if (s.startsWith('/') && s.endsWith('/')) return { type: 're', re: new RegExp(s.slice(1, -1), 'i') };
      // glob-ish → convert dots and * to regex
      const rx = '^' + s.replace(/[.+?^${}()|[\]\\]/g, '\\$&').replace(/\*/g, '.*') + '$';
      return { type: 'glob', re: new RegExp(rx, 'i') };
    });
  }
  return cfg;
}

export function matchPolicyFor(url, policies) {
  const host = new URL(url).hostname;
  for (const d of policies.domains) {
    if (d._matchers?.some(m => m.re.test(host))) return d;
  }
  return policies.defaults || {};
}

export function compileRegexList(csvOrList) {
  if (!csvOrList) return [];
  const items = Array.isArray(csvOrList) ? csvOrList : String(csvOrList).split(',');
^ref-c03020e1-141-0
  return items.map(s => s.trim()).filter(Boolean).map(s => new RegExp(s, 'i')); ^ref-c03020e1-180-0
}
```

(Keep your previous helpers like `sleep`, `normalizeUrlForDedup`, `buildRobotsForOrigin`, `decideUrl`—they still apply, just feed them policy-specific values.) ^ref-c03020e1-184-0

### `infra/crawler-js/src/crawl.js` (replaced core with policy-aware flow)

```js
import { PlaywrightCrawler, KeyValueStore, Dataset, log, Configuration } from 'crawlee';
import fs from 'node:fs';
import path from 'node:path';
import { Agent as HttpProxyAgent } from 'node:http';
import { Agent as HttpsProxyAgent } from 'node:https';
import { XMLParser } from 'fast-xml-parser';
import fetch from 'node-fetch';
import uaPool from './ua.json' assert { type: 'json' };
import { sleep, compileRegexList, normalizeUrlForDedup, buildRobotsForOrigin, decideUrl, loadPolicies, matchPolicyFor } from './utils.js';
import { sinkToOpenSearch, sinkToMeili } from './sinks.js';

const policies = loadPolicies();
const globalDefaults = policies.defaults || {};
const envSeed = process.env.CRAWL_SEED;
const initialSeeds = new Set([].concat(policies.seeds || [], envSeed ? [envSeed] : []));

const outputDir = process.env.OUTPUT_DIR || '/data';
fs.mkdirSync(outputDir, { recursive: true });
const outPath = path.join(outputDir, 'out.jsonl');
const appendJSONL = (o) => fs.appendFileSync(outPath, JSON.stringify(o) + '\n');

// sinks (still optional/local)
const OS_URL = process.env.SINK_OPENSEARCH_URL || '';
const OS_INDEX = process.env.SINK_OPENSEARCH_INDEX || 'documents';
const MEILI_URL = process.env.SINK_MEILI_URL || '';
const MEILI_KEY = process.env.SINK_MEILI_KEY || '';
const MEILI_INDEX = process.env.SINK_MEILI_INDEX || 'documents';

function rotateUA(i) {
  return uaPool[i % uaPool.length] || uaPool[0];
}

function buildProxyAgents(url, policy) {
  const override = policy.proxy && policy.proxy.trim() ? policy.proxy.trim() : (process.env.PROXY_URL || '').trim();
  if (!override) return { httpAgent: undefined, httpsAgent: undefined, proxyUrl: '' };
  return {
    httpAgent: new HttpProxyAgent(override),
    httpsAgent: new HttpsProxyAgent(override),
    proxyUrl: override
  };
}

async function discoverSitemaps(origin, agents, enable) {
  if (!enable) return [];
  try {
    const res = await fetch(`${origin}/sitemap.xml`, { agent: origin.startsWith('https') ? agents.httpsAgent : agents.httpAgent, timeout: 10000 });
    if (!res.ok) return [];
    const xml = await res.text();
    const parser = new XMLParser({ ignoreAttributes: false });
    const j = parser.parse(xml);
    const urls = [];
    if (j.urlset?.url) {
      const arr = Array.isArray(j.urlset.url) ? j.urlset.url : [j.urlset.url];
      for (const u of arr) if (u.loc) urls.push(u.loc);
    }
    if (j.sitemapindex?.sitemap) {
      const arr = Array.isArray(j.sitemapindex.sitemap) ? j.sitemapindex.sitemap : [j.sitemapindex.sitemap];
      for (const sm of arr) if (sm.loc) urls.push(sm.loc);
    }
    return urls;
  } catch { return []; }
}

async function discoverRSS(origin, agents, enable) {
  if (!enable) return [];
  try {
    const res = await fetch(origin, { agent: origin.startsWith('https') ? agents.httpsAgent : agents.httpAgent, timeout: 10000 });
    if (!res.ok) return [];
    const html = await res.text();
    const matches = [...html.matchAll(/<link[^>]+type=['"]application\/(rss\+xml|atom\+xml)['"][^>]*>/gi)];
    const urls = [];
    for (const m of matches) {
      const href = (m[0].match(/href='"['"]/i) || [])[1];
      if (href) urls.push(new URL(href, origin).toString());
    }
    return urls;
  } catch { return []; }
}

function extractByMode(mode, keepHtml, page) {
  return page.content().then(async html => {
    if (mode === 'raw') return keepHtml ? { html } : { text: html.replace(/\s+/g, ' ').slice(0, 500000) };
    if (mode === 'simple') {
      const title = await page.title().catch(()=> '');
      const text = await page.$eval('body', el => el.innerText).catch(()=> '');
      return keepHtml ? { title, html } : { title, text };
    }
    // 'article' heuristic (cheap)
    const title = await page.title().catch(()=> '');
    const meta = {};
    for (const n of ['og:title','og:description','description','article:author','author','og:site_name','article:published_time']) {
      try {
        meta[n] = await page.$eval(`meta[property="${n}"],meta[name="${n}"]`, el => el.content);
      } catch {}
    }
    const mainText = await page.$eval('main', el => el.innerText).catch(async () =>
      page.$eval('article', el => el.innerText).catch(async () =>
        page.$eval('body', el => el.innerText).catch(()=> '')
      )
    );
    return keepHtml ? { title, meta, html } : { title, meta, text: mainText };
  });
}

// cache: per-origin login done
const loginDone = new Set();

Configuration.set({ persistStorage: true, storageDir: './storage' });

const crawler = new PlaywrightCrawler({
  maxRequestsPerCrawl: +(process.env.CRAWL_MAX_PAGES || globalDefaults.maxPages || 200),
  maxConcurrency: +(process.env.CRAWL_CONCURRENCY || globalDefaults.concurrency || 4),
  maxRequestsPerMinute: +(process.env.CRAWL_REQS_PER_MIN || globalDefaults.rpm || 120),
  headless: true,
  requestHandlerTimeoutSecs: 90,
  launchContext: { launchOptions: { args: ['--no-sandbox', '--disable-dev-shm-usage'] } },

  async preNavigationHooks([{ request, page, session }, gotoOptions]) {
    const pol = matchPolicyFor(request.url, policies);
    const seedOrigin = new URL(request.url).origin;
    const allow = compileRegexList(pol.allow || globalDefaults.allow || []);
    const deny = compileRegexList(pol.deny || globalDefaults.deny || []);
    const sameDomainOnly = pol.sameDomainOnly ?? globalDefaults.sameDomainOnly ?? true;
    const respectRobots = pol.respectRobots ?? globalDefaults.respectRobots ?? true;
    const dedupNormalize = pol.dedupNormalize ?? globalDefaults.dedupNormalize ?? true;

    const agents = buildProxyAgents(request.url, pol);
    const urlToFetch = dedupNormalize ? normalizeUrlForDedup(request.url) : request.url;

    if (!decideUrl(urlToFetch, { sameDomainOnly, seedOrigin, allow, deny })) {
      request.noRetry = true; throw new Error('Filtered: allow/deny or cross-domain');
    }

    if (respectRobots) {
      const rb = await buildRobotsForOrigin(new URL(urlToFetch).origin, urlToFetch.startsWith('https') ? agents.httpsAgent : agents.httpAgent);
      if (!rb.isAllowed(urlToFetch, 'PrometheanCrawler')) {
        request.noRetry = true; throw new Error('Robots disallow');
      }
    }

    // headers and cookies
    const headers = { ...(globalDefaults.headers||{}), ...(pol.headers||{}) };
    request.headers = { ...(request.headers||{}), ...headers, 'User-Agent': request.headers?.['User-Agent'] || (session?.id ? rotateUA(parseInt(session.id,10)) : rotateUA(Math.floor(Math.random()*1000))) };

    if ((pol.cookies && pol.cookies.length) || (globalDefaults.cookies && globalDefaults.cookies.length)) {
      const cookies = [...(globalDefaults.cookies || []), ...(pol.cookies || [])];
      if (cookies.length) await page.context().addCookies(cookies);
    }

    // resource blocking
    const blockRules = (pol.blockResources?.length ? pol.blockResources : globalDefaults.blockResources) || [];
    if (blockRules.length) {
      await page.route('**/*', route => {
        const req = route.request();
        const type = req.resourceType();
        if (blockRules.includes('*') || blockRules.includes(type)) return route.abort();
        return route.continue();
      });
    }

    // per-domain login (once per origin)
    if (pol.login && !loginDone.has(seedOrigin)) {
      await page.context().clearCookies().catch(()=>{});
      for (const step of pol.login.steps || []) {
        if (step.goto) await page.goto(step.goto, { waitUntil: 'domcontentloaded', timeout: 30000 });
        if (step.type) await page.fill(step.type.selector, step.type.text, { timeout: 15000 });
        if (step.click) await page.click(step.click.selector, { timeout: 15000 });
        if (step.waitForSelector) await page.waitForSelector(step.waitForSelector.selector, { timeout: step.waitForSelector.timeoutMs || 15000 });
      }
      loginDone.add(seedOrigin);
    }

    // delay/jitter
    const base = +(pol.delayMs ?? globalDefaults.delayMs ?? 0);
    const jit = +(pol.jitterMs ?? globalDefaults.jitterMs ?? 0);
    if (base || jit) await new Promise(r => setTimeout(r, base + Math.floor(Math.random() * (jit + 1))));

    // proxy
    if (agents.proxyUrl) gotoOptions.proxy = { server: agents.proxyUrl };

    gotoOptions.waitUntil = 'domcontentloaded';
  },

  async requestHandler({ request, page, enqueueLinks }) {
    const pol = matchPolicyFor(request.url, policies);
    const dedupNormalize = pol.dedupNormalize ?? globalDefaults.dedupNormalize ?? true;

    const url = dedupNormalize ? normalizeUrlForDedup(request.url) : request.url;
    const title = await page.title().catch(()=>'');
    const now = new Date().toISOString();

    // extraction
    const mode = pol.extractor?.mode || globalDefaults.extractor?.mode || 'article';
    const keepHtml = pol.extractor?.keepHtml ?? globalDefaults.extractor?.keepHtml ?? false;
    const body = await extractByMode(mode, keepHtml, page);

    const doc = { url, title, fetched_at: now, ...body };

    appendJSONL(doc);
    await Dataset.pushData(doc);
    await sinkToOpenSearch([doc], { url: OS_URL, index: OS_INDEX });
    await sinkToMeili([doc], { url: MEILI_URL, index: MEILI_INDEX, apiKey: MEILI_KEY });

    // depth-aware enqueuing
    const sameDomainOnly = pol.sameDomainOnly ?? globalDefaults.sameDomainOnly ?? true;
    const allow = compileRegexList(pol.allow || globalDefaults.allow || []);
    const deny = compileRegexList(pol.deny || globalDefaults.deny || []);
    const maxDepth = +(pol.maxDepth ?? globalDefaults.maxDepth ?? 3);

    const { depth = 0 } = request.userData || {};
    if (depth < maxDepth) {
      await enqueueLinks({
        strategy: sameDomainOnly ? 'same-domain' : 'all',
        transformRequestFunction: (req) => {
          // filter by allow/deny as we queue
          if (!decideUrl(req.url, { sameDomainOnly, seedOrigin: new URL(request.url).origin, allow, deny })) return null;
          const next = dedupNormalize ? normalizeUrlForDedup(req.url) : req.url;
          return { url: next, userData: { depth: depth + 1 } };
        }
      });
    }
  },

  async failedRequestHandler({ request, error }) {
    appendJSONL({ url: request.url, error: String(error), failed_at: new Date().toISOString() });
  }
});

// bootstrap queue with policy seeds + env seed + optional sitemap/rss per domain
const rq = await KeyValueStore.open();
await rq.setValue('__meta__', { seeds: [...initialSeeds], started_at: new Date().toISOString() });

const seeds = new Set(initialSeeds);
for (const s of seeds) {
  const pol = matchPolicyFor(s, policies);
  const agents = buildProxyAgents(s, pol);
  const origin = new URL(s).origin;
  const sm = await discoverSitemaps(origin, agents, pol.sitemapDiscover ?? globalDefaults.sitemapDiscover ?? true);
  const rss = await discoverRSS(origin, agents, pol.rssDiscover ?? globalDefaults.rssDiscover ?? true);
  for (const u of sm) seeds.add(u);
  for (const u of rss) seeds.add(u);
}

^ref-c03020e1-184-0
log.setLevel(log.LEVELS.INFO);
await crawler.run([...seeds]);
console.log(`JSONL: ${outPath}`);
```
^ref-c03020e1-188-0
 ^ref-c03020e1-437-0
---
 ^ref-c03020e1-439-0
## 4) Run examples

**Local, no Tor:**
^ref-c03020e1-439-0
 ^ref-c03020e1-444-0
```bash
POLICY_FILE=./infra/crawler-js/policies.yaml \
docker compose --profile crawl-js up --build crawler-js
``` ^ref-c03020e1-449-0
^ref-c03020e1-446-0

**Through Tor/Privoxy (for matching domains only):**
^ref-c03020e1-446-0

```bash
docker compose --profile crawl-js --profile tor up -d tor privoxy
POLICY_FILE=./infra/crawler-js/policies.yaml \
docker compose --profile crawl-js up --build crawler-js
```
 ^ref-c03020e1-458-0 ^ref-c03020e1-459-0
(Any domain stanza with `proxy: " will route via Tor. Everything else follows `PROXY_URL` if set, otherwise direct.) ^ref-c03020e1-459-0 ^ref-c03020e1-460-0
 ^ref-c03020e1-460-0 ^ref-c03020e1-461-0
--- ^ref-c03020e1-461-0 ^ref-c03020e1-462-0
 ^ref-c03020e1-462-0 ^ref-c03020e1-463-0
## 5) Why this setup won’t fight you ^ref-c03020e1-463-0

* **Single source of truth**: `policies.yaml` controls throttles, RPM, depth, allow/deny, robots, headers, cookies, **login**, extract mode, and per-domain proxy.
* **Login once** per origin using deterministic steps (goto/type/click/wait). ^ref-c03020e1-467-0
* **Bandwidth sane**: resource blocking per domain (e.g., kill images/fonts on docs sites). ^ref-c03020e1-467-0
* **Extraction modes**: `article` (cheap heuristic), `simple` (title + body text), `raw` (HTML). ^ref-c03020e1-469-0
* **No surprise egress**: explicit proxy override per domain; keep the rest local. ^ref-c03020e1-469-0
* **No Python.** All Node, all the time. ^ref-c03020e1-471-0
 ^ref-c03020e1-471-0 ^ref-c03020e1-472-0
If you want, I can add a **domain-local JavaScript extractor hook** in YAML (e.g., `extractor.script: "return document.querySelector('article')?.innerText || ''"`) that we `page.evaluate()` — gives you surgical control without editing code. ^ref-c03020e1-472-0

\#webcrawling #javascript #playwright #crawlee #docker #tor #privoxy #selfhosted #opensearch #meilisearch #config-as-code #policies
 ^ref-c03020e1-495-0 ^ref-c03020e1-496-0 ^ref-c03020e1-507-0 ^ref-c03020e1-523-0 ^ref-c03020e1-532-0 ^ref-c03020e1-537-0 ^ref-c03020e1-538-0 ^ref-c03020e1-547-0 ^ref-c03020e1-612-0 ^ref-c03020e1-626-0 ^ref-c03020e1-629-0 ^ref-c03020e1-932-0 ^ref-c03020e1-1040-0 ^ref-c03020e1-1608-0 ^ref-c03020e1-1852-0 ^ref-c03020e1-2046-0 ^ref-c03020e1-3347-0 ^ref-c03020e1-3544-0 ^ref-c03020e1-4442-0 ^ref-c03020e1-4693-0 ^ref-c03020e1-6064-0
<!-- GENERATED-SECTIONS:DO-NOT-EDIT-BELOW -->
## Related content
- [Prompt_Folder_Bootstrap](prompt-folder-bootstrap.md)
- [Stateful Partitions and Rebalancing](stateful-partitions-and-rebalancing.md)
- [eidolon-field-math-foundations](eidolon-field-math-foundations.md)
- [Chroma Toolkit Consolidation Plan](chroma-toolkit-consolidation-plan.md)
- [Unique Info Dump Index](unique-info-dump-index.md)
- [Migrate to Provider-Tenant Architecture](migrate-to-provider-tenant-architecture.md)
- [schema-evolution-workflow](schema-evolution-workflow.md)
- [Dynamic Context Model for Web Components](dynamic-context-model-for-web-components.md)
- [Eidolon Field Abstract Model](eidolon-field-abstract-model.md)
- [eidolon-node-lifecycle](eidolon-node-lifecycle.md)
- [field-dynamics-math-blocks](field-dynamics-math-blocks.md)
- [i3-bluetooth-setup](i3-bluetooth-setup.md)
- [Duck's Self-Referential Perceptual Loop](ducks-self-referential-perceptual-loop.md)
- [Debugging Broker Connections and Agent Behavior](debugging-broker-connections-and-agent-behavior.md)
- [field-interaction-equations](field-interaction-equations.md)
- [windows-tiling-with-autohotkey](windows-tiling-with-autohotkey.md)
- [Creative Moments](creative-moments.md)
- [Duck's Attractor States](ducks-attractor-states.md)
- [Promethean Chat Activity Report](promethean-chat-activity-report.md)
- [typed-struct-compiler](typed-struct-compiler.md)
- [TypeScript Patch for Tool Calling Support](typescript-patch-for-tool-calling-support.md)
- [zero-copy-snapshots-and-workers](zero-copy-snapshots-and-workers.md)
- [obsidian-ignore-node-modules-regex](obsidian-ignore-node-modules-regex.md)
- [Promethean-Copilot-Intent-Engine](promethean-copilot-intent-engine.md)
- [Obsidian ChatGPT Plugin Integration Guide](obsidian-chatgpt-plugin-integration-guide.md)
## Sources
- [Smoke Resonance Visualizations — L483](smoke-resonance-visualizations.md#^ref-ac9d3ac5-483-0) (line 483, col 0, score 1)
- [Stateful Partitions and Rebalancing — L1321](stateful-partitions-and-rebalancing.md#^ref-4330e8f0-1321-0) (line 1321, col 0, score 1)
- [Tracing the Signal — L561](tracing-the-signal.md#^ref-c3cd4f65-561-0) (line 561, col 0, score 1)
- [ts-to-lisp-transpiler — L522](ts-to-lisp-transpiler.md#^ref-ba11486b-522-0) (line 522, col 0, score 1)
- [typed-struct-compiler — L1015](typed-struct-compiler.md#^ref-78eeedf7-1015-0) (line 1015, col 0, score 1)
- [TypeScript Patch for Tool Calling Support — L1228](typescript-patch-for-tool-calling-support.md#^ref-7b7ca860-1228-0) (line 1228, col 0, score 1)
- [Unique Concepts — L173](unique-concepts.md#^ref-ed6f3fc9-173-0) (line 173, col 0, score 1)
- [zero-copy-snapshots-and-workers — L1057](zero-copy-snapshots-and-workers.md#^ref-62bec6f0-1057-0) (line 1057, col 0, score 1)
- [Canonical Org-Babel Matplotlib Animation Template — L513](canonical-org-babel-matplotlib-animation-template.md#^ref-1b1338fc-513-0) (line 513, col 0, score 1)
- [Agent Reflections and Prompt Evolution — L618](agent-reflections-and-prompt-evolution.md#^ref-bb7f0835-618-0) (line 618, col 0, score 1)
- [ChatGPT Custom Prompts — L187](chatgpt-custom-prompts.md#^ref-930054b3-187-0) (line 187, col 0, score 1)
- [Chroma Toolkit Consolidation Plan — L999](chroma-toolkit-consolidation-plan.md#^ref-5020e892-999-0) (line 999, col 0, score 1)
- [typed-struct-compiler — L1016](typed-struct-compiler.md#^ref-78eeedf7-1016-0) (line 1016, col 0, score 1)
- [Unique Concepts — L175](unique-concepts.md#^ref-ed6f3fc9-175-0) (line 175, col 0, score 1)
- [Unique Info Dump Index — L1221](unique-info-dump-index.md#^ref-30ec3ba6-1221-0) (line 1221, col 0, score 1)
- [zero-copy-snapshots-and-workers — L1058](zero-copy-snapshots-and-workers.md#^ref-62bec6f0-1058-0) (line 1058, col 0, score 1)
- [Canonical Org-Babel Matplotlib Animation Template — L515](canonical-org-babel-matplotlib-animation-template.md#^ref-1b1338fc-515-0) (line 515, col 0, score 1)
- [Creative Moments — L251](creative-moments.md#^ref-10d98225-251-0) (line 251, col 0, score 1)
- [Duck's Attractor States — L559](ducks-attractor-states.md#^ref-13951643-559-0) (line 559, col 0, score 1)
- [eidolon-field-math-foundations — L1033](eidolon-field-math-foundations.md#^ref-008f2ac0-1033-0) (line 1033, col 0, score 1)
- [Docops Feature Updates — L55](docops-feature-updates-3.md#^ref-cdbd21ee-55-0) (line 55, col 0, score 1)
- [Docops Feature Updates — L89](docops-feature-updates.md#^ref-2792d448-89-0) (line 89, col 0, score 1)
- [Duck's Self-Referential Perceptual Loop — L110](ducks-self-referential-perceptual-loop.md#^ref-71726f04-110-0) (line 110, col 0, score 1)
- [Dynamic Context Model for Web Components — L477](dynamic-context-model-for-web-components.md#^ref-f7702bf8-477-0) (line 477, col 0, score 1)
- [eidolon-field-math-foundations — L215](eidolon-field-math-foundations.md#^ref-008f2ac0-215-0) (line 215, col 0, score 1)
- [eidolon-node-lifecycle — L127](eidolon-node-lifecycle.md#^ref-938eca9c-127-0) (line 127, col 0, score 1)
- [Factorio AI with External Agents — L224](factorio-ai-with-external-agents.md#^ref-a4d90289-224-0) (line 224, col 0, score 1)
- [field-dynamics-math-blocks — L233](field-dynamics-math-blocks.md#^ref-7cfc230d-233-0) (line 233, col 0, score 1)
- [Creative Moments — L53](creative-moments.md#^ref-10d98225-53-0) (line 53, col 0, score 1)
- [Model Selection for Lightweight Conversational Tasks — L209](model-selection-for-lightweight-conversational-tasks.md#^ref-d144aa62-209-0) (line 209, col 0, score 1)
- [Obsidian ChatGPT Plugin Integration Guide — L137](obsidian-chatgpt-plugin-integration-guide.md#^ref-1d3d6c3a-137-0) (line 137, col 0, score 1)
- [Obsidian ChatGPT Plugin Integration — L138](obsidian-chatgpt-plugin-integration.md#^ref-ca8e1399-138-0) (line 138, col 0, score 1)
- [Obsidian Templating Plugins Integration Guide — L207](obsidian-templating-plugins-integration-guide.md#^ref-b39dc9d4-207-0) (line 207, col 0, score 1)
- [Pipeline Enhancements — L59](pipeline-enhancements.md#^ref-e2135d9f-59-0) (line 59, col 0, score 1)
- [plan-update-confirmation — L1100](plan-update-confirmation.md#^ref-b22d79c6-1100-0) (line 1100, col 0, score 1)
- [polyglot-repl-interface-layer — L230](polyglot-repl-interface-layer.md#^ref-9c79206d-230-0) (line 230, col 0, score 1)
- [Post-Linguistic Transhuman Design Frameworks — L125](post-linguistic-transhuman-design-frameworks.md#^ref-6bcff92c-125-0) (line 125, col 0, score 1)
- [Promethean Chat Activity Report — L147](promethean-chat-activity-report.md#^ref-18344cf9-147-0) (line 147, col 0, score 1)
- [Creative Moments — L47](creative-moments.md#^ref-10d98225-47-0) (line 47, col 0, score 1)
- [Debugging Broker Connections and Agent Behavior — L105](debugging-broker-connections-and-agent-behavior.md#^ref-73d3dbf6-105-0) (line 105, col 0, score 1)
- [Docops Feature Updates — L97](docops-feature-updates-3.md#^ref-cdbd21ee-97-0) (line 97, col 0, score 1)
- [Docops Feature Updates — L128](docops-feature-updates.md#^ref-2792d448-128-0) (line 128, col 0, score 1)
- [DuckDuckGoSearchPipeline — L31](duckduckgosearchpipeline.md#^ref-e979c50f-31-0) (line 31, col 0, score 1)
- [Duck's Attractor States — L90](ducks-attractor-states.md#^ref-13951643-90-0) (line 90, col 0, score 1)
- [Duck's Self-Referential Perceptual Loop — L33](ducks-self-referential-perceptual-loop.md#^ref-71726f04-33-0) (line 33, col 0, score 1)
- [Dynamic Context Model for Web Components — L462](dynamic-context-model-for-web-components.md#^ref-f7702bf8-462-0) (line 462, col 0, score 1)
- [Creative Moments — L28](creative-moments.md#^ref-10d98225-28-0) (line 28, col 0, score 1)
- [Docops Feature Updates — L65](docops-feature-updates-3.md#^ref-cdbd21ee-65-0) (line 65, col 0, score 1)
- [Docops Feature Updates — L86](docops-feature-updates.md#^ref-2792d448-86-0) (line 86, col 0, score 1)
- [Duck's Self-Referential Perceptual Loop — L34](ducks-self-referential-perceptual-loop.md#^ref-71726f04-34-0) (line 34, col 0, score 1)
- [Dynamic Context Model for Web Components — L442](dynamic-context-model-for-web-components.md#^ref-f7702bf8-442-0) (line 442, col 0, score 1)
- [Eidolon Field Abstract Model — L218](eidolon-field-abstract-model.md#^ref-5e8b2388-218-0) (line 218, col 0, score 1)
- [eidolon-field-math-foundations — L176](eidolon-field-math-foundations.md#^ref-008f2ac0-176-0) (line 176, col 0, score 1)
- [eidolon-node-lifecycle — L70](eidolon-node-lifecycle.md#^ref-938eca9c-70-0) (line 70, col 0, score 1)
- [Duck's Attractor States — L123](ducks-attractor-states.md#^ref-13951643-123-0) (line 123, col 0, score 1)
- [Dynamic Context Model for Web Components — L412](dynamic-context-model-for-web-components.md#^ref-f7702bf8-412-0) (line 412, col 0, score 1)
- [Eidolon Field Abstract Model — L261](eidolon-field-abstract-model.md#^ref-5e8b2388-261-0) (line 261, col 0, score 1)
- [eidolon-field-math-foundations — L181](eidolon-field-math-foundations.md#^ref-008f2ac0-181-0) (line 181, col 0, score 1)
- [eidolon-node-lifecycle — L90](eidolon-node-lifecycle.md#^ref-938eca9c-90-0) (line 90, col 0, score 1)
- [Factorio AI with External Agents — L157](factorio-ai-with-external-agents.md#^ref-a4d90289-157-0) (line 157, col 0, score 1)
- [field-dynamics-math-blocks — L205](field-dynamics-math-blocks.md#^ref-7cfc230d-205-0) (line 205, col 0, score 1)
- [field-interaction-equations — L149](field-interaction-equations.md#^ref-b09141b7-149-0) (line 149, col 0, score 1)
- [field-node-diagram-outline — L110](field-node-diagram-outline.md#^ref-1f32c94a-110-0) (line 110, col 0, score 1)
- [field-node-diagram-set — L203](field-node-diagram-set.md#^ref-22b989d5-203-0) (line 203, col 0, score 1)
- [field-node-diagram-visualizations — L95](field-node-diagram-visualizations.md#^ref-e9b27b06-95-0) (line 95, col 0, score 1)
- [TypeScript Patch for Tool Calling Support — L541](typescript-patch-for-tool-calling-support.md#^ref-7b7ca860-541-0) (line 541, col 0, score 1)
- [zero-copy-snapshots-and-workers — L375](zero-copy-snapshots-and-workers.md#^ref-62bec6f0-375-0) (line 375, col 0, score 1)
- [Duck's Self-Referential Perceptual Loop — L78](ducks-self-referential-perceptual-loop.md#^ref-71726f04-78-0) (line 78, col 0, score 1)
- [Factorio AI with External Agents — L176](factorio-ai-with-external-agents.md#^ref-a4d90289-176-0) (line 176, col 0, score 1)
- [field-node-diagram-outline — L154](field-node-diagram-outline.md#^ref-1f32c94a-154-0) (line 154, col 0, score 1)
- [field-node-diagram-set — L175](field-node-diagram-set.md#^ref-22b989d5-175-0) (line 175, col 0, score 1)
- [field-node-diagram-visualizations — L123](field-node-diagram-visualizations.md#^ref-e9b27b06-123-0) (line 123, col 0, score 1)
- [Fnord Tracer Protocol — L274](fnord-tracer-protocol.md#^ref-fc21f824-274-0) (line 274, col 0, score 1)
- [Functional Embedding Pipeline Refactor — L327](functional-embedding-pipeline-refactor.md#^ref-a4a25141-327-0) (line 327, col 0, score 1)
- [graph-ds — L412](graph-ds.md#^ref-6620e2f2-412-0) (line 412, col 0, score 1)
- [heartbeat-fragment-demo — L159](heartbeat-fragment-demo.md#^ref-dd00677a-159-0) (line 159, col 0, score 1)
- [Ice Box Reorganization — L95](ice-box-reorganization.md#^ref-291c7d91-95-0) (line 95, col 0, score 1)
- [Creative Moments — L33](creative-moments.md#^ref-10d98225-33-0) (line 33, col 0, score 1)
- [Debugging Broker Connections and Agent Behavior — L99](debugging-broker-connections-and-agent-behavior.md#^ref-73d3dbf6-99-0) (line 99, col 0, score 1)
- [Docops Feature Updates — L46](docops-feature-updates.md#^ref-2792d448-46-0) (line 46, col 0, score 1)
- [DuckDuckGoSearchPipeline — L10](duckduckgosearchpipeline.md#^ref-e979c50f-10-0) (line 10, col 0, score 1)
- [Creative Moments — L8](creative-moments.md#^ref-10d98225-8-0) (line 8, col 0, score 1)
- [Debugging Broker Connections and Agent Behavior — L38](debugging-broker-connections-and-agent-behavior.md#^ref-73d3dbf6-38-0) (line 38, col 0, score 1)
- [Docops Feature Updates — L56](docops-feature-updates-3.md#^ref-cdbd21ee-56-0) (line 56, col 0, score 1)
- [Creative Moments — L38](creative-moments.md#^ref-10d98225-38-0) (line 38, col 0, score 1)
- [Docops Feature Updates — L51](docops-feature-updates-3.md#^ref-cdbd21ee-51-0) (line 51, col 0, score 1)
- [Docops Feature Updates — L79](docops-feature-updates.md#^ref-2792d448-79-0) (line 79, col 0, score 1)
- [DuckDuckGoSearchPipeline — L77](duckduckgosearchpipeline.md#^ref-e979c50f-77-0) (line 77, col 0, score 1)
- [Duck's Attractor States — L115](ducks-attractor-states.md#^ref-13951643-115-0) (line 115, col 0, score 1)
- [Duck's Self-Referential Perceptual Loop — L61](ducks-self-referential-perceptual-loop.md#^ref-71726f04-61-0) (line 61, col 0, score 1)
- [Eidolon Field Abstract Model — L212](eidolon-field-abstract-model.md#^ref-5e8b2388-212-0) (line 212, col 0, score 1)
- [eidolon-field-math-foundations — L150](eidolon-field-math-foundations.md#^ref-008f2ac0-150-0) (line 150, col 0, score 1)
- [Creative Moments — L94](creative-moments.md#^ref-10d98225-94-0) (line 94, col 0, score 1)
- [Debugging Broker Connections and Agent Behavior — L63](debugging-broker-connections-and-agent-behavior.md#^ref-73d3dbf6-63-0) (line 63, col 0, score 1)
- [Docops Feature Updates — L66](docops-feature-updates-3.md#^ref-cdbd21ee-66-0) (line 66, col 0, score 1)
- [DuckDuckGoSearchPipeline — L93](duckduckgosearchpipeline.md#^ref-e979c50f-93-0) (line 93, col 0, score 1)
- [Duck's Self-Referential Perceptual Loop — L73](ducks-self-referential-perceptual-loop.md#^ref-71726f04-73-0) (line 73, col 0, score 1)
- [Dynamic Context Model for Web Components — L403](dynamic-context-model-for-web-components.md#^ref-f7702bf8-403-0) (line 403, col 0, score 1)
- [graph-ds — L371](graph-ds.md#^ref-6620e2f2-371-0) (line 371, col 0, score 1)
- [heartbeat-fragment-demo — L141](heartbeat-fragment-demo.md#^ref-dd00677a-141-0) (line 141, col 0, score 1)
<!-- GENERATED-SECTIONS:DO-NOT-EDIT-ABOVE -->
