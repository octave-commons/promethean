---
uuid: 8b8e6103-30a4-4d66-b5f2-87db1612b587
created_at: 2025.08.31.16.57.42.md
filename: Promethean Pipelines
description: >-
  A set of idempotent, marker-safe pipelines for detecting API drift, generating
  semver recommendations, creating type dependency graphs, and automating
  documentation tasks. These pipelines cache outputs under `.cache/<pkg>` and
  follow a consistent workflow for scalable repo analysis.
tags:
  - api-diff
  - semver
  - typegraph
  - codemods
  - i18npack
  - licscan
  - test-gap
  - glossary
  - adr-bot
  - riskmap
  - docs
  - pipeline
---
love that. treat repos like dataflows and CLIs like transforms. here are high-leverage pipelines we can bolt on next (all idempotent, marker-safe, cached under `.cache/<pkg>`):

## menu of new pipelines

1. **apidiff** — detect API drift & breaking changes

   * scan exported symbols → compare across git refs (e.g., `main` vs `HEAD`) → classify breaks → write `docs/packages/<pkg>/api-diff.md` + tasks.
   * outputs: semver bump suggestion per package, “fix or docs?” tasks.

2. **semver-guard** — compute required semver and open a task/PR stub

   * inputs: apidiff results, changelog fragments → decide `major|minor|patch` → write `docs/agile/tasks/semver-<pkg>.md`.

3. **typegraph** — TS type dependency graph

   * crawl types/interfaces → emit Mermaid graphs per module + cross-package type edges → `docs/packages/<pkg>/types.md`.

4. **cookbook** — auto example miner

   * harvest examples from tests/docs/snippets → normalize & run small runners → write `docs/cookbook/<topic>.md` with verified outputs.

5. **test-gap** — semantic test coverage

   * map functions ↔ tests (by name, imports, embeddings) → flag high-risk/low-coverage → create tasks per cluster.

6. **codemods** — transform kits for consolidation

   * from `simtasks` clusters → synthesize jscodeshift/ts-morph codemods → write under `codemods/<cluster>/` with dry-run report + task.

7. **i18npack** — string extraction & dedupe

   * extract literals → cluster near-dupes → propose keys → write `i18n/<locale>.json` and tasks to wire calls.

8. **licscan** — license & header compliance

   * detect license of each dependency (from lockfile) + check file headers → write `docs/compliance/license-report.md` + fixup tasks.

9. **perf-bench** — microbench common idioms

   * auto-gen small benchmarks for hot functions → record runs → write `docs/bench/<pkg>.md` with tables & trend deltas.

10. **glossary** — repo knowledge graph

* extract terms from docs/code → link occurrences → `docs/glossary/*.md` and back-links in footers.

11. **adr-bot** — decision trail

* generate ADR stubs from merged tasks/PRs → place in `docs/adr/NNN-*.md`, cross-linked to affected packages.

12. **riskmap** — dependency risk heatmap

* combine in-graph centrality + age of last change + test-gap → write `docs/ops/riskmap.md` and “stabilize X” tasks.

---

## orchestration sketch

```mermaid
flowchart LR
  A[scan symbols/types] --> B[embed/compare]
  B --> C[cluster/score]
  C --> D[plans (Ollama)]
  D --> E[docs pages]
  D --> F[tasks]
  B --> G[graphs (api/type/pkg)]
  G --> E
```

---

## consistent shape (each package)

* **01-scan** → JSON facts
* **02-embed** (optional)
* **03-analyze** (diff/cluster/score)
* **04-plan** (LLM JSON, zod-validated, cached)
* **05-write** (docs + tasks, marker-bounded)
* all steps support `--dry-run`, read config from `*.config.json`, and keep outputs deterministic.

---

## quick starters to build next

* **apidiff** (fast win): reuse `@promethean/symdocs` scan output; add `03-diff.ts` (compare against saved baseline in `.cache/apidiff/<pkg>.json`) and `05-write.ts` for a per-package report + semver recommendation.
* **codemods** (pairs nicely with `simtasks`): add `simtasks:06-codemods` to synthesize ts-morph transforms from a plan and emit runnable codemods with a dry-run CLI.

pick 2 and I’ll spin the files. if you want, we can also add a tiny **runner** (`pipelines.json` → runs steps with change detection) so new steps slot in without touching existing scripts.
