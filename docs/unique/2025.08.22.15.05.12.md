## User
Looks like I am going to have to consolidate my endpoints a bit. 30 is the max alllowed per domain.

## ChatGPT
Ahh, yep — that’s a common cap. Most providers (Vercel, Cloudflare Workers, even some API gateways) put hard limits around 30 routes/endpoints per domain or project before nudging you to consolidate.

Couple of strategies you could use:

*   **Group endpoints under a prefix**  
    Instead of `/foo`, `/bar`, `/baz`, you collapse them into `/api/foo`, `/api/bar`, etc. Then you only register one “wildcard” route with your host and handle dispatching inside.
    
*   **Introduce a router service**  
    One entrypoint (say `/api/*`) that forwards requests to internal microservices. Internally, you can have as many endpoints as you want — externally, you’re capped at one. This is basically what an API gateway does.
    
*   **Path params vs. new routes**  
    If you currently have `GET /users` and `GET /users/:id` as two registered endpoints, collapse into one router endpoint `/users/*` and dispatch based on whether the tail is empty or not.
    
*   **Consolidate by verb**  
    Instead of `/createUser`, `/updateUser`, `/deleteUser`, you expose `/user` and use `POST`, `PUT`, `DELETE`. Saves a lot of endpoint slots.
    
*   **Subdomains** if you really need more than 30 and consolidation isn’t possible, sometimes splitting across subdomains is a workaround (e.g. `auth.promethean.dev`, `ml.promethean.dev`).
    

Do you want me to sketch a consolidation map for your Promethean services (like grouping `heartbeat`, `broker`, `smartgpt-bridge`, etc.) so you can see how to get under 30 cleanly?

## User
Here is where we are at right now:  {"openapi":"3.1.0","info":{"title":"Promethean SmartGPT Bridge","version":"1.0.0"},"components":{"securitySchemes":{"apiKey":{"type":"apiKey","name":"x-pi-token","in":"header"}},"schemas":{}},"paths":{"/files/list":{"get":{"operationId":"listFiles","summary":"List files in a directory","tags":\["Files"\],"parameters":\[{"schema":{"type":"string","default":"."},"in":"query","name":"path","required":false},{"schema":{"type":"boolean","default":false},"in":"query","name":"hidden","required":false},{"schema":{"type":"string","enum":\["file","dir"\]},"in":"query","name":"type","required":false}\],"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"base":{"type":"string"},"entries":{"type":"array","items":{"type":"object","properties":{"name":{"type":"string"},"path":{"type":"string"},"type":{"type":"string"},"size":{"type":\["null","integer"\]},"mtimeMs":{"type":\["null","number"\]}}}}}}}}}}}},"/files/view":{"get":{"operationId":"viewFile","summary":"View a file snippet","tags":\["Files"\],"parameters":\[{"schema":{"type":"string"},"in":"query","name":"path","required":true},{"schema":{"type":"integer","default":1},"in":"query","name":"line","required":false},{"schema":{"type":"integer","default":25},"in":"query","name":"context","required":false}\],"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"path":{"type":"string"},"totalLines":{"type":"integer"},"startLine":{"type":"integer"},"endLine":{"type":"integer"},"focusLine":{"type":"integer"},"snippet":{"type":"string"}}}}}}}}},"/stacktrace/locate":{"post":{"operationId":"locateStacktrace","summary":"Locate files from a stacktrace","tags":\["Files"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"text":{"type":"string"},"trace":{"type":"string"},"context":{"type":"integer","default":25}}}}}},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"results":{"type":"array","items":{"type":"object"}}}}}}}}}},"/grep":{"post":{"operationId":"grepFiles","summary":"Search repository files via ripgrep","tags":\["Search"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["pattern"\],"properties":{"pattern":{"type":"string"},"flags":{"type":"string","default":"g"},"paths":{"type":"array","items":{"type":"string"},"default":\["\*\*/\*.{ts,tsx,js,jsx,py,go,rs,md,txt,json,yml,yaml,sh}"\]},"maxMatches":{"type":"integer","default":200},"context":{"type":"integer","default":2}}}}},"required":true},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"results":{"type":"array","items":{"type":"object"}}}}}}}}}},"/symbols/index":{"post":{"operationId":"indexSymbols","summary":"Index project symbols","tags":\["Symbols"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"paths":{"type":\["array","null"\],"items":{"type":"string"}},"exclude":{"type":\["array","null"\],"items":{"type":"string"}}}}}}},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"indexed":{"type":"integer"},"info":{"type":"integer"}}}}}}}}},"/symbols/find":{"post":{"operationId":"findSymbols","summary":"Find indexed symbols","tags":\["Symbols"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["query"\],"properties":{"query":{"type":"string"},"kind":{"type":"string"},"path":{"type":"string"},"limit":{"type":"integer"}}}}},"required":true},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"results":{"type":"array","items":{"type":"object"}}}}}}}}}},"/search":{"post":{"operationId":"semanticSearch","summary":"Semantic search via Chroma","tags":\["Search"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["q"\],"properties":{"q":{"type":"string"},"n":{"type":"integer","default":8}}}}},"required":true},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"results":{"type":"array","items":{"type":"object"}}}}}}}}}},"/search/web":{"post":{"operationId":"webSearch","tags":\["Search"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["q"\],"properties":{"q":{"type":"string"},"limit":{"type":"integer","default":5}}}}},"required":true},"responses":{"200":{"description":"Default Response"}}}},"/reindex":{"post":{"operationId":"reindexAll","summary":"Reindex entire repository","tags":\["Indexer"\],"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"queued":{"type":"integer"},"ignored":{"type":"boolean"}}}}}}}}},"/files/reindex":{"post":{"operationId":"reindexFiles","summary":"Reindex subset of files","tags":\["Indexer"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"path":{"type":\["string","array"\],"items":{"type":"string"}}}}}}},"parameters":\[{"schema":{"type":\["string","array"\],"items":{"type":"string"}},"in":"query","name":"path","required":false}\],"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"queued":{"type":"integer"},"ignored":{"type":"boolean"}}}}}}}}},"/indexer/status":{"get":{"operationId":"indexerStatus","summary":"Get indexer status","tags":\["Indexer"\],"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"status":{"type":"object"}}}}}}}}},"/indexer/index":{"post":{"operationId":"indexFile","summary":"Index a single file","tags":\["Indexer"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["path"\],"properties":{"path":{"type":"string"}}}}},"required":true},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"queued":{"type":"integer"}}}}}}}}},"/indexer/remove":{"post":{"operationId":"removeFileFromIndex","summary":"Remove a file from index","tags":\["Indexer"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["path"\],"properties":{"path":{"type":"string"}}}}},"required":true},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"error":{"type":"string"}}}}}}}}},"/indexer/reset":{"post":{"operationId":"resetIndexer","summary":"Reset indexer state and bootstrap","tags":\["Indexer"\],"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"}}}}}},"409":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"error":{"type":"string"}}}}}}}}},"/agent/start":{"post":{"operationId":"startAgent","summary":"Start a background agent","tags":\["Agent"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["prompt"\],"properties":{"prompt":{"type":"string"},"bypassApprovals":{"type":"boolean","default":false},"sandbox":{"type":\["string","boolean"\],"enum":\["nsjail",true,false\],"default":false},"tty":{"type":"boolean","default":true},"env":{"type":"object","additionalProperties":{"type":"string"}}}}}},"required":true},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"id":{"type":"string"},"prompt":{"type":"string"},"startedAt":{"type":"integer"},"sandbox":{"type":"string"},"bypassApprovals":{"type":"boolean"},"logfile":{"type":"string"}}}}}}}}},"/agent/status":{"get":{"operationId":"getAgentStatus","summary":"Get agent status","tags":\["Agent"\],"parameters":\[{"schema":{"type":"string"},"in":"query","name":"id","required":true}\],"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"status":{"type":"object"}}}}}},"404":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"error":{"type":"string"}}}}}}}}},"/agent/status/{id}":{"get":{"operationId":"getAgentStatusById","summary":"Get agent status by id","tags":\["Agent"\],"parameters":\[{"schema":{"type":"string"},"in":"path","name":"id","required":true}\],"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"status":{"type":"object"}}}}}},"404":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"error":{"type":"string"}}}}}}}}},"/agent/list":{"get":{"operationId":"listAgents","summary":"List active agents","tags":\["Agent"\],"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"agents":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"sandbox":{"type":"string"}}}}}}}}}}}},"/agent/logs":{"get":{"operationId":"getAgentLogs","summary":"Get agent logs","tags":\["Agent"\],"parameters":\[{"schema":{"type":"string"},"in":"query","name":"id","required":true},{"schema":{"type":"integer","default":8192},"in":"query","name":"bytes","required":false}\],"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"total":{"type":"integer"},"chunk":{"type":"string"}}}}}},"404":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"error":{"type":"string"}}}}}}}}},"/agent/tail":{"get":{"operationId":"tailAgentLogs","summary":"Tail agent logs","tags":\["Agent"\],"parameters":\[{"schema":{"type":"string"},"in":"query","name":"id","required":true},{"schema":{"type":"integer","default":8192},"in":"query","name":"bytes","required":false}\],"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"total":{"type":"integer"},"chunk":{"type":"string"}}}}}},"404":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"error":{"type":"string"}}}}}}}}},"/agent/stream":{"get":{"operationId":"streamAgentLogs","summary":"Stream agent logs","tags":\["Agent"\],"parameters":\[{"schema":{"type":"string"},"in":"query","name":"id","required":true}\],"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"string"}}}}}}},"/agent/send":{"post":{"operationId":"sendAgentInput","summary":"Send input to agent","tags":\["Agent"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["id","input"\],"properties":{"id":{"type":"string"},"input":{"type":"string"}}}}},"required":true},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"error":{"type":"string"}}}}}}}}},"/agent/interrupt":{"post":{"operationId":"interruptAgent","summary":"Interrupt agent","tags":\["Agent"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["id"\],"properties":{"id":{"type":"string"}}}}},"required":true},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"}}}}}}}}},"/agent/kill":{"post":{"operationId":"killAgent","summary":"Kill an agent","tags":\["Agent"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["id"\],"properties":{"id":{"type":"string"}}}}},"required":true},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"}}}}}}}}},"/agent/resume":{"post":{"operationId":"resumeAgent","summary":"Resume agent (not supported)","tags":\["Agent"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["id"\],"properties":{"id":{"type":"string"}}}}},"required":true},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"error":{"type":"string"}}}}}}}}},"/exec/run":{"post":{"operationId":"runCommand","summary":"Run a shell command","tags":\["Exec"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["command"\],"properties":{"command":{"type":"string"},"cwd":{"type":"string"},"env":{"type":"object","additionalProperties":{"type":"string"}},"timeoutMs":{"type":"integer","default":600000},"tty":{"type":"boolean","default":false}}}}},"required":true},"responses":{"200":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"exitCode":{"type":\["null","integer"\]},"signal":{"type":\["null","string"\]},"stdout":{"type":"string"},"stderr":{"type":"string"},"error":{"type":"string"}}}}}},"403":{"description":"Default Response","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean"},"error":{"type":"string"}}}}}}}}},"/sinks/list":{"get":{"operationId":"listSinks","tags":\["Sinks"\],"responses":{"200":{"description":"Default Response"}}}},"/sinks/{name}/query":{"post":{"operationId":"querySink","summary":"Query sink in Mongo (structured filter)","tags":\["Sinks"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"filter":{"type":"object"},"limit":{"type":"integer","default":100}}}}}},"parameters":\[{"schema":{"type":"string"},"in":"path","name":"name","required":true}\],"responses":{"200":{"description":"Default Response"}}}},"/sinks/{name}/search":{"post":{"operationId":"searchSink","summary":"Semantic search in sink (Chroma)","tags":\["Sinks"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["q"\],"properties":{"q":{"type":"string"},"n":{"type":"integer","default":10},"where":{"type":"object"}}}}},"required":true},"parameters":\[{"schema":{"type":"string"},"in":"path","name":"name","required":true}\],"responses":{"200":{"description":"Default Response"}}}},"/users/create":{"post":{"operationId":"createUser","summary":"Create user","tags":\["Admin"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["username"\],"properties":{"username":{"type":"string"},"roles":{"type":"array","items":{"type":"string"}}}}}},"required":true},"responses":{"200":{"description":"Default Response"}}}},"/users/list":{"get":{"operationId":"listUsers","tags":\["Admin"\],"responses":{"200":{"description":"Default Response"}}}},"/users/delete":{"post":{"operationId":"deleteUser","tags":\["Admin"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["username"\],"properties":{"username":{"type":"string"}}}}},"required":true},"responses":{"200":{"description":"Default Response"}}}},"/policies/list":{"get":{"operationId":"listPolicies","tags":\["Admin"\],"responses":{"200":{"description":"Default Response"}}}},"/policies/create":{"post":{"operationId":"createPolicy","tags":\["Admin"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["role","action","resource"\],"properties":{"role":{"type":"string"},"action":{"type":"string"},"resource":{"type":"string"},"effect":{"type":"string","enum":\["allow","deny"\],"default":"allow"}}}}},"required":true},"responses":{"200":{"description":"Default Response"}}}},"/policies/delete":{"post":{"operationId":"deletePolicy","tags":\["Admin"\],"requestBody":{"content":{"application/json":{"schema":{"type":"object","required":\["id"\],"properties":{"id":{"type":"string"}}}}},"required":true},"responses":{"200":{"description":"Default Response"}}}}},"servers":\[{"url":"https://err-stealth-16-ai-studio-a1vgg.tailbe888a.ts.net"}\],"security":\[{"apiKey":\[\]}\]}

## ChatGPT
Nice—thanks for the spec drop. You can get this under 30 cleanly with a small, predictable surface and keep your internal handlers as‑is.

Here’s a pragmatic consolidation that preserves semantics but collapses paths by **resource + verb** (and a couple of RPC “ops” where it helps). Target: **18 routes**.

Proposed external surface (/v1)
===============================

Files (3)
---------

*   `GET /v1/files` — list (path, hidden, type)
    
*   `GET /v1/files/{path}` — view snippet (line, context)
    
*   `POST /v1/files/reindex` — reindex subset or all (body: { path?: string|string\[\] })
    

Search (3)
----------

*   `POST /v1/search/code` — grep (pattern, flags, paths, maxMatches, context)
    
*   `POST /v1/search/semantic` — Chroma (q, n)
    
*   `POST /v1/search/web` — web search (q, limit)
    

Symbols (2)
-----------

*   `POST /v1/symbols/index` — index (paths?, exclude?)
    
*   `POST /v1/symbols/find` — query (query, kind?, path?, limit?)
    

Indexer (3 → 2)
---------------

*   `GET /v1/indexer` — status
    
*   `POST /v1/indexer` — upsert jobs: `{ op: "index"|"remove"|"reset"|"reindex", path?: string }`
    
    *   (This collapses: `/indexer/index`, `/indexer/remove`, `/indexer/reset`, `/reindex`.)
        
    *   Return `{ ok, queued?, ignored?, error? }`
        

Agents (7 → 6)
--------------

*   `POST /v1/agents` — start (prompt, bypassApprovals, sandbox, tty, env)
    
*   `GET /v1/agents` — list
    
*   `GET /v1/agents/{id}` — status
    
*   `GET /v1/agents/{id}/logs` — logs (bytes?)
    
*   `GET /v1/agents/{id}/stream` — stream (SSE)
    
*   `POST /v1/agents/{id}` — control ops: `{ op: "send"|"interrupt"|"resume"|"kill", input? }`
    
    *   (Collapses `/send`, `/interrupt`, `/resume`, `/kill` into one.)
        

Exec (1)
--------

*   `POST /v1/exec` — run command (command, cwd?, env?, timeoutMs?, tty?)
    

Sinks (3 → 2)
-------------

*   `GET /v1/sinks` — list
    
*   `POST /v1/sinks/{name}` — `{ op: "query"|"search", filter?|q?, n?, where? }`
    

Admin (6 → 4)
-------------

*   `GET /v1/admin/users`
    
*   `POST /v1/admin/users` — create (username, roles?)
    
*   `DELETE /v1/admin/users/{username}`
    
*   `GET /v1/admin/policies`
    
*   `POST /v1/admin/policies` — create (role, action, resource, effect?)
    
*   `DELETE /v1/admin/policies/{id}`
    

(If you want to stay _well_ under 30, keep both Admin groups; that’s 18 total. If you need to shave further, collapse both Admin groups into one `POST /v1/admin` with `{ op: ..., ... }`.)

* * *

Old → New map (high‑value ones)
-------------------------------

*   `/files/list` → `GET /v1/files`
    
*   `/files/view` → `GET /v1/files/{path}`
    
*   `/files/reindex` + `/reindex` → `POST /v1/files/reindex` (body: paths or omit for all) **or** `POST /v1/indexer` with `op:"reindex"`
    
*   `/grep` → `POST /v1/search/code`
    
*   `/search` → `POST /v1/search/semantic`
    
*   `/search/web` → `POST /v1/search/web`
    
*   `/symbols/index` → `POST /v1/symbols/index`
    
*   `/symbols/find` → `POST /v1/symbols/find`
    
*   `/indexer/status` → `GET /v1/indexer`
    
*   `/indexer/index|remove|reset` → `POST /v1/indexer` with `op`
    
*   `/agent/start` → `POST /v1/agents`
    
*   `/agent/list` → `GET /v1/agents`
    
*   `/agent/status` + `/agent/status/{id}` → `GET /v1/agents/{id}`
    
*   `/agent/logs` + `/agent/tail` → `GET /v1/agents/{id}/logs`
    
*   `/agent/stream` → `GET /v1/agents/{id}/stream`
    
*   `/agent/send|interrupt|resume|kill` → `POST /v1/agents/{id}` with `op`
    
*   `/exec/run` → `POST /v1/exec`
    
*   `/sinks/list` → `GET /v1/sinks`
    
*   `/sinks/{name}/query|search` → `POST /v1/sinks/{name}` with `op`
    
*   `/users/*` → `GET/POST/DELETE /v1/admin/users{,/username}`
    
*   `/policies/*` → `GET/POST/DELETE /v1/admin/policies{,/id}`
    

* * *

Minimal OpenAPI 3.1 skeleton (showing the pattern)
--------------------------------------------------

```yaml
openapi: 3.1.0
info: { title: Promethean SmartGPT Bridge, version: 1.1.0 }
servers: [{ url: https://err-stealth-16-ai-studio-a1vgg.tailbe888a.ts.net/v1 }]
components:
  securitySchemes:
    apiKey: { type: apiKey, in: header, name: x-pi-token }
security: [{ apiKey: [] }]
paths:
  /files:
    get:
      summary: List files
      parameters:
        - in: query; name: path; schema: { type: string, default: "." }
        - in: query; name: hidden; schema: { type: boolean, default: false }
        - in: query; name: type; schema: { type: string, enum: [file, dir] }
      responses: { "200": { description: ok } }
  /files/{path}:
    get:
      summary: View file snippet
      parameters:
        - in: path; name: path; required: true; schema: { type: string }
        - in: query; name: line; schema: { type: integer, default: 1 }
        - in: query; name: context; schema: { type: integer, default: 25 }
      responses: { "200": { description: ok } }
  /files/reindex:
    post: { summary: Reindex subset or all, responses: { "200": { description: ok } } }

 /search/code:
    post: { summary: Grep code, responses: { "200": { description: ok } } }
  /search/semantic:
    post: { summary: Semantic search, responses: { "200": { description: ok } } }
  /search/web:
    post: { summary: Web search, responses: { "200": { description: ok } } }

 /symbols/index:
    post: { summary: Index symbols, responses: { "200": { description: ok } } }
  /symbols/find:
    post: { summary: Find symbols, responses: { "200": { description: ok } } }

 /indexer:
    get:  { summary: Indexer status, responses: { "200": { description: ok } } }
    post:
      summary: Indexer operations
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [op]
              properties:
                op: { type: string, enum: [index, remove, reset, reindex] }
                path: { type: string }
      responses: { "200": { description: ok } }

 /agents:
    get:  { summary: List agents, responses: { "200": { description: ok } } }
    post: { summary: Start agent, responses: { "200": { description: ok } } }
  /agents/{id}:
    get:  { summary: Agent status, responses: { "200": { description: ok } } }
    post:
      summary: Control agent
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [op]
              properties:
                op: { type: string, enum: [send, interrupt, resume, kill] }
                input: { type: string }
      responses: { "200": { description: ok } }
  /agents/{id}/logs:
    get:  { summary: Agent logs, responses: { "200": { description: ok } } }
  /agents/{id}/stream:
    get:  { summary: Agent stream, responses: { "200": { description: ok } } }

 /exec:
    post: { summary: Run command, responses: { "200": { description: ok } } }

 /sinks:
    get:  { summary: List sinks, responses: { "200": { description: ok } } }
  /sinks/{name}:
    post:
      summary: Sink ops
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [op]
              properties:
                op:   { type: string, enum: [query, search] }
                q:    { type: string }
                n:    { type: integer, default: 10 }
                where:{ type: object }
                filter:{ type: object }
      responses: { "200": { description: ok } }

 /admin/users:
    get:  { summary: List users, responses: { "200": { description: ok } } }
    post: { summary: Create user, responses: { "200": { description: ok } } }
  /admin/users/{username}:
    delete: { summary: Delete user, responses: { "200": { description: ok } } }
  /admin/policies:
    get:  { summary: List policies, responses: { "200": { description: ok } } }
    post: { summary: Create policy, responses: { "200": { description: ok } } }
  /admin/policies/{id}:
    delete: { summary: Delete policy, responses: { "200": { description: ok } } }
```

* * *

Router flow (mermaid)
---------------------

```mermaid
flowchart LR
  A[/Edge: /v1/* /] --> B{resource}
  B -->|files| F1[List] & F2[View] & F3[Reindex]
  B -->|search| S1[Code] & S2[Semantic] & S3[Web]
  B -->|symbols| Y1[Index] & Y2[Find]
  B -->|indexer| I1[GET status] & I2[POST op]
  B -->|agents| G1[POST start] & G2[GET list] & G3[GET status] & G4[logs/stream] & G5[POST op]
  B -->|exec|  X1[Run]
  B -->|sinks| K1[GET list] & K2[POST op]
  B -->|admin| A1[users] & A2[policies]
```
