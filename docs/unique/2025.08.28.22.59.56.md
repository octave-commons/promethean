---
task-id: TASK-20250828-230611-c9d2
title: Prepare-commit-msg hook for task/session trailers (non-linear history)
state: Blocked
prev: Breakdown
txn: 2025-08-28T23:06:11Z-c9d2
owner: err
priority: p2
size: m
epic: EPC-000
depends_on: ["TASK-20250828-230209-3b6e"]
labels: ["git:hooks","history:dag","lang:ts"]
due:
links: []
artifacts: []
rationale: "Commit messages should include task refs, session node, and graph parents so we can traverse a non-linear work DAG. Blocked pending policy on git hooks in this repo."
proposed_transitions: ["Blocked->Breakdown","Breakdown->Ready"]
hashtags:
  - task/TASK-20250828-230611-c9d2
  - board/kanban
  - state/Blocked
  - owner/err
  - priority/p2
  - epic/EPC-000
---

## Context
- We want a commit trailer set:
  - `Refs: task: TASK-xxxx`
  - `State: <From> -> <To>`
  - `Session: S-YYYY-MM-DD-## (node n#)`
  - `Graph-Parents: n1,n2`
- Hook should TUI-prompt for tasks and session node; fall back to last used.

## Blocked On
- [ ] Repo policy decision: allow `prepare-commit-msg` hook via repo tooling
- [ ] Cross-platform script path (Linux/macOS/WSL)

## Definition of Done
- [ ] Hook script lives at `tools/git/prepare-commit-msg.js`
- [ ] Select tasks (fuzzy search), select session node, confirm change type
- [ ] Writes trailers; safe if empty (no-op)
- [ ] Docs at `docs/ops/git-hooks.md`

## Plan (after unblocked)
1) Implement TUI (Node readline is fine; no heavy deps).
2) Persist last selections in `.promethean/session/last.json`.
3) Add installer: `bin/hooks install`.
4) Document usage.

#task/TASK-20250828-230611-c9d2
#board/kanban
#state/Blocked
#owner/err
#priority/p2
#epic/EPC-000
