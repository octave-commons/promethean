---
title: 'Fix Kanban UI Virtual Scroll MIME Type Error'
description: 'Resolve the MIME type error that causes the kanban UI page to be blank when virtual scrolling is enabled'
status: 'ready'
priority: 'P1'
tags: ['bug', 'frontend', 'kanban', 'ui', 'virtual-scroll', 'mime-type']
assignees: []
created_at: '2025-10-12T15:30:00Z'
updated_at: '2025-10-12T15:30:00Z'
uuid: 'kanban-ui-virtual-scroll-mime-fix'
---

## Task Overview

The kanban UI displays a blank page when virtual scrolling is enabled due to a MIME type error: "Loading module from 'http://127.0.0.1:4173/assets/virtual-scroll.js' was blocked because of a disallowed MIME type ('text/plain')". This prevents users from accessing the kanban board when there are enough tasks to trigger virtualization.

## Technical Analysis

### Root Cause

The issue is in `packages/kanban/src/frontend/virtual-scroll.ts` line 99. The `VIRTUAL_SCROLL_SCRIPT` constant contains a `<script type="module">` tag with inline JavaScript content. When this script is injected into the HTML via `getVirtualScrollScript()`, the browser attempts to parse it as an ES module, but since it's inline content rather than an external module file, it causes MIME type confusion and fails to load.

### Current Flow

1. `renderBoardHtml()` in `render.ts` calls `planVirtualScroll()` to determine if virtualization is needed
2. If virtualization is enabled, `getVirtualScrollScript()` is called (line 382)
3. `getVirtualScrollScript()` returns a `<script type="module">` tag with inline JavaScript
4. Browser tries to load this as a module but fails due to MIME type mismatch
5. Page renders blank as JavaScript execution fails

### Files Involved

- **Primary**: `packages/kanban/src/frontend/virtual-scroll.ts` (line 99)
- **Secondary**: `packages/kanban/src/frontend/render.ts` (lines 382-383)
- **Tertiary**: `packages/kanban/src/lib/ui-server.ts` (asset serving logic)

## Sub-Tasks

### 1. Fix Script Tag Type

- [ ] Change `<script type="module">` to `<script>` in `VIRTUAL_SCROLL_SCRIPT` constant
- [ ] Verify the inline JavaScript doesn't use module-specific features
- [ ] Test that virtual scrolling functionality still works after the change

### 2. Validate Virtual Scrolling Behavior

- [ ] Test with small boards (no virtualization) - ensure no regression
- [ ] Test with large boards (virtualization enabled) - ensure fix works
- [ ] Verify scroll performance and item rendering
- [ ] Test task selection and interaction in virtualized columns

### 3. Code Review and Cleanup

- [ ] Review if any other parts of the codebase assume module-type scripts
- [ ] Add comments explaining why regular script tags are used
- [ ] Consider adding unit tests for virtual scroll script generation

### 4. Documentation Update

- [ ] Update any documentation that mentions ES modules in the kanban UI
- [ ] Add troubleshooting notes for similar MIME type issues

## Definition of Done

### Functional Requirements

- [ ] Kanban UI loads without blank page when virtual scrolling is enabled
- [ ] Virtual scrolling works correctly for boards with 50+ tasks
- [ ] All existing kanban UI functionality remains intact (task selection, status updates, search, etc.)
- [ ] No console errors related to MIME types or module loading
- [ ] Performance is maintained for large boards

### Technical Requirements

- [ ] The `VIRTUAL_SCROLL_SCRIPT` uses `<script>` instead of `<script type="module">`
- [ ] All inline JavaScript executes properly in the browser context
- [ ] No regression in non-virtualized boards
- [ ] Code follows project's TypeScript and style guidelines
- [ ] Changes are minimal and focused on the specific issue

### Quality Assurance

- [ ] Manual testing with various board sizes (small, medium, large)
- [ ] Browser console shows no errors related to script loading
- [ ] Virtual scroll manager initializes correctly
- [ ] Task cards render and scroll smoothly in virtualized columns
- [ ] Memory usage remains reasonable for large boards

## Implementation Notes

### Key Considerations

1. **Script Context**: The inline script runs in the global scope, not as a module, so ensure no import/export statements are used
2. **Browser Compatibility**: Regular script tags have broader compatibility than ES modules
3. **Performance**: The change should not impact virtual scrolling performance
4. **Debugging**: Easier to debug inline scripts than modules in browser dev tools

### Risk Assessment

- **Low Risk**: The change is minimal and only affects script tag type
- **No Breaking Changes**: Existing functionality should remain intact
- **Easy Rollback**: Change can be easily reverted if issues arise

## Testing Strategy

### Manual Testing Steps

1. Start kanban UI: `pnpm kanban ui`
2. Test with small board (< 50 tasks) - should work without virtualization
3. Test with large board (> 100 tasks) - should enable virtualization
4. Verify no console errors related to MIME types
5. Test scrolling behavior in virtualized columns
6. Test task selection and interaction
7. Test board operations (refresh, search, status updates)

### Automated Testing

- [ ] Ensure existing kanban tests still pass
- [ ] Consider adding integration test for virtual scroll script generation

## Related Issues

- This affects any kanban board with enough tasks to trigger virtualization (typically > 50 tasks per column)
- Users see blank page instead of functional kanban board
- Console shows MIME type errors blocking script execution

## Dependencies

- None - this is a standalone fix that doesn't require changes to other components

## Blocked By

- None - this can be implemented immediately

## Blocking

- Users cannot effectively use kanban UI with large boards until this is fixed
