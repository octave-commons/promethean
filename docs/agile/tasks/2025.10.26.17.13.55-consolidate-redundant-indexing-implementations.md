# Consolidate Redundant Indexing Implementations

## Overview
Remove duplicate functionality across multiple indexers: file scanning (gatherRepoFiles vs scanFiles), embedding generation, collection management, and search operations.

## Context
Code review identified significant redundancy:
- File scanning: gatherRepoFiles() (indexer-core) vs scanFiles() (file-system)
- Embedding generation: Multiple embedding function implementations
- Collection management: createCollection() in multiple places
- Search operations: Different search implementations for each store
- State management: Multiple state persistence approaches

## Acceptance Criteria
- [ ] Single file scanning implementation
- [ ] Unified embedding generation
- [ ] Consolidated collection management
- [ ] Single search interface
- [ ] Unified state management
- [ ] Removal of duplicate code

## Implementation Plan
1. **Phase 1**: Audit and map all redundant functionality
2. **Phase 2**: Choose best implementations to keep
3. **Phase 3**: Create unified interfaces
4. **Phase 4**: Migrate consumers to unified implementations
5. **Phase 5**: Remove duplicate code

## Technical Details
### Redundancy Analysis
#### File Scanning
- `gatherRepoFiles()` in indexer-core/src/indexer.ts
- `scanFiles()` in file-system/src/scan-files.ts
- Both support include/exclude patterns and file metadata

#### Embedding Generation
- RemoteEmbeddingFunction in indexer-core
- Multiple embedding configurations across services
- Different embedding factory patterns

#### Collection Management
- createCollection() in multiple services
- Different collection naming conventions
- Inconsistent metadata handling

#### Search Operations
- search() in indexer-core
- compileContext() in contextStore
- Different query interfaces and result formats

### Consolidation Strategy
- Keep most robust implementation of each function
- Create adapter pattern for backward compatibility
- Deprecate old implementations gradually
- Add comprehensive tests for unified functions

## Dependencies
- Implement unified content model (prerequisite)
- Fix dual store consistency (prerequisite)

## Risks
- Breaking existing consumers
- Performance regressions
- Lost functionality during consolidation
- Complex migration process

## Tags
indexing,consolidation,redundancy,cleanup

## Complexity Score
8 (significant refactoring with multiple dependencies)

## Status
incoming
