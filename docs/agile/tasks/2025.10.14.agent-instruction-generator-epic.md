---
title: "Epic: Build Cross-Platform Clojure Agent Instruction Generator"
status: "incoming"
priority: "P0"
uuid: "epic-agent-instruction-generator-2025-10-14"
tags: ["epic", "clojure", "agent", "tool", "cross-platform", "bb", "nbb", "jvm", "shadow-cljs"]
created: "2025-10-14T00:00:00Z"
updated: "2025-10-14T00:00:00Z"
---

# Epic: Build Cross-Platform Clojure Agent Instruction Generator

## üéØ Problem Statement

The Promethean Framework currently maintains multiple agent instruction files (AGENTS.md, CLAUDE.md, CRUSH.md) manually, leading to:
- Inconsistent documentation across different agent types
- Manual synchronization overhead when updating agent capabilities
- Difficulty maintaining context-specific instructions for different environments
- Lack of dynamic generation based on current project state, task board, and file index

## üèóÔ∏è Solution Overview

Build a universal Clojure tool that generates comprehensive agent instruction files by:
1. **Reading environment variables** for context and configuration
2. **Integrating with the kanban system** to include current task board state
3. **Leveraging the file index** to understand project structure and available tools
4. **Generating context-aware instruction files** for different agent types and platforms

## üéØ Core Goals

### Primary Objectives
- **Cross-platform compatibility**: Work seamlessly with bb (Babashka), nbb, JVM Clojure, and shadow-cljs
- **Dynamic generation**: Create instruction files based on current project state
- **Context awareness**: Incorporate environment variables, task board data, and file index
- **Template-driven**: Support customizable templates for different agent types
- **Integration**: Seamlessly integrate with existing Promethean Framework systems

### Success Metrics
- Generated instruction files are 100% compatible with all target platforms
- Reduction in manual documentation maintenance by 80%
- Improved agent onboarding time by 50%
- Zero breaking changes to existing agent workflows

## üîß Technical Requirements

### Platform Compatibility
```clojure
;; Must support all these execution environments:
- bb (Babashka) - Native binary execution
- nbb (Node.js Babashka) - Node.js runtime  
- JVM Clojure - Full JVM with all libraries
- shadow-cljs - ClojureScript compilation target
```

### Data Sources Integration
1. **Environment Variables**
   - `AGENT_NAME`, `ENVIRONMENT`, `DEBUG_LEVEL`
   - Custom agent-specific configuration
   - Runtime context and capabilities

2. **Kanban System Integration**
   - Current task board state via `@promethean/kanban`
   - Active tasks, WIP limits, workflow status
   - Agent-specific task assignments and priorities

3. **File Index Integration**
   - Project structure analysis
   - Available tools and capabilities
   - Package dependencies and API surfaces

4. **Template System**
   - Markdown template engine
   - Conditional content based on agent type
   - Dynamic section generation

### Output Targets
- `AGENTS.md` - General agent framework documentation
- `CLAUDE.md` - Claude Code specific instructions  
- `CRUSH.md` - Development environment quick reference
- Custom agent instruction files (e.g., `SERENA.md`, `CODER.md`)

## üèõÔ∏è Architecture Design

### Core Components

```clojure
;; 1. Configuration Layer
ns promethean.agent-generator.config
- Environment variable parsing
- Platform detection
- Template discovery

;; 2. Data Collection Layer  
ns promethean.agent-generator.collectors
- Kanban board state collector
- File index analyzer
- Tool capability scanner

;; 3. Template Engine
ns promethean.agent-generator.templates
- Markdown template processing
- Conditional rendering
- Section composition

;; 4. Generator Core
ns promethean.agent-generator.core
- Orchestration logic
- Cross-platform compatibility layer
- Output formatting
```

### Cross-Platform Strategy

```clojure
;; Platform detection and adaptation
(defn detect-platform []
  (cond
    (bb-available?) :babashka
    (nbb-available?) :node-babashka  
    (jvm-available?) :jvm
    (cljs-available?) :clojurescript))

;; Conditional feature loading
(defn load-platform-features [platform]
  (case platform
    :babashka (load-babashka-features)
    :node-babashka (load-node-features)
    :jvm (load-jvm-features)
    :clojurescript (load-cljs-features)))
```

## üîó Integration Points

### Existing System Dependencies
1. **`@promethean/kanban`** - Task board data access
2. **`@promethean/markdown`** - Markdown processing utilities
3. **`@promethean/file-indexer`** - Project structure analysis
4. **`bb.edn` tasks** - Build system integration
5. **Environment configuration** - `.env.example`, `promethean.kanban.json`

### Data Flow Architecture
```
Environment Variables ‚Üí Configuration Layer
Kanban Board API ‚Üí Data Collection Layer  
File Index ‚Üí Data Collection Layer
Template Files ‚Üí Template Engine
‚Üì
Generator Core ‚Üí Output Files (AGENTS.md, CLAUDE.md, etc.)
```

## üìã Acceptance Criteria

### Functional Requirements
- [ ] **Platform Compatibility**: Tool runs successfully on bb, nbb, JVM Clojure, and shadow-cljs
- [ ] **Environment Integration**: Reads and processes all relevant environment variables
- [ ] **Kanban Integration**: Connects to kanban system and extracts current board state
- [ ] **File Index Integration**: Analyzes project structure and available tools
- [ ] **Template Processing**: Generates instruction files from configurable templates
- [ ] **Output Generation**: Produces valid, well-formatted instruction files
- [ ] **CLI Interface**: Provides command-line interface for manual generation
- [ ] **Automation Support**: Supports automated generation in build pipelines

### Quality Requirements  
- [ ] **Test Coverage**: Minimum 90% test coverage across all components
- [ ] **Documentation**: Complete API documentation and usage examples
- [ ] **Error Handling**: Graceful degradation when data sources are unavailable
- [ ] **Performance**: Generation completes within 5 seconds for typical projects
- [ ] **Backward Compatibility**: No breaking changes to existing agent workflows

### Integration Requirements
- [ ] **Build System**: Integrates with existing `bb.edn` tasks
- [ ] **CI/CD**: Works in automated build and deployment pipelines
- [ ] **Development Workflow**: Supports local development and testing
- [ ] **Configuration**: Uses existing project configuration patterns

## üß© Task Breakdown

### Phase 1: Foundation & Design (P0)
1. **Research & Architecture Design**
   - Analyze existing instruction file patterns
   - Design cross-platform compatibility layer
   - Define data collection interfaces
   - Create template specification

2. **Project Setup & Infrastructure**
   - Create new Clojure package structure
   - Set up cross-platform build configuration
   - Establish testing framework for all platforms
   - Configure CI/CD pipeline

### Phase 2: Core Implementation (P0)
3. **Configuration & Platform Detection**
   - Implement environment variable parsing
   - Build platform detection system
   - Create configuration management
   - Add platform-specific feature loading

4. **Data Collection Layer**
   - Implement kanban board collector
   - Build file index analyzer
   - Create tool capability scanner
   - Add data validation and error handling

5. **Template Engine**
   - Design template syntax and structure
   - Implement markdown template processor
   - Add conditional rendering capabilities
   - Create template validation system

### Phase 3: Integration & Generation (P1)
6. **Generator Core**
   - Implement orchestration logic
   - Build cross-platform compatibility layer
   - Add output formatting and validation
   - Create generation pipeline

7. **CLI Interface & Automation**
   - Build command-line interface
   - Add integration with bb.edn tasks
   - Implement automated generation hooks
   - Create configuration options

### Phase 4: Templates & Content (P1)
8. **Template Creation**
   - Create AGENTS.md template
   - Create CLAUDE.md template  
   - Create CRUSH.md template
   - Add custom agent template support

9. **Content Integration**
   - Map data sources to template variables
   - Implement dynamic content generation
   - Add context-aware section generation
   - Create content validation rules

### Phase 5: Testing & Documentation (P2)
10. **Comprehensive Testing**
    - Unit tests for all components
    - Integration tests with real data sources
    - Cross-platform compatibility tests
    - Performance and load testing

11. **Documentation & Examples**
    - Complete API documentation
    - Usage examples and tutorials
    - Migration guide for existing workflows
    - Troubleshooting and FAQ

### Phase 6: Deployment & Integration (P2)
12. **Production Deployment**
    - Package for all target platforms
    - Update build system integration
    - Deploy to production environments
    - Monitor and validate functionality

13. **Migration & Rollout**
    - Migrate existing instruction files
    - Update agent onboarding processes
    - Train team on new workflow
    - Establish maintenance procedures

## ‚ö†Ô∏è Risks & Mitigations

### Technical Risks
- **Cross-platform complexity**: Mitigate with comprehensive testing matrix
- **Data source availability**: Implement graceful degradation and fallbacks
- **Performance impact**: Use efficient data collection and caching strategies
- **Template maintenance**: Establish clear template versioning and validation

### Project Risks  
- **Scope creep**: Maintain strict focus on core requirements
- **Integration challenges**: Early and frequent integration testing
- **Adoption resistance**: Provide migration tools and comprehensive documentation

## üìÖ Timeline & Milestones

### Sprint 1 (2 weeks): Foundation
- Architecture design complete
- Project infrastructure set up
- Core interfaces defined

### Sprint 2 (3 weeks): Core Implementation  
- Configuration and platform detection
- Data collection layer
- Template engine basics

### Sprint 3 (3 weeks): Integration
- Generator core implementation
- CLI interface
- Basic template creation

### Sprint 4 (2 weeks): Polish & Testing
- Comprehensive testing
- Documentation completion
- Production deployment

**Total Estimated Duration: 10 weeks**

## üéØ Success Definition

This epic will be considered successful when:
1. The tool generates instruction files that are functionally equivalent to current manual files
2. All target platforms (bb, nbb, JVM, shadow-cljs) can execute the tool
3. Generated files incorporate real-time data from kanban board and file index
4. The development team can maintain and extend the system without breaking changes
5. Agent onboarding time is measurably reduced due to better contextual instructions

---

## üìù Notes

This epic represents a significant investment in developer experience and automation. The cross-platform nature and integration with existing systems make this a complex but high-value project that will pay dividends in reduced maintenance overhead and improved agent effectiveness.

The phased approach allows for early value delivery while managing technical complexity. Each phase builds upon the previous one, with clear acceptance criteria and risk mitigation strategies.