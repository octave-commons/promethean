---
uuid: "setup-generator-infrastructure-2025-10-14"
title: "Setup Agent Generator Project Infrastructure & Build System"
slug: "2025.10.14.setup-generator-project-infrastructure"
status: "incoming"
priority: "P0"
labels: ["infrastructure", "setup", "build-system", "clojure", "cross-platform", "epic:agent-instruction-generator"]
created_at: "2025-10-14T00:00:00Z"
estimates:
  complexity: ""
  scale: ""
  time_to_completion: ""
lastCommitSha: "deec21fe4553bb49020b6aa2bdfee1b89110f15d"
commitHistory: 
  - sha: "deec21fe4553bb49020b6aa2bdfee1b89110f15d"
    timestamp: "2025-10-19T16:27:40.274Z"
    action: "Bulk commit tracking initialization"
---

# Setup Agent Generator Project Infrastructure & Build System

## ğŸ¯ Objective

Establish the complete project infrastructure for the cross-platform Clojure agent instruction generator, including package structure, build configuration, testing framework, and CI/CD pipeline integration.

## ğŸ“‹ Acceptance Criteria

### Project Structure Requirements
- [ ] **Package Creation**: New Clojure package `@promethean/agent-generator` with proper structure
- [ ] **Cross-Platform Build**: Build configuration supporting bb, nbb, JVM, and shadow-cljs
- [ ] **Testing Framework**: Comprehensive testing setup for all target platforms
- [ ] **Documentation Structure**: Complete documentation and API documentation setup
- [ ] **CI/CD Integration**: Automated build, test, and deployment pipeline
- [ ] **Tool Integration**: Integration with existing bb.edn tasks and project tooling

### Infrastructure Deliverables
- [ ] **Package Structure**: Complete directory structure following Promethean conventions
- [ ] **Build Configuration**: All build files (deps.edn, bb.edn, shadow-cljs.edn, package.json)
- [ ] **Testing Setup**: Test configuration and example tests for all platforms
- [ ] **CI/CD Pipeline**: GitHub Actions workflow for automated testing and deployment
- [ ] **Documentation Setup**: API docs, README, and integration guides
- [ ] **Development Tools**: Linting, formatting, and development tooling configuration

## ğŸ“ Project Structure Design

### Package Directory Structure

```
packages/agent-generator/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ promethean/
â”‚       â””â”€â”€ agent_generator/
â”‚           â”œâ”€â”€ platform/
â”‚           â”‚   â”œâ”€â”€ adapters/
â”‚           â”‚   â”‚   â”œâ”€â”€ babashka.clj
â”‚           â”‚   â”‚   â”œâ”€â”€ node_babashka.clj
â”‚           â”‚   â”‚   â”œâ”€â”€ jvm.clj
â”‚           â”‚   â”‚   â””â”€â”€ clojurescript.cljs
â”‚           â”‚   â”œâ”€â”€ core.clj
â”‚           â”‚   â””â”€â”€ detection.clj
â”‚           â”œâ”€â”€ config/
â”‚           â”‚   â”œâ”€â”€ core.clj
â”‚           â”‚   â”œâ”€â”€ sources.clj
â”‚           â”‚   â””â”€â”€ validation.clj
â”‚           â”œâ”€â”€ collectors/
â”‚           â”‚   â”œâ”€â”€ environment.clj
â”‚           â”‚   â”œâ”€â”€ kanban.clj
â”‚           â”‚   â”œâ”€â”€ file_index.clj
â”‚           â”‚   â””â”€â”€ core.clj
â”‚           â”œâ”€â”€ templates/
â”‚           â”‚   â”œâ”€â”€ engine.clj
â”‚           â”‚   â”œâ”€â”€ loader.clj
â”‚           â”‚   â””â”€â”€ renderer.clj
â”‚           â”œâ”€â”€ generator/
â”‚           â”‚   â”œâ”€â”€ core.clj
â”‚           â”‚   â”œâ”€â”€ orchestrator.clj
â”‚           â”‚   â””â”€â”€ output.clj
â”‚           â””â”€â”€ cli/
â”‚               â”œâ”€â”€ core.clj
â”‚               â””â”€â”€ commands.clj
â”œâ”€â”€ test/
â”‚   â””â”€â”€ promethean/
â”‚       â””â”€â”€ agent_generator/
â”‚           â”œâ”€â”€ platform/
â”‚           â”œâ”€â”€ config/
â”‚           â”œâ”€â”€ collectors/
â”‚           â”œâ”€â”€ templates/
â”‚           â”œâ”€â”€ generator/
â”‚           â””â”€â”€ integration/
â”œâ”€â”€ resources/
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ agents.md.template
â”‚   â”‚   â”œâ”€â”€ claude.md.template
â”‚   â”‚   â”œâ”€â”€ crush.md.template
â”‚   â”‚   â””â”€â”€ custom/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ default.edn
â”‚   â””â”€â”€ schemas/
â”‚       â””â”€â”€ config.edn
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ examples/
â”‚   â””â”€â”€ guides/
â”œâ”€â”€ bb.edn
â”œâ”€â”€ deps.edn
â”œâ”€â”€ shadow-cljs.edn
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ README.md
â”œâ”€â”€ CHANGELOG.md
â””â”€â”€ .github/
    â””â”€â”€ workflows/
        â”œâ”€â”€ test.yml
        â”œâ”€â”€ build.yml
        â””â”€â”€ deploy.yml
```

## ğŸ”§ Build Configuration

### 1. deps.edn (JVM Clojure)

```clojure
{:paths ["src" "resources" "test"]
 :deps {org.clojure/clojure {:mvn/version "1.11.1"}
        org.clojure/data.json {:mvn/version "2.4.0"}
        org.clojure/tools.logging {:mvn/version "1.2.4"}
        http-kit/http-kit {:mvn/version "2.6.0"}
        cheshire/cheshire {:mvn/version "5.11.0"}
        selmer/selmer {:mvn/version "1.12.50"}
        @promethean/kanban {:local/root "../kanban"}
        @promethean/markdown {:local/root "../markdown"}
        @promethean/utils {:local/root "../utils"}}
 
 :aliases {:test {:extra-paths ["test"]
                  :extra-deps {io.github.cognitect-labs/test-runner
                               {:git/tag "v0.5.1" :git/sha "dfb30dd"}}
                  :main-opts ["-m" "cognitect.test-runner"]
                  :exec-fn cognitect.test-runner.api/test}
           :build {:deps {io.github.seancorfield/build-clj
                          {:git/tag "v0.9.2" :git/sha "7c8e5e4"}}
                   :ns-default build}
           :dev {:extra-paths ["dev"]
                 :extra-deps {org.clojure/tools.namespace {:mvn/version "1.4.4"}}}}
```

### 2. bb.edn (Babashka)

```clojure
{:paths ["bb/src" "src" "resources" "test"]
 :tasks {;; Core tasks
         test {:doc "Run all tests"
               :task (run-tests)}
         build {:doc "Build the project"
                :task (build-project)}
         clean {:doc "Clean build artifacts"
                :task (clean-project)}
         
         ;; Platform-specific tasks
         test:bb {:doc "Test on Babashka"
                  :task (test-on-platform :babashka)}
         test:nbb {:doc "Test on Node Babashka"
                   :task (test-on-platform :node-babashka)}
         test:jvm {:doc "Test on JVM"
                   :task (test-on-platform :jvm)}
         
         ;; Development tasks
         dev:bb {:doc "Start development REPL with Babashka"
                 :task (start-dev-repl :babashka)}
         dev:nbb {:doc "Start development REPL with Node Babashka"
                  :task (start-dev-repl :node-babashka)}
         
         ;; Integration tasks
         test:cross-platform {:doc "Test on all platforms"
                              :task (run-cross-platform-tests)}
         build:all {:doc "Build for all platforms"
                    :task (build-all-platforms)}}}
```

### 3. shadow-cljs.edn (ClojureScript)

```clojure
{:source-paths ["src" "resources"]
 :dependencies [[org.clojure/clojure "1.11.1"]
                [org.clojure/clojurescript "1.11.60"]
                [cljs-http "0.1.46"]
                [reagent "1.2.0"]
                @promethean/kanban
                @promethean/markdown
                @promethean/utils]
 
 :builds {:agent-generator {:target :node-script
                            :output-to "dist/agent-generator.js"
                            :main promethean.agent-generator.cli/main
                            :compiler-options {:optimizations :simple}
                            :devtools {:after-load promethean.agent-generator.cli/reload!}}}}
```

### 4. package.json (Node.js Integration)

```json
{
  "name": "@promethean/agent-generator",
  "version": "0.1.0",
  "description": "Cross-platform Clojure agent instruction generator",
  "type": "module",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js"
    },
    "./lib/*": {
      "types": "./dist/lib/*.d.ts",
      "import": "./dist/lib/*.js"
    }
  },
  "bin": {
    "agent-generator": "dist/cli.js"
  },
  "scripts": {
    "build": "pnpm run build:cljs && pnpm run build:types",
    "build:cljs": "shadow-cljs release agent-generator",
    "build:types": "tsc --emitDeclarationOnly",
    "test": "pnpm run test:bb && pnpm run test:nbb && pnpm run test:jvm",
    "test:bb": "bb test:bb",
    "test:nbb": "bb test:nbb", 
    "test:jvm": "bb test:jvm",
    "dev": "shadow-cljs watch agent-generator",
    "clean": "shadow-cljs clean && rm -rf dist",
    "lint": "clj-kondo --lint src test",
    "format": "cljfmt fix src test"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "shadow-cljs": "^2.28.17",
    "typescript": "^5.4.0",
    "clj-kondo": "^2023.10.20",
    "cljfmt": "^0.10.0"
  },
  "peerDependencies": {
    "@promethean/kanban": "workspace:*",
    "@promethean/markdown": "workspace:*",
    "@promethean/utils": "workspace:*"
  }
}
```

## ğŸ§ª Testing Framework Setup

### Test Configuration by Platform

```clojure
;; test/promethean/agent_generator/platform_test.clj
(ns promethean.agent-generator.platform-test
  (:require [clojure.test :refer [deftest testing is]]
            [promethean.agent-generator.platform :as platform]))

(deftest platform-detection-test
  (testing "Platform detection works correctly"
    (let [detected (platform/detect-platform)]
      (is (contains? #{:babashka :node-babashka :jvm :clojurescript} detected)))))

(deftest platform-adapter-test
  (testing "Platform adapter provides required features"
    (let [adapter (platform/create-platform-adapter)]
      (is (satisfies? platform/PlatformFeatures adapter))
      (is (seq (platform/available-features adapter))))))
```

### Cross-Platform Test Runner

```clojure
;; bb/test_runner.clj
(ns bb.test-runner
  (:require [babashka.process :as process]
            [clojure.string :as str]))

(defn run-platform-tests [platform]
  (println "Running tests for platform:" platform)
  (let [result (process/shell {:continue true}
                             (case platform
                               :babashka "bb test:bb"
                               :node-babashka "bb test:nbb"
                               :jvm "bb test:jvm"
                               :clojurescript "npm test"))]
    (if (zero? (:exit result))
      (println "âœ… Tests passed for" platform)
      (println "âŒ Tests failed for" platform (:err result)))
    result))

(defn run-all-tests []
  (println "ğŸ§ª Running cross-platform test suite...")
  (let [platforms [:babashka :node-babashka :jvm]
        results (mapv run-platform-tests platforms)]
    (if (every? #(zero? (:exit %)) results)
      (println "ğŸ‰ All tests passed!")
      (println "ğŸ’¥ Some tests failed!"))
    results))
```

## ğŸš€ CI/CD Pipeline Configuration

### GitHub Actions Workflow

```yaml
# .github/workflows/test.yml
name: Test Agent Generator

on:
  push:
    branches: [main, develop]
    paths: ['packages/agent-generator/**']
  pull_request:
    branches: [main]
    paths: ['packages/agent-generator/**']

jobs:
  test-babashka:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Babashka
        uses: babashka/setup-babashka@v1
        with:
          babashka-version: 1.3.190
      - name: Install dependencies
        run: |
          cd packages/agent-generator
          bb deps
      - name: Run tests
        run: |
          cd packages/agent-generator
          bb test:bb

  test-node-babashka:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
      - name: Install dependencies
        run: |
          cd packages/agent-generator
          pnpm install
      - name: Run tests
        run: |
          cd packages/agent-generator
          bb test:nbb

  test-jvm:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '21'
      - name: Install Clojure CLI
        uses: DeLaGuardo/setup-clojure@v12
        with:
          cli: latest
      - name: Run tests
        run: |
          cd packages/agent-generator
          bb test:jvm

  build-and-deploy:
    needs: [test-babashka, test-node-babashka, test-jvm]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
      - name: Build project
        run: |
          cd packages/agent-generator
          pnpm build
      - name: Deploy to npm
        run: |
          cd packages/agent-generator
          pnpm publish --no-git-checks
        env:
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
```

## ğŸ“š Documentation Setup

### README.md Structure

```markdown
# @promethean/agent-generator

Cross-platform Clojure tool for generating agent instruction files from environment variables, kanban board state, and file index.

## Features

- ğŸ”„ **Cross-Platform**: Works with bb, nbb, JVM Clojure, and shadow-cljs
- ğŸ¯ **Dynamic Generation**: Creates context-aware instruction files
- ğŸ”— **System Integration**: Integrates with kanban and file index systems
- ğŸ“ **Template-Driven**: Customizable templates for different agent types
- ğŸ› ï¸ **CLI Interface**: Command-line tool for manual and automated use

## Quick Start

### Installation
```bash
pnpm add @promethean/agent-generator
```

### Usage
```bash
# Generate all instruction files
agent-generator generate

# Generate specific file
agent-generator generate --template claude

# Custom configuration
agent-generator generate --config ./custom-config.edn
```

## Platforms

| Platform | Status | Notes |
|----------|--------|-------|
| Babashka (bb) | âœ… | Full support |
| Node Babashka (nbb) | âœ… | Full support |
| JVM Clojure | âœ… | Full support |
| ClojureScript | âœ… | Node.js target |

## Documentation

- [API Reference](./docs/api/)
- [Configuration Guide](./docs/guides/configuration.md)
- [Template Development](./docs/guides/templates.md)
- [Platform Specifics](./docs/guides/platforms.md)
```

### API Documentation Setup

```clojure
;; docs/api/core.clj
(ns docs.api.core
  (:require [promethean.agent-generator.core :as core]))

(defn generate-docs []
  "Generate API documentation"
  ;; Implementation for generating API docs
  )
```

## ğŸ”§ Development Tools Configuration

### Linting Configuration

```clojure
;; .clj-kondo/config.edn
{:linters {:unused-namespace {:level :warning}
           :unused-binding {:level :warning}
           :refer-all {:level :warning}}
 :config-paths ["../resources/clj-kondo"]}
```

### Formatting Configuration

```clojure
;; .cljfmt.edn
{:indents {defprotocol [[:inner 0]]
           defrecord [[:inner 0]]
           deftype [[:inner 0]]
           defmethod [[:inner 0]]
           letfn [[:inner 0]]}}
```

## ğŸ“‹ Implementation Tasks

### Phase 1: Basic Infrastructure (Days 1-2)
1. **Create Package Structure**
   - Set up directory structure
   - Create initial namespace files
   - Add basic documentation

2. **Configure Build Systems**
   - Set up deps.edn for JVM
   - Configure bb.edn for Babashka
   - Set up shadow-cljs.edn for ClojureScript
   - Create package.json for Node.js integration

### Phase 2: Testing Framework (Days 3-4)
1. **Test Configuration**
   - Set up test framework for all platforms
   - Create cross-platform test runner
   - Add example tests

2. **CI/CD Pipeline**
   - Configure GitHub Actions
   - Set up automated testing
   - Configure deployment pipeline

### Phase 3: Development Tools (Days 5-6)
1. **Tooling Setup**
   - Configure linting and formatting
   - Set up documentation generation
   - Add development scripts

2. **Integration**
   - Integrate with existing bb.edn tasks
   - Add to project tooling
   - Test cross-platform compatibility

## ğŸ¯ Success Metrics

- **Infrastructure Complete**: All build configurations working
- **Testing Coverage**: Test framework operational for all platforms
- **CI/CD Functional**: Automated pipeline passing
- **Documentation Ready**: Complete API and user documentation
- **Integration Success**: Seamless integration with existing tooling

## âš ï¸ Risks & Mitigations

### Technical Risks
- **Build Complexity**: Mitigate with incremental setup and testing
- **Platform Differences**: Use abstraction layer and feature detection
- **Dependency Conflicts**: Careful dependency management and versioning

### Project Risks
- **Timeline Pressure**: Focus on core infrastructure first
- **Integration Challenges**: Early testing with existing systems
- **Maintenance Overhead**: Clear documentation and standardized setup

---

This infrastructure setup provides the solid foundation needed for implementing the cross-platform agent instruction generator. The comprehensive build configuration, testing framework, and CI/CD pipeline ensure reliable development and deployment across all target platforms.
