---
title: Implement shared auth and RBAC for omni-service
description: Add authentication and role-based access control that can be shared across REST, GraphQL, WebSocket, and MCP adapters
type: implementation
priority: P2
points: 5
status: todo
tags: [omni, service, auth, rbac, security]
dependencies: [create-omni-service-package]
assignees: []
created: 2025-10-08T16:05:00.000Z
updated: 2025-10-08T16:05:00.000Z
---

## Context

The omni-service needs a unified authentication and authorization system that can be shared across all adapters (REST, GraphQL, WebSocket, MCP). This ensures consistent security policies and avoids duplicate auth logic.

## Definition of Done

- [ ] JWT-based authentication middleware
- [ ] Role-based access control (RBAC) system
- [ ] User context injection for all requests
- [ ] Permission checking utilities
- [ ] Auth configuration management
- [ ] Unit tests for auth flows

## Technical Details

**Auth Features:**

- JWT token validation and refresh
- Role hierarchy (admin, user, readonly, etc.)
- Resource-based permissions
- API key support for service-to-service auth
- Session management for WebSocket connections

**RBAC Structure:**

```typescript
interface Role {
  name: string;
  permissions: Permission[];
}

interface Permission {
  resource: string;
  actions: ('read' | 'write' | 'delete' | 'admin')[];
}
```

**Middleware Integration:**

- Fastify hooks for request auth
- GraphQL context auth
- WebSocket connection auth
- MCP HTTP transport auth

## Acceptance Criteria

- JWT tokens are validated correctly
- Role permissions are enforced
- Unauthorized requests are rejected with 401/403
- Auth context is available in all adapters
- Configuration supports multiple auth providers
- Tests cover auth success and failure scenarios
