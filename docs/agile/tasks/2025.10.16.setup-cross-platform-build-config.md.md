---
uuid: "task-setup-cross-platform-build-2025-10-16"
title: "Set Up Cross-Platform Build Configuration"
slug: "2025.10.16.setup-cross-platform-build-config.md"
status: "ready"
priority: "P0"
labels: ["build", "configuration", "cross-platform", "infrastructure"]
created_at: "2025-10-16T00:00:00Z"
estimates:
  complexity: ""
  scale: ""
  time_to_completion: ""
---

# Task: Set Up Cross-Platform Build Configuration

## üéØ Objective

Configure bb.edn, deps.edn, and shadow-cljs.edn for seamless building across all target platforms.

## üìã Description

This task involves setting up comprehensive build configurations that work across bb (Babashka), nbb, JVM Clojure, and shadow-cljs. The configuration must handle platform-specific dependencies, build tasks, and deployment requirements while maintaining consistency.

## ‚úÖ Acceptance Criteria

- [ ] bb.edn configuration complete with all necessary tasks
- [ ] deps.edn with proper dependencies and aliases
- [ ] shadow-cljs.edn for ClojureScript support
- [ ] Cross-platform build testing working
- [ ] CI/CD pipeline integration configured

## üîß Technical Requirements

### bb.edn Configuration

```clojure
{:bbin/version "0.1.0"
 :tasks
 {;; Core generation tasks
  generate {:doc "Generate agent instruction files"
            :task promethean.agent-generator.cli/generate}
  generate-all {:doc "Generate all instruction files"
               :task promethean.agent-generator.cli/generate-all}

  ;; Development tasks
  test {:doc "Run tests"
        :task promethean.agent-generator.test/run-all}
  test-coverage {:doc "Run tests with coverage"
                 :task promethean.agent-generator.test/with-coverage}

  ;; Build tasks
  build {:doc "Build for all platforms"
         :task promethean.agent-generator.build/build-all}
  build-bb {:doc "Build for Babashka"
            :task promethean.agent-generator.build/build-bb}
  build-cljs {:doc "Build for ClojureScript"
              :task promethean.agent-generator.build/build-cljs}

  ;; Utility tasks
  clean {:doc "Clean build artifacts"
         :task promethean.agent-generator.build/clean}
  validate {:doc "Validate configuration and templates"
            :task promethean.agent-generator.validation/validate-all}}}
```

### deps.edn Configuration

```clojure
{:paths ["src" "resources"]
 :deps {org.clojure/clojure {:mvn/version "1.11.1"}
        ;; Template processing
        selmer {:mvn/version "1.12.50"}
        ;; Data validation
        malli {:mvn/version "0.13.0"}
        ;; File system operations
        babashka/fs {:mvn/version "0.4.19"}
        ;; JSON processing
        cheshire {:mvn/version "5.11.0"}
        ;; HTTP client for API calls
        clj-http {:mvn/version "3.12.3"}
        ;; Configuration management
        aero {:mvn/version "1.1.6"}}

 :aliases
 {:test {:extra-paths ["test"]
         :extra-deps {io.github.cognitect-labs/test-runner
                      {:git/tag "v0.5.1" :git/sha "dfb30dd"}}}

  :dev {:extra-paths ["dev"]
        :extra-deps {org.clojure/tools.namespace {:mvn/version "1.4.4"}
                     cider/cider-nrepl {:mvn/version "0.30.0"}}}

  :build {:deps {io.github.seancorfield/build-clj
                 {:git/tag "v0.9.2" :git/sha "9c9f078"}}
          :ns-default build}

  :native-image {:extra-deps {com.github.clj-easy/graal-build-time
                              {:mvn/version "1.0.5"}}}}}
```

### shadow-cljs.edn Configuration

```clojure
{:source-paths ["src" "test"]
 :dependencies [[org.clojure/clojurescript "1.11.60"]
                [selmer "1.12.50"]
                [malli "0.13.0"]]

 :builds
 {:agent-generator
  {:target :node-script
   :main promethean.agent-generator.core/main
   :output-to "out/agent-generator.js"
   :output-dir "out"
   :compiler-options {:optimizations :simple
                     :target :nodejs
                     :nodejs-rt true}}

  :test
  {:target :node-test
   :output-to "out/test.js"
   :ns-regexp "-test$"
   :autorun true}}}
```

## üèóÔ∏è Implementation Approach

1. **Platform Analysis**: Understand build requirements for each platform
2. **Dependency Management**: Configure dependencies for all platforms
3. **Task Definition**: Create comprehensive build tasks
4. **Testing Setup**: Configure test runners for all platforms
5. **CI/CD Integration**: Set up automated builds
6. **Validation**: Test builds across all platforms

## üìä Deliverables

1. **Complete Build Configuration**

   - bb.edn with all tasks and dependencies
   - deps.edn with proper dependency management
   - shadow-cljs.edn for ClojureScript builds

2. **Build Scripts**

   - Platform-specific build scripts
   - Automated build pipeline
   - Deployment scripts

3. **Testing Configuration**

   - Test runners for all platforms
   - Coverage reporting setup
   - Integration test configuration

4. **Documentation**
   - Build instructions per platform
   - Development setup guide
   - Troubleshooting guide

## üîó Dependencies

- **Create Clojure Package Structure** (must have package structure first)

## ‚ö†Ô∏è Risks & Mitigations

- **Dependency Conflicts**: Carefully manage dependency versions across platforms
- **Build Failures**: Implement comprehensive testing and validation
- **Platform-Specific Issues**: Test thoroughly on each target platform
- **Configuration Complexity**: Keep configurations as simple as possible

## üìà Success Metrics

- All platforms build successfully
- Comprehensive test coverage
- Automated CI/CD pipeline working
- Clear documentation for developers

---

**Epic**: Build Cross-Platform Clojure Agent Instruction Generator  
**Phase**: Phase 2: Infrastructure  
**Story Points**: 5
