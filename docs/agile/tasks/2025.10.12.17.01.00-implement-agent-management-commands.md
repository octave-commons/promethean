---
uuid: "assign-002"
title: "Implement Agent Management Commands"
slug: "2025.10.12.17.01.00-implement-agent-management-commands"
status: "incoming"
priority: "P1"
labels: ["kanban", "cli", "agent-management", "monitoring", "frontend"]
created_at: "2025-10-13T05:26:52.432Z"
estimates:
  complexity: ""
  scale: ""
  time_to_completion: ""
---

## Overview

Implement comprehensive agent management commands that work alongside the kanban assign functionality. These commands will provide visibility into running agents, enable communication with agents, and support agent lifecycle management.

## Description

Create a suite of agent management commands:
- `kanban agents list` - List all running agents with their status
- `kanban agents send <agent-id> <message>` - Send updates to running agents
- `kanban agents pause <agent-id>` - Pause running agents
- `kanban agents resume <agent-id>` - Resume paused agents
- `kanban agents status <agent-id>` - Get detailed agent status

## Definition of Done

- [ ] All agent management commands implemented and functional
- [ ] Real-time agent status monitoring and reporting
- [ ] Agent communication interface for sending updates
- [ ] Agent pause/resume functionality with state preservation
- [ ] Integration with opencode session manager for agent tracking
- [ ] Proper error handling for agent communication failures
- [ ] Comprehensive test coverage for all agent operations
- [ ] Documentation with usage examples and troubleshooting

## Subtasks

### 1. Agent Discovery & Listing
- [ ] Implement agent discovery mechanism
- [ ] Create agent status tracking system
- [ ] Build `agents list` command with filtering options
- [ ] Add agent metadata display (session id, assigned task, status)

### 2. Agent Communication
- [ ] Implement `agents send` command for message delivery
- [ ] Create agent message queuing system
- [ ] Add support for different message types (updates, commands)
- [ ] Handle message delivery confirmation and retries

### 3. Agent Lifecycle Management
- [ ] Implement `agents pause` with state preservation
- [ ] Implement `agents resume` with state restoration
- [ ] Create `agents status` for detailed agent information
- [ ] Add agent health monitoring and reporting

### 4. Integration & Monitoring
- [ ] Integrate with opencode session manager
- [ ] Create agent event logging and audit trail
- [ ] Implement agent performance metrics collection
- [ ] Add agent dependency tracking

## Technical Requirements

### Dependencies
- `@promethean/kanban` - existing kanban system
- `@promethean/opencode-session-manager` - opencode client SDK
- `@promethean/heartbeat` - agent health monitoring
- Process management utilities (PM2 integration)

### Integration Points
- Extend `packages/kanban/src/cli/command-handlers.ts`
- Create new `packages/kanban/src/lib/agent-management.ts`
- Integrate with existing session management
- Use existing error handling patterns

### API Design
```bash
# List all agents
pnpm kanban agents list
pnpm kanban agents list --status running
pnpm kanban agents list --assigned

# Send messages to agents
pnpm kanban agents send <agent-id> "update message"
pnpm kanban agents send <agent-id> --file /path/to/message.json

# Agent lifecycle management
pnpm kanban agents pause <agent-id>
pnpm kanban agents resume <agent-id>
pnpm kanban agents status <agent-id>

# Agent monitoring
pnpm kanban agents health
pnpm kanban agents metrics <agent-id>
```

## Context & Resources

### Related Files
- `packages/kanban/src/cli/command-handlers.ts` - command handlers
- `packages/kanban/src/lib/kanban.ts` - core kanban functions
- `packages/opencode-session-manager/src/opencode/client.ts` - opencode SDK
- `packages/heartbeat/` - agent health monitoring
- `ecosystem.agents.config.js` - PM2 configuration

### Documentation
- `docs/agile/kanban-cli-reference.md` - CLI documentation
- `AGENTS.md` - agent management patterns
- Agent launch workflows documentation

### External Dependencies
- PM2 process management
- Opencode session management
- Git worktree management (from assign command)

## Notes & Considerations

### Agent Discovery
- Use PM2 process list for agent discovery
- Cross-reference with opencode sessions
- Validate agent health and responsiveness
- Handle agent startup/shutdown race conditions

### Communication Protocols
- Support both synchronous and asynchronous messaging
- Implement message acknowledgment and retry logic
- Handle agent offline scenarios gracefully
- Provide message delivery status feedback

### State Management
- Preserve agent state during pause/resume cycles
- Track agent assignments and task progress
- Maintain audit trail of agent operations
- Handle agent crash recovery scenarios

### Performance Considerations
- Efficient agent status polling
- Minimal overhead on agent operations
- Scalable communication for multiple agents
- Resource cleanup for terminated agents

## Testing Requirements

### Unit Tests
- Agent discovery and listing functionality
- Message delivery and acknowledgment
- Agent pause/resume state management
- Error handling for communication failures

### Integration Tests
- End-to-end agent management workflows
- PM2 integration testing
- Opencode session synchronization
- Multi-agent coordination scenarios

### Test Fixtures
- Mock agent processes and sessions
- Simulated agent states and responses
- Test PM2 configuration
- Git repository setup for agent testing

## Blocking Tasks

- [ ] 2025.10.12.17.00.00-implement-kanban-assign-command-core-functionality

## Tasks This Blocks

- [ ] 2025.10.12.17.02.00-add-task-unassignment-functionality
- [ ] 2025.10.12.17.04.00-implement-assignment-workflow-automation
- [ ] 2025.10.12.17.05.00-create-agent-management-ui

## Success Metrics

- All agent management commands work reliably
- Real-time agent status accurately reflected
- Agent communication delivered with confirmation
- Agent pause/resume preserves state correctly
- Integration tests pass for all agent workflows
- Performance acceptable for multi-agent scenarios
