---
title: Expand retry utility coverage for backoff and hooks
description: Add regression tests covering custom backoff calculations and onRetry callbacks in @promethean/utils retry helper.
type: quality
priority: P3
points: 2
status: in_review
tags: [utils, testing, retry]
dependencies: []
assignees: []
created: 2025-10-08T23:58:30.000Z
updated: 2025-10-09T00:04:37.000Z
---

## Context

The `retry` helper in `@promethean/utils` already retries transient failures, but we lack
coverage for the `backoff` and `onRetry` options. Adding tests now guards against regressions
when tuning retry behavior.

## Definition of Done

- [x] Add AVA tests that verify `onRetry` receives the error, attempt count, and computed delay.
- [x] Add coverage ensuring custom `backoff` functions determine the delay passed to `sleep`.
- [x] Keep retry tests deterministic and fast (<50ms each).
- [x] All `@promethean/utils` tests continue to pass.

## Implementation Notes

- Exercises `backoff` with deterministic sequences (e.g., incremental delays) and assert via the `onRetry` hook.
- Use zero or low delays to maintain quick runtimes.
- Reuse existing retry helper exports from the package index; do not mock internals.
