---
title: "Add Task Unassignment Functionality"
status: "incoming"
priority: "P1"
tags: ["kanban", "cli", "agent-management", "cleanup", "frontend"]
uuid: "assign-003"
---

## Overview

Implement task unassignment functionality that allows agents to be removed from tasks, cleans up assignment metadata, and handles git worktree cleanup for isolated environments.

## Description

Create comprehensive unassignment capabilities:
- `kanban unassign <task-uuid>` - Remove agent assignment from task
- `kanban unassign <task-uuid> --force` - Force unassignment regardless of agent state
- `kanban unassign --agent <agent-id>` - Unassign all tasks from specific agent
- Cleanup of opencode sessions and git worktrees
- Proper task status transitions after unassignment

## Definition of Done

- [ ] `kanban unassign` command implemented with all variants
- [ ] Task frontmatter cleaned of assignment metadata
- [ ] Opencode sessions properly closed or archived
- [ ] Git worktrees cleaned up for isolated assignments
- [ ] Agent notification of unassignment
- [ ] Task status transitions handled appropriately
- [ ] Comprehensive error handling and validation
- [ ] Full test coverage for unassignment scenarios
- [ ] Documentation with usage examples

## Subtasks

### 1. Core Unassignment Logic
- [ ] Implement basic task unassignment functionality
- [ ] Handle task frontmatter cleanup (remove assigned_agent, session_id)
- [ ] Validate unassignment permissions and constraints
- [ ] Implement force unassignment for emergency scenarios

### 2. Agent Communication
- [ ] Notify agents of task unassignment
- [ ] Handle agent acknowledgment and cleanup
- [ ] Support graceful agent shutdown for unassigned tasks
- [ ] Handle agent offline scenarios during unassignment

### 3. Resource Cleanup
- [ ] Close or archive opencode sessions
- [ ] Clean up git worktrees for isolated assignments
- [ ] Remove temporary files and artifacts
- [ ] Handle cleanup failures gracefully

### 4. Status Management
- [ ] Transition task status appropriately after unassignment
- [ ] Update kanban board to reflect unassignment
- [ ] Handle task re-assignment scenarios
- [ ] Maintain audit trail of unassignment operations

## Technical Requirements

### Dependencies
- `@promethean/kanban` - existing kanban system
- `@promethean/opencode-session-manager` - opencode client SDK
- Git worktree management utilities
- Agent communication interfaces

### Integration Points
- Extend `packages/kanban/src/cli/command-handlers.ts`
- Integrate with existing task management functions
- Use existing frontmatter manipulation utilities
- Coordinate with agent management commands

### API Design
```bash
# Basic unassignment
pnpm kanban unassign <task-uuid>

# Force unassignment (ignores agent state)
pnpm kanban unassign <task-uuid> --force

# Unassign all tasks from specific agent
pnpm kanban unassign --agent <agent-id>

# Unassign with cleanup options
pnpm kanban unassign <task-uuid> --cleanup-sessions --cleanup-worktrees

# Dry run to see what would be unassigned
pnpm kanban unassign <task-uuid> --dry-run
```

## Context & Resources

### Related Files
- `packages/kanban/src/cli/command-handlers.ts` - command handlers
- `packages/kanban/src/lib/kanban.ts` - core kanban functions
- `packages/opencode-session-manager/src/opencode/client.ts` - opencode SDK
- Git worktree management code (from assign command)
- Agent management implementation

### Documentation
- `docs/agile/kanban-cli-reference.md` - CLI documentation
- `AGENTS.md` - agent management patterns
- Task lifecycle documentation

### Similar Implementations
- Assignment command implementation
- Task deletion functionality
- Status transition handling

## Notes & Considerations

### Unassignment Rules
- Validate task exists and has agent assigned
- Check agent state before allowing unassignment
- Handle tasks in different statuses appropriately
- Prevent unassignment of completed tasks without force flag

### Cleanup Strategies
- Archive opencode sessions instead of deleting
- Remove git worktrees only if no longer needed
- Preserve agent work and artifacts when appropriate
- Handle cleanup failures without breaking unassignment

### Status Transitions
- Move unassigned tasks back to appropriate status
- Consider task progress and agent work completed
- Handle re-assignment scenarios smoothly
- Maintain workflow integrity after unassignment

### Error Scenarios
- Task not found or not assigned
- Agent not responding to unassignment
- Cleanup operations failing
- Git worktree removal issues
- Opencode session archival failures

## Testing Requirements

### Unit Tests
- Unassignment logic and validation
- Frontmatter cleanup functionality
- Agent communication and notification
- Resource cleanup operations

### Integration Tests
- End-to-end unassignment workflows
- Agent coordination during unassignment
- Git worktree cleanup verification
- Opencode session archival testing

### Test Fixtures
- Mock assigned tasks with various statuses
- Mock agent states and responses
- Test git repositories with worktrees
- Simulated opencode sessions

## Blocking Tasks

- [ ] 2025.10.12.17.00.00-implement-kanban-assign-command-core-functionality
- [ ] 2025.10.12.17.01.00-implement-agent-management-commands

## Tasks This Blocks

- [ ] 2025.10.12.17.04.00-implement-assignment-workflow-automation
- [ ] 2025.10.12.17.06.00-add-assignment-audit-logging

## Success Metrics

- Tasks successfully unassigned with metadata cleanup
- Agents properly notified and handle unassignment gracefully
- Git worktrees and sessions cleaned up appropriately
- Task status transitions maintain workflow integrity
- All error scenarios handled with clear feedback
- Integration tests pass for all unassignment workflows