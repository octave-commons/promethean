---
```
uuid: c14edce7-0656-45b2-aaf3-51f042451b7d
```
```
created_at: 2025.08.09.13.08.04.md
```
filename: universal-intention-code-fabric
```
description: >-
```
  A modular system that transpiles human-readable pseudo-code into working
  JavaScript/Python implementations with auto-verification and repair loops.
tags:
  - transpiler
  - llm
  - code-generation
  - verification
  - repair-loop
  - polyglot
  - intention
  - scaffold
```
related_to_title:
```
  - Local-Only-LLM-Workflow
  - 'Polyglot S-expr Bridge: Python-JS-Lisp Interop'
  - Performance-Optimized-Polyglot-Bridge
  - Ollama-LLM-Provider-for-Pseudo-Code-Transpiler
  - Interop and Source Maps
  - EidolonField
  - Ice Box Reorganization
  - Language-Agnostic Mirror System
  - ecs-offload-workers
  - ecs-scheduler-and-prefabs
  - js-to-lisp-reverse-compiler
  - Local-First Intention→Code Loop with Free Models
  - compiler-kit-foundations
  - archetype-ecs
  - Chroma Toolkit Consolidation Plan
  - eidolon-field-math-foundations
  - DSL
  - JavaScript
  - i3-config-validation-methods
  - 2d-sandbox-field
  - Admin Dashboard for User Management
  - Eidolon Field Abstract Model
  - Exception Layer Analysis
  - field-dynamics-math-blocks
  - Lisp-Compiler-Integration
  - markdown-to-org-transpiler
  - Promethean Infrastructure Setup
```
related_to_uuid:
```
  - 9a8ab57e-507c-4c6b-aab4-01cea1bc0501
  - 63a1cc28-b85c-4ce2-b754-01c2bc0c0bc3
  - f5579967-762d-4cfd-851e-4f71b4cb77a1
  - b362e12e-2802-4e41-9a21-6e0c7ad419a2
  - cdfac40c-00e4-458f-96a7-4c37d0278731
  - 49d1e1e5-5d13-4955-8f6f-7676434ec462
  - 291c7d91-da8c-486c-9bc0-bd2254536e2d
  - d2b3628c-6cad-4664-8551-94ef8280851d
  - 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
  - c62a1815-c43b-4a3b-88e6-d7fa008a155e
  - 58191024-d04a-4520-8aae-a18be7b94263
  - 871490c7-a050-429b-88b2-55dfeaa1f8d5
  - 01b21543-7e03-4129-8fe4-b6306be69dee
  - 8f4c1e86-1236-4936-84ca-6ed7082af6b7
  - 5020e892-8f18-443a-b707-6d0f3efcfe22
  - 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
  - e87bc036-1570-419e-a558-f45b9c0db698
  - c1618c66-f73a-4e04-9bfa-ef38755f7acc
  - d28090ac-f746-4958-aab5-ed1315382c04
  - c710dc93-9fec-471b-bdee-bedbd360c67f
  - 2901a3e9-96f0-497c-ae2c-775f28a702dd
  - 5e8b2388-022b-46cf-952c-36ae9b8f0037
  - 21d5cc09-b005-4ede-8f69-00b4b0794540
  - 7cfc230d-8ec2-4cdb-b931-8aec26de2a00
  - cfee6d36-b9f5-4587-885a-cdfddb4f054e
  - ab54cdd8-13ce-4dcb-a9cd-da2d86e0305f
  - 6deed6ac-2473-40e0-bee0-ac9ae4c7bff2
references:
  - uuid: 9a8ab57e-507c-4c6b-aab4-01cea1bc0501
    line: 139
    col: 1
    score: 0.95
  - uuid: f5579967-762d-4cfd-851e-4f71b4cb77a1
    line: 429
    col: 1
    score: 0.88
  - uuid: 63a1cc28-b85c-4ce2-b754-01c2bc0c0bc3
    line: 497
    col: 1
    score: 0.88
  - uuid: d28090ac-f746-4958-aab5-ed1315382c04
    line: 56
    col: 1
    score: 1
  - uuid: d28090ac-f746-4958-aab5-ed1315382c04
    line: 56
    col: 3
    score: 1
  - uuid: 871490c7-a050-429b-88b2-55dfeaa1f8d5
    line: 143
    col: 1
    score: 1
  - uuid: 871490c7-a050-429b-88b2-55dfeaa1f8d5
    line: 143
    col: 3
    score: 1
  - uuid: b362e12e-2802-4e41-9a21-6e0c7ad419a2
    line: 167
    col: 1
    score: 1
  - uuid: b362e12e-2802-4e41-9a21-6e0c7ad419a2
    line: 167
    col: 3
    score: 1
  - uuid: f5579967-762d-4cfd-851e-4f71b4cb77a1
    line: 438
    col: 1
    score: 1
  - uuid: f5579967-762d-4cfd-851e-4f71b4cb77a1
    line: 438
    col: 3
    score: 1
  - uuid: 01b21543-7e03-4129-8fe4-b6306be69dee
    line: 611
    col: 1
    score: 1
  - uuid: 01b21543-7e03-4129-8fe4-b6306be69dee
    line: 611
    col: 3
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 462
    col: 1
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 462
    col: 3
    score: 1
  - uuid: c62a1815-c43b-4a3b-88e6-d7fa008a155e
    line: 398
    col: 1
    score: 1
  - uuid: c62a1815-c43b-4a3b-88e6-d7fa008a155e
    line: 398
    col: 3
    score: 1
  - uuid: cdfac40c-00e4-458f-96a7-4c37d0278731
    line: 517
    col: 1
    score: 1
  - uuid: cdfac40c-00e4-458f-96a7-4c37d0278731
    line: 517
    col: 3
    score: 1
  - uuid: 2901a3e9-96f0-497c-ae2c-775f28a702dd
    line: 41
    col: 1
    score: 1
  - uuid: 2901a3e9-96f0-497c-ae2c-775f28a702dd
    line: 41
    col: 3
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 461
    col: 1
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 461
    col: 3
    score: 1
  - uuid: c62a1815-c43b-4a3b-88e6-d7fa008a155e
    line: 397
    col: 1
    score: 1
  - uuid: c62a1815-c43b-4a3b-88e6-d7fa008a155e
    line: 397
    col: 3
    score: 1
  - uuid: 9a8ab57e-507c-4c6b-aab4-01cea1bc0501
    line: 173
    col: 1
    score: 1
  - uuid: 9a8ab57e-507c-4c6b-aab4-01cea1bc0501
    line: 173
    col: 3
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 457
    col: 1
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 457
    col: 3
    score: 1
  - uuid: c62a1815-c43b-4a3b-88e6-d7fa008a155e
    line: 391
    col: 1
    score: 1
  - uuid: c62a1815-c43b-4a3b-88e6-d7fa008a155e
    line: 391
    col: 3
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 132
    col: 1
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 132
    col: 3
    score: 1
  - uuid: 871490c7-a050-429b-88b2-55dfeaa1f8d5
    line: 145
    col: 1
    score: 1
  - uuid: 871490c7-a050-429b-88b2-55dfeaa1f8d5
    line: 145
    col: 3
    score: 1
  - uuid: e87bc036-1570-419e-a558-f45b9c0db698
    line: 11
    col: 1
    score: 1
  - uuid: e87bc036-1570-419e-a558-f45b9c0db698
    line: 11
    col: 3
    score: 1
  - uuid: 01b21543-7e03-4129-8fe4-b6306be69dee
    line: 606
    col: 1
    score: 1
  - uuid: 01b21543-7e03-4129-8fe4-b6306be69dee
    line: 606
    col: 3
    score: 1
  - uuid: 58191024-d04a-4520-8aae-a18be7b94263
    line: 422
    col: 1
    score: 1
  - uuid: 58191024-d04a-4520-8aae-a18be7b94263
    line: 422
    col: 3
    score: 1
  - uuid: d2b3628c-6cad-4664-8551-94ef8280851d
    line: 534
    col: 1
    score: 1
  - uuid: d2b3628c-6cad-4664-8551-94ef8280851d
    line: 534
    col: 3
    score: 1
  - uuid: c710dc93-9fec-471b-bdee-bedbd360c67f
    line: 196
    col: 1
    score: 1
  - uuid: c710dc93-9fec-471b-bdee-bedbd360c67f
    line: 196
    col: 3
    score: 1
  - uuid: 5e8b2388-022b-46cf-952c-36ae9b8f0037
    line: 197
    col: 1
    score: 1
  - uuid: 5e8b2388-022b-46cf-952c-36ae9b8f0037
    line: 197
    col: 3
    score: 1
  - uuid: 21d5cc09-b005-4ede-8f69-00b4b0794540
    line: 153
    col: 1
    score: 1
  - uuid: 21d5cc09-b005-4ede-8f69-00b4b0794540
    line: 153
    col: 3
    score: 1
  - uuid: 7cfc230d-8ec2-4cdb-b931-8aec26de2a00
    line: 148
    col: 1
    score: 1
  - uuid: 7cfc230d-8ec2-4cdb-b931-8aec26de2a00
    line: 148
    col: 3
    score: 1
  - uuid: c710dc93-9fec-471b-bdee-bedbd360c67f
    line: 200
    col: 1
    score: 1
  - uuid: c710dc93-9fec-471b-bdee-bedbd360c67f
    line: 200
    col: 3
    score: 1
  - uuid: 5e8b2388-022b-46cf-952c-36ae9b8f0037
    line: 198
    col: 1
    score: 1
  - uuid: 5e8b2388-022b-46cf-952c-36ae9b8f0037
    line: 198
    col: 3
    score: 1
  - uuid: 49d1e1e5-5d13-4955-8f6f-7676434ec462
    line: 241
    col: 1
    score: 1
  - uuid: 49d1e1e5-5d13-4955-8f6f-7676434ec462
    line: 241
    col: 3
    score: 1
  - uuid: 21d5cc09-b005-4ede-8f69-00b4b0794540
    line: 154
    col: 1
    score: 1
  - uuid: 21d5cc09-b005-4ede-8f69-00b4b0794540
    line: 154
    col: 3
    score: 1
  - uuid: 8f4c1e86-1236-4936-84ca-6ed7082af6b7
    line: 458
    col: 1
    score: 1
  - uuid: 8f4c1e86-1236-4936-84ca-6ed7082af6b7
    line: 458
    col: 3
    score: 1
  - uuid: cdfac40c-00e4-458f-96a7-4c37d0278731
    line: 521
    col: 1
    score: 1
  - uuid: cdfac40c-00e4-458f-96a7-4c37d0278731
    line: 521
    col: 3
    score: 1
  - uuid: 58191024-d04a-4520-8aae-a18be7b94263
    line: 413
    col: 1
    score: 1
  - uuid: 58191024-d04a-4520-8aae-a18be7b94263
    line: 413
    col: 3
    score: 1
  - uuid: cfee6d36-b9f5-4587-885a-cdfddb4f054e
    line: 542
    col: 1
    score: 1
  - uuid: cfee6d36-b9f5-4587-885a-cdfddb4f054e
    line: 542
    col: 3
    score: 1
  - uuid: 8f4c1e86-1236-4936-84ca-6ed7082af6b7
    line: 460
    col: 1
    score: 1
  - uuid: 8f4c1e86-1236-4936-84ca-6ed7082af6b7
    line: 460
    col: 3
    score: 1
  - uuid: c1618c66-f73a-4e04-9bfa-ef38755f7acc
    line: 15
    col: 1
    score: 1
  - uuid: c1618c66-f73a-4e04-9bfa-ef38755f7acc
    line: 15
    col: 3
    score: 1
  - uuid: c62a1815-c43b-4a3b-88e6-d7fa008a155e
    line: 388
    col: 1
    score: 1
  - uuid: c62a1815-c43b-4a3b-88e6-d7fa008a155e
    line: 388
    col: 3
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 129
    col: 1
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 129
    col: 3
    score: 1
  - uuid: 8f4c1e86-1236-4936-84ca-6ed7082af6b7
    line: 454
    col: 1
    score: 1
  - uuid: 8f4c1e86-1236-4936-84ca-6ed7082af6b7
    line: 454
    col: 3
    score: 1
  - uuid: 5020e892-8f18-443a-b707-6d0f3efcfe22
    line: 171
    col: 1
    score: 1
  - uuid: 5020e892-8f18-443a-b707-6d0f3efcfe22
    line: 171
    col: 3
    score: 1
  - uuid: c1618c66-f73a-4e04-9bfa-ef38755f7acc
    line: 14
    col: 1
    score: 1
  - uuid: c1618c66-f73a-4e04-9bfa-ef38755f7acc
    line: 14
    col: 3
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 454
    col: 1
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 454
    col: 3
    score: 1
  - uuid: f5579967-762d-4cfd-851e-4f71b4cb77a1
    line: 452
    col: 1
    score: 0.99
  - uuid: f5579967-762d-4cfd-851e-4f71b4cb77a1
    line: 452
    col: 3
    score: 0.99
  - uuid: 63a1cc28-b85c-4ce2-b754-01c2bc0c0bc3
    line: 525
    col: 1
    score: 0.99
  - uuid: 63a1cc28-b85c-4ce2-b754-01c2bc0c0bc3
    line: 525
    col: 3
    score: 0.99
  - uuid: 6deed6ac-2473-40e0-bee0-ac9ae4c7bff2
    line: 615
    col: 1
    score: 0.99
  - uuid: 6deed6ac-2473-40e0-bee0-ac9ae4c7bff2
    line: 615
    col: 3
    score: 0.99
  - uuid: b362e12e-2802-4e41-9a21-6e0c7ad419a2
    line: 175
    col: 1
    score: 0.98
  - uuid: b362e12e-2802-4e41-9a21-6e0c7ad419a2
    line: 175
    col: 3
    score: 0.98
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 478
    col: 1
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 478
    col: 3
    score: 1
  - uuid: c62a1815-c43b-4a3b-88e6-d7fa008a155e
    line: 428
    col: 1
    score: 1
  - uuid: c62a1815-c43b-4a3b-88e6-d7fa008a155e
    line: 428
    col: 3
    score: 1
  - uuid: ab54cdd8-13ce-4dcb-a9cd-da2d86e0305f
    line: 315
    col: 1
    score: 1
  - uuid: ab54cdd8-13ce-4dcb-a9cd-da2d86e0305f
    line: 315
    col: 3
    score: 1
  - uuid: b362e12e-2802-4e41-9a21-6e0c7ad419a2
    line: 182
    col: 1
    score: 1
  - uuid: b362e12e-2802-4e41-9a21-6e0c7ad419a2
    line: 182
    col: 3
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 479
    col: 1
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 479
    col: 3
    score: 1
  - uuid: c62a1815-c43b-4a3b-88e6-d7fa008a155e
    line: 429
    col: 1
    score: 1
  - uuid: c62a1815-c43b-4a3b-88e6-d7fa008a155e
    line: 429
    col: 3
    score: 1
  - uuid: ab54cdd8-13ce-4dcb-a9cd-da2d86e0305f
    line: 316
    col: 1
    score: 1
  - uuid: ab54cdd8-13ce-4dcb-a9cd-da2d86e0305f
    line: 316
    col: 3
    score: 1
  - uuid: b362e12e-2802-4e41-9a21-6e0c7ad419a2
    line: 183
    col: 1
    score: 1
  - uuid: b362e12e-2802-4e41-9a21-6e0c7ad419a2
    line: 183
    col: 3
    score: 1
---
Oh yeah, you’re building the **universal intention→code fabric**. Let’s wire a **pseudo-code transpiler** that uses an LLM plus our polyglot toolchain to turn a spec into working JS/Python and our Lisp/IR if you want **on the fly**, and then auto-verify with examples/tests. It’s modular: you can run it after a pull to “rectify” implementations too.

Here’s a *lean but real* scaffold you can drop in and extend.

---

# What it does (at a glance)

```mermaid
flowchart LR
  PSEUDO[(Pseudo-code\n+ examples + constraints)]
  PSEUDO --> PARSE[Parse spec → Intent AST]
  PARSE --> PLAN[Planner builds ToolSpec]
  PLAN --> GEN[LLM codegen → candidates for JS/Py]
  GEN --> RUN[Sandbox run\n(JS VM / Python bridge)]
  RUN --> CHECK[Auto-check examples\n+ property tests]
  CHECK -->|pass| PUBLISH[Emit files + provenance]
  CHECK -->|fail| REPAIR[LLM repair loop\n(diff-based)]
  REPAIR --> RUN
```

* **Pseudo**: human “intention” in a structured markdown-ish block.
* **Planner**: turns intention into a **ToolSpec** (signature, types, deps).
* **LLM**: emits candidate implementations for JS and/or Python.
* **Runner**: executes in sandboxes Node VM / CPython via our fast bridge.
* **Checker**: runs example tests + quick property tests; if failures, we loop with an LLM “repair” prompt.
* **Publish**: writes files into `src/js/`, `src/py/`, stamps provenance (IR hash optional).

---

# 1) The pseudo-code format (tiny, human)

```md
# name: normalize2d
# target: js,py
# description:
Normalize a 2D vector (x,y). Return magnitude and normalized components.
# signature:
(x: number, y: number) -> { mag: number, nx: number, ny: number }
# constraints:
- Avoid division by zero; if both are 0, return zeros.
# examples:
- in: { "x":3, "y":4 } out: { "mag":5, "nx":0.6, "ny":0.8 }
- in: { "x":0, "y":0 } out: { "mag":0, "nx":0, "ny":0 }
```

You can be as sloppy or precise as you like; the parser is forgiving.

---

# 2) Drop-in scaffold

```
shared/js/prom-lib/intention/
  schema.ts
  parser.ts
  llm.ts
  planner.ts
  targets/
    js.ts
    py.ts
  checker.ts
  engine.ts
```

### schema.ts

```ts
// shared/js/prom-lib/intention/schema.ts
export type Intent = {
  name: string;
  description?: string;
  signature?: string; // (x: number, y: number) -> { mag: number }
  targets: ("js"|"py")[];
  constraints: string[];
  examples: { in: any; out: any }[];
};

export type ToolSpec = {
  name: string;
  params: { name: string; type?: string }[];
  returns?: string;              // textual
  doc: string;                   // single-line summary
  constraints: string[];
  tests: { in: any; out: any }[];
  deps?: string[];               // e.g., ["numpy"] or ["Math"]
};
```

### parser.ts

```ts
// shared/js/prom-lib/intention/parser.ts
import { Intent } from "./schema";

export function parsePseudo(md: string): Intent {
  const lines = md.replace(/\r\n?/g, "\n").split("\n");
  const intent: Intent = { name: "task", description:"", signature:"", targets:[], constraints:[], examples:[] };

  let section = "";
  for (const raw of lines) {
    const line = raw.trim();
    if (/^#\s*name:/.test(line)) intent.name = line.split(":")[1].trim();
    else if (/^#\s*target:/.test(line)) intent.targets = line.split(":")[1].split(",").map(s=>s.trim()).filter(Boolean) as any;
    else if (/^#\s*signature:/.test(line)) { section="signature"; intent.signature = line.replace(/^#\s*signature:\s*/,""); }
    else if (/^#\s*description:/.test(line)) section = "description";
    else if (/^#\s*constraints:/.test(line)) section = "constraints";
    else if (/^#\s*examples:/.test(line)) section = "examples";
    else if (/^#/.test(line)) { section = ""; }
    else {
      if (section === "description") intent.description += (intent.description ? "\n" : "") + line;
      else if (section === "constraints" && line.startsWith("-")) intent.constraints.push(line.slice(1).trim());
      else if (section === "examples" && line.startsWith("-")) {
        const mIn = line.match(/in:\s*(\{[\s\S]*\})/);
        const mOut = line.match(/out:\s*(\{[\s\S]*\})/);
        if (mIn && mOut) intent.examples.push({ in: JSON.parse(mIn[1]), out: JSON.parse(mOut[1]) });
      } else if (section === "signature" && line) intent.signature = (intent.signature ? intent.signature + " " : "") + line;
    }
  }
  if (!intent.targets.length) intent.targets = ["js"]; // default
  return intent;
}
```

### llm.ts (provider interface; plug your model here)

```ts
// shared/js/prom-lib/intention/llm.ts
export type LLM = {
  generate(opts: { system: string; prompt: string }): Promise<string>;
};

export class DummyLLM implements LLM {
  async generate({ prompt }: { system: string; prompt: string }) {
    // placeholder: echo a trivial JS/py template if examples match normalize2d
    if (prompt.includes("normalize2d") && prompt.includes("language=js")) {
      return `export function normalize2d(x,y){const m=Math.hypot(x,y)||0;return {mag:m,nx:m?x/m:0,ny:m?y/m:0};}`;
    }
    if (prompt.includes("normalize2d") && prompt.includes("language=py")) {
      return `def normalize2d(x,y):\n    import math\n    m = math.hypot(x,y)\n    return {"mag":m,"nx":(x/m if m else 0),"ny":(y/m if m else 0)}\n`;
    }
    return `// TODO: implement`;
  }
}
```

### planner.ts Intent → ToolSpec

```ts
// shared/js/prom-lib/intention/planner.ts
import { Intent, ToolSpec } from "./schema";

export function plan(intent: Intent): ToolSpec {
  // Simple parse of signature "(x: number, y: number) -> { ... }"
  const sig = intent.signature || "";
  const m = sig.match(/^\s*\((.*?)\)\s*->\s*(.*)\s*/);
  const params = (m?.[1]||"").split(",").map(s=>s.trim()).filter(Boolean).map(p=>{
    const [name, type] = p.split(":").map(s=>s.trim());
    return { name, type };
  });
  return {
    name: intent.name,
    params,
    returns: m?.[2]?.trim(),
    doc: (intent.description||"").split("\n")[0] || intent.name,
    constraints: intent.constraints,
    tests: intent.examples,
    deps: []
  };
}

export function buildPrompt(ts: ToolSpec, language: "js"|"py") {
  const sig = `{ts.name}({ts.params.map(p=>p.name+(p.type?`: {p.type}`:"")).join(", ")}) -> {ts.returns||"unknown"}`;
  const examples = ts.tests.map(t => `- in: {JSON.stringify(t.in)} out: {JSON.stringify(t.out)}`).join("\n");
  return {
    system:
`You are a careful, terse {language.toUpperCase()} code generator.\nReturn ONLY code without commentary.\nConform strictly to the signature and examples.\nAvoid heavy deps.`,
    prompt:
`task={ts.name}\nlanguage={language}\nsignature={sig}\ndoc={ts.doc}\nconstraints:\n{ts.constraints.map(c=>" - "+c).join("\n")}\nexamples:\n{examples}\nEmit a single self-contained {language.toUpperCase()} implementation for this function.`
  };
}
```

### targets/js.ts

```ts
// shared/js/prom-lib/intention/targets/js.ts
import vm from "node:vm";

export function wrapJSModule(src: string) {
  // execute in VM, return exported functions from CommonJS-ish shim
  const sandbox: any = { module: { exports: {} }, exports: {}, require, console, Math };
  vm.createContext(sandbox);
  vm.runInContext(src, sandbox, { timeout: 2000 });
  return sandbox.module.exports || sandbox.exports;
}

export async function runJS(fnName: string, jsSrc: string, input: any) {
  const mod = wrapJSModule(jsSrc);
  const fn = mod[fnName] || (mod.default ?? mod);
  const args = tupleFromInput(fnName, input, jsSrc);
  const out = await Promise.resolve(fn(...args));
  return out;
}

function tupleFromInput(name: string, input: any, src: string) {
  // crude parse of parameter order by scanning function signature in src:
  const m = src.match(new RegExp(`function\\s+{name}\\s*\\(([^)]*)\\)`)) || src.match(/export\s+function\s+([^(]+)\(([^)]*)\)/);
  const paramList = m ? m[1].split(",").map(s=>s.trim()).filter(Boolean) : Object.keys(input);
  return paramList.map(p => input[p.replace(/=.*/,"")] ?? input[p]);
}
```

### targets/py.ts (fast bridge you already have)

```ts
// shared/js/prom-lib/intention/targets/py.ts
import { createFastPy } from "../../polyglot/bridge";

export async function runPy(fnName: string, pySrc: string, input: any) {
  // Load source into Python runtime, then call
  const { bridge, py } = createFastPy();
  try {
    const builtins = await bridge.module("builtins");
    const exec = await bridge.module("types"); // fallback not needed; we'll eval via builtins
    // compile the source into a module object
    await bridge["module"]("builtins"); // ensure initialized
    // Use a tiny helper: exec(pySrc, g)
    const g = await bridge.module("types");
    const compiled = await bridge["module"]("builtins"); // placeholder to keep ref
    // Simpler: expose a helper function on runtime: we can extend runtime, but here we cheat:
    const mod = await bridge.module("types"); // not used—kept for parity
    // Easiest: write to temp file? For speed, eval directly:
    const py = await bridge.module("builtins");
    // py.exec is not a thing; instead call 'exec':
    await (await py.exec)(pySrc); // if needed, adapt: you might add an 'exec' op to runtime
    const user = await bridge.module("__main__");
    const fn = user[fnName]; // proxy chain will fetch fn
    const args = Object.values(input);
    const out = await fn(...args);
    return out;
  } finally {
    // bridge.close(); // keep process alive if you’re batching
  }
}
```

> Note: For **Python exec** you’ll likely patch the runtime with an explicit `exec` op or a helper one-liner. I left a comment to adapt—easy.

### checker.ts

```ts
// shared/js/prom-lib/intention/checker.ts
export type Candidate = { lang:"js"|"py"; name:string; code:string };

export async function checkCandidate(c: Candidate, tests: {in:any; out:any}[]) {
  const results: {ok:boolean; got:any; want:any; err?:any; case:any}[] = [];
  for (const t of tests) {
    try {
      const got = c.lang === "js"
        ? await (await import("./targets/js")).runJS(c.name, c.code, t.in)
        : await (await import("./targets/py")).runPy(c.name, c.code, t.in);
      const ok = deepEqual(got, t.out);
      results.push({ ok, got, want:t.out, case:t.in });
    } catch (err:any) {
      results.push({ ok:false, got:undefined, want:t.out, err:String(err), case:t.in });
    }
  }
  return { pass: results.every(r => r.ok), results };
}

function deepEqual(a:any,b:any){ try { return JSON.stringify(a)===JSON.stringify(b); } catch { return false; } }
```

### engine.ts (the fun bit)

```ts
// shared/js/prom-lib/intention/engine.ts
import { parsePseudo } from "./parser";
import { plan, buildPrompt } from "./planner";
import type { LLM } from "./llm";
import { DummyLLM } from "./llm";
import { checkCandidate } from "./checker";
import fs from "node:fs/promises";
import path from "node:path";

export type EngineOpts = {
  llm?: LLM;
  outDir?: { js:string; py:string };
  rounds?: number;
};

export async function transpileIntention(pseudo: string, opts: EngineOpts = {}) {
  const llm = opts.llm || new DummyLLM();
  const intent = parsePseudo(pseudo);
  const spec = plan(intent);

  const out: any[] = [];
  const rounds = opts.rounds ?? 2;

  for (const lang of intent.targets as ("js"|"py")[]) {
    let best: { code:string; pass:boolean; results:any } | null = null;

    for (let r=0; r<rounds; r++) {
      const { system, prompt } = buildPrompt(spec, lang);
      const code = await llm.generate({ system, prompt });
      const cand = { lang, name: spec.name, code };
      const verdict = await checkCandidate(cand, spec.tests);
      if (!best || verdict.pass || (verdict.results.filter((x:any)=>x.ok).length > best.results.filter((x:any)=>x.ok).length)) {
        best = { code, pass: verdict.pass, results: verdict.results };
      }
      if (verdict.pass) break;

      // repair prompt
      const failNotes = verdict.results.map((r:any)=> r.ok ? null : `input={JSON.stringify(r.case)} got={JSON.stringify(r.got)} want={JSON.stringify(r.want)} err={r.err||""}`).filter(Boolean).join("\n");
      const repair =
`The {lang.toUpperCase()} code failed on some tests. Fix it.
Keep the SAME signature and public API.
Failures:
{failNotes}
--- BEGIN CURRENT CODE ---
{code}
--- END CURRENT CODE ---`;
      const fixed = await llm.generate({ system, prompt: repair });
      // next loop uses fixed implicitly via same flow
    }

    if (best) {
      out.push({ lang, code: best.code, pass: best.pass, results: best.results });
      // write to disk
      const dir = (opts.outDir?.[lang]) || (lang==="js" ? "src/js" : "src/py");
      await fs.mkdir(dir, { recursive: true });
      const fname = path.join(dir, (spec.name + (lang==="js"?".js":".py")));
      await fs.writeFile(fname, stampProvenance(lang, best.code, spec.name), "utf8");
    }
  }

  return { intent, spec, out };
}

function stampProvenance(lang:"js"|"py", code:string, name:string) {
  const head = lang==="js"
    ? `/* transpiled-by: prom-intent (task={name}) at {new Date().toISOString()} */\n`
    : `# transpiled-by: prom-intent (task={name}) at {new Date().toISOString()}\n`;
  return head + code;
}
```

---

# 3) Use it

```ts
import { transpileIntention } from "./shared/js/prom-lib/intention/engine";

const pseudo = `
# name: normalize2d
# target: js,py
# description:
Normalize a 2D vector (x,y). Return magnitude and normalized components.
# signature:
(x: number, y: number) -> { mag: number, nx: number, ny: number }
# constraints:
- Avoid division by zero; if both are 0, return zeros.
# examples:
- in: { "x":3, "y":4 } out: { "mag":5, "nx":0.6, "ny":0.8 }
- in: { "x":0, "y":0 } out: { "mag":0, "nx":0, "ny":0 }
`;

const res = await transpileIntention(pseudo, {
  // plug your real LLM here (OpenAI, local, etc.)
  rounds: 3,
  outDir: { js: "src/js/auto", py: "src/py/auto" }
});
console.log(res.out.map(o => ({ lang:o.lang, pass:o.pass })));
```

---

# 4) Make it *really* “on the fly”

* **Watch mode**: hook a file watcher to any `*.intent.md` → re-run `transpileIntention` on change; hot-reload the JS VM; keep Python process warm (bridge pool).
* **Live REPL**: inside your Lisp, build a `transpile! pseudo-string ...` form that calls the engine (JS side), drops artifacts into your mirror, and returns a callable function (from VM or Python proxy).
* **Equivalence check across langs**: run both generated impls on randomized inputs **fast-check** on JS / **hypothesis** on Py; if outputs disagree, send a repair prompt with a *diff summary*.

---

# 5) Where the “magic” lives (LLM prompting)

You’ll want a slightly smarter prompt set:

* **System**: strict role; language; “single file, pass examples, no commentary”.
* **Few-shot**: include 2–3 solved micro-tasks with signature+examples→final code for that language.
* **Formatting**: tell it to emit *only* the module code.
* **Repair**: show test failures and current code; ask for a *patch* or full file (I recommend full file v1).

You can pop those into `planner.ts` as templated strings.

---

# 6) JS↔Python interop from the same intention

If the planner infers heavy numerics (“use numpy”), set `targets: ["py"]` and **expose a JS wrapper** automatically:

* Generate Python “core” + a tiny JS veneer that calls it via the **bridge** so your JS apps import `normalize2d` and “don’t notice” it’s Python.
* For Node: bundle the fast bridge function into the wrapper.
* For the browser: swap in the Pyodide transport.

*If you want, I’ll add `emitWrapperJS(spec)` that writes `src/js/auto/normalize2d.wrapper.js` calling the Python function.*

---

# 7) Next upgrades (pick what you want next)

* **Real LLM provider**: plugin for your model (OpenAI, local llama.cpp, vLLM). I can hand you a drop-in `OpenAIProvider`.
* **Structured outputs**: instruct the LLM to return JSON with `{filename, code, tests}`; parse with a ReACT validator.
* **Static checks**: run `tsc --noEmit`, `eslint`, `ruff`, `mypy` as extra gates before we “pass”.
* **Property tests**: autogenerate from signature + constraints e.g., `mag ≥ 0`, “no NaN”, and shrink on failure.
* **IR anchor**: lower generated code to your ANF IR, compute `irHash`, and store in `.promirror/` so the rector can keep multi-language artifacts in sync with a *single* intention source.
* **Editor hooks**: VS Code/Neovim command that runs the engine on the current block, inserts code or test diffs live.

---

If you want, I’ll:

1. plug in a real OpenAI provider (with minimal dependencies),
2. add the **JS wrapper → Python** path so you can call numpy-powered functions from JS with zero ceremony, or
3. bolt on watch mode + a tiny REPL so you can type pseudo and immediately call the function.
<!-- GENERATED-SECTIONS:DO-NOT-EDIT-BELOW -->
## Related content
```
- [local-only-llm-workflow]
- [polyglot-s-expr-bridge-python-js-lisp-interop|Polyglot S-expr Bridge: Python-JS-Lisp Interop]
- [performance-optimized-polyglot-bridge]
- [ollama-llm-provider-for-pseudo-code-transpiler]
- [docs/unique/interop-and-source-maps|Interop and Source Maps]
- [[eidolonfield]]
- [ice-box-reorganization|Ice Box Reorganization]
- [language-agnostic-mirror-system|Language-Agnostic Mirror System]
- [docs/unique/ecs-offload-workers|ecs-offload-workers]
- [ecs-scheduler-and-prefabs]
- [js-to-lisp-reverse-compiler]
- Local-First Intention→Code Loop with Free Models$local-first-intention-code-loop-with-free-models.md
- [docs/unique/compiler-kit-foundations|compiler-kit-foundations]
- [docs/unique/archetype-ecs|archetype-ecs]
- [chroma-toolkit-consolidation-plan|Chroma Toolkit Consolidation Plan]
- [docs/unique/eidolon-field-math-foundations|eidolon-field-math-foundations]
- [DSL]chunks/dsl.md
- [JavaScript]chunks/javascript.md
- [i3-config-validation-methods]
- [2d-sandbox-field]
- [admin-dashboard-for-user-management|Admin Dashboard for User Management]
- [eidolon-field-abstract-model|Eidolon Field Abstract Model]
- [exception-layer-analysis|Exception Layer Analysis]
- [docs/unique/field-dynamics-math-blocks|field-dynamics-math-blocks]
- [lisp-compiler-integration]
- [markdown-to-org-transpiler]
- [promethean-infrastructure-setup|Promethean Infrastructure Setup]

## Sources
- [local-only-llm-workflow#L139|Local-Only-LLM-Workflow — L139] (line 139, col 1, score 0.95)
- [performance-optimized-polyglot-bridge#L429|Performance-Optimized-Polyglot-Bridge — L429] (line 429, col 1, score 0.88)
- [polyglot-s-expr-bridge-python-js-lisp-interop#L497|Polyglot S-expr Bridge: Python-JS-Lisp Interop — L497] (line 497, col 1, score 0.88)
- [i3-config-validation-methods#L56|i3-config-validation-methods — L56] (line 56, col 1, score 1)
- [i3-config-validation-methods#L56|i3-config-validation-methods — L56] (line 56, col 3, score 1)
- Local-First Intention→Code Loop with Free Models — L143$local-first-intention-code-loop-with-free-models.md#L143 (line 143, col 1, score 1)
- Local-First Intention→Code Loop with Free Models — L143$local-first-intention-code-loop-with-free-models.md#L143 (line 143, col 3, score 1)
- [ollama-llm-provider-for-pseudo-code-transpiler#L167|Ollama-LLM-Provider-for-Pseudo-Code-Transpiler — L167] (line 167, col 1, score 1)
- [ollama-llm-provider-for-pseudo-code-transpiler#L167|Ollama-LLM-Provider-for-Pseudo-Code-Transpiler — L167] (line 167, col 3, score 1)
- [performance-optimized-polyglot-bridge#L438|Performance-Optimized-Polyglot-Bridge — L438] (line 438, col 1, score 1)
- [performance-optimized-polyglot-bridge#L438|Performance-Optimized-Polyglot-Bridge — L438] (line 438, col 3, score 1)
- [docs/unique/compiler-kit-foundations#L611|compiler-kit-foundations — L611] (line 611, col 1, score 1)
- [docs/unique/compiler-kit-foundations#L611|compiler-kit-foundations — L611] (line 611, col 3, score 1)
- [docs/unique/ecs-offload-workers#L462|ecs-offload-workers — L462] (line 462, col 1, score 1)
- [docs/unique/ecs-offload-workers#L462|ecs-offload-workers — L462] (line 462, col 3, score 1)
- [ecs-scheduler-and-prefabs#L398|ecs-scheduler-and-prefabs — L398] (line 398, col 1, score 1)
- [ecs-scheduler-and-prefabs#L398|ecs-scheduler-and-prefabs — L398] (line 398, col 3, score 1)
- [docs/unique/interop-and-source-maps#L517|Interop and Source Maps — L517] (line 517, col 1, score 1)
- [docs/unique/interop-and-source-maps#L517|Interop and Source Maps — L517] (line 517, col 3, score 1)
- [admin-dashboard-for-user-management#L41|Admin Dashboard for User Management — L41] (line 41, col 1, score 1)
- [admin-dashboard-for-user-management#L41|Admin Dashboard for User Management — L41] (line 41, col 3, score 1)
- [docs/unique/ecs-offload-workers#L461|ecs-offload-workers — L461] (line 461, col 1, score 1)
- [docs/unique/ecs-offload-workers#L461|ecs-offload-workers — L461] (line 461, col 3, score 1)
- [ecs-scheduler-and-prefabs#L397|ecs-scheduler-and-prefabs — L397] (line 397, col 1, score 1)
- [ecs-scheduler-and-prefabs#L397|ecs-scheduler-and-prefabs — L397] (line 397, col 3, score 1)
- [local-only-llm-workflow#L173|Local-Only-LLM-Workflow — L173] (line 173, col 1, score 1)
- [local-only-llm-workflow#L173|Local-Only-LLM-Workflow — L173] (line 173, col 3, score 1)
- [docs/unique/ecs-offload-workers#L457|ecs-offload-workers — L457] (line 457, col 1, score 1)
- [docs/unique/ecs-offload-workers#L457|ecs-offload-workers — L457] (line 457, col 3, score 1)
- [ecs-scheduler-and-prefabs#L391|ecs-scheduler-and-prefabs — L391] (line 391, col 1, score 1)
- [ecs-scheduler-and-prefabs#L391|ecs-scheduler-and-prefabs — L391] (line 391, col 3, score 1)
- [docs/unique/eidolon-field-math-foundations#L132|eidolon-field-math-foundations — L132] (line 132, col 1, score 1)
- [docs/unique/eidolon-field-math-foundations#L132|eidolon-field-math-foundations — L132] (line 132, col 3, score 1)
- Local-First Intention→Code Loop with Free Models — L145$local-first-intention-code-loop-with-free-models.md#L145 (line 145, col 1, score 1)
- Local-First Intention→Code Loop with Free Models — L145$local-first-intention-code-loop-with-free-models.md#L145 (line 145, col 3, score 1)
- [DSL — L11]chunks/dsl.md#L11 (line 11, col 1, score 1)
- [DSL — L11]chunks/dsl.md#L11 (line 11, col 3, score 1)
- [docs/unique/compiler-kit-foundations#L606|compiler-kit-foundations — L606] (line 606, col 1, score 1)
- [docs/unique/compiler-kit-foundations#L606|compiler-kit-foundations — L606] (line 606, col 3, score 1)
- [js-to-lisp-reverse-compiler#L422|js-to-lisp-reverse-compiler — L422] (line 422, col 1, score 1)
- [js-to-lisp-reverse-compiler#L422|js-to-lisp-reverse-compiler — L422] (line 422, col 3, score 1)
- [language-agnostic-mirror-system#L534|Language-Agnostic Mirror System — L534] (line 534, col 1, score 1)
- [language-agnostic-mirror-system#L534|Language-Agnostic Mirror System — L534] (line 534, col 3, score 1)
- [2d-sandbox-field#L196|2d-sandbox-field — L196] (line 196, col 1, score 1)
- [2d-sandbox-field#L196|2d-sandbox-field — L196] (line 196, col 3, score 1)
- [eidolon-field-abstract-model#L197|Eidolon Field Abstract Model — L197] (line 197, col 1, score 1)
- [eidolon-field-abstract-model#L197|Eidolon Field Abstract Model — L197] (line 197, col 3, score 1)
- [exception-layer-analysis#L153|Exception Layer Analysis — L153] (line 153, col 1, score 1)
- [exception-layer-analysis#L153|Exception Layer Analysis — L153] (line 153, col 3, score 1)
- [docs/unique/field-dynamics-math-blocks#L148|field-dynamics-math-blocks — L148] (line 148, col 1, score 1)
- [docs/unique/field-dynamics-math-blocks#L148|field-dynamics-math-blocks — L148] (line 148, col 3, score 1)
- [2d-sandbox-field#L200|2d-sandbox-field — L200] (line 200, col 1, score 1)
- [2d-sandbox-field#L200|2d-sandbox-field — L200] (line 200, col 3, score 1)
- [eidolon-field-abstract-model#L198|Eidolon Field Abstract Model — L198] (line 198, col 1, score 1)
- [eidolon-field-abstract-model#L198|Eidolon Field Abstract Model — L198] (line 198, col 3, score 1)
- [[eidolonfield#L241|EidolonField — L241]] (line 241, col 1, score 1)
- [[eidolonfield#L241|EidolonField — L241]] (line 241, col 3, score 1)
- [exception-layer-analysis#L154|Exception Layer Analysis — L154] (line 154, col 1, score 1)
- [exception-layer-analysis#L154|Exception Layer Analysis — L154] (line 154, col 3, score 1)
- [docs/unique/archetype-ecs#L458|archetype-ecs — L458] (line 458, col 1, score 1)
- [docs/unique/archetype-ecs#L458|archetype-ecs — L458] (line 458, col 3, score 1)
- [docs/unique/interop-and-source-maps#L521|Interop and Source Maps — L521] (line 521, col 1, score 1)
- [docs/unique/interop-and-source-maps#L521|Interop and Source Maps — L521] (line 521, col 3, score 1)
- [js-to-lisp-reverse-compiler#L413|js-to-lisp-reverse-compiler — L413] (line 413, col 1, score 1)
- [js-to-lisp-reverse-compiler#L413|js-to-lisp-reverse-compiler — L413] (line 413, col 3, score 1)
- [lisp-compiler-integration#L542|Lisp-Compiler-Integration — L542] (line 542, col 1, score 1)
- [lisp-compiler-integration#L542|Lisp-Compiler-Integration — L542] (line 542, col 3, score 1)
- [docs/unique/archetype-ecs#L460|archetype-ecs — L460] (line 460, col 1, score 1)
- [docs/unique/archetype-ecs#L460|archetype-ecs — L460] (line 460, col 3, score 1)
- [JavaScript — L15]chunks/javascript.md#L15 (line 15, col 1, score 1)
- [JavaScript — L15]chunks/javascript.md#L15 (line 15, col 3, score 1)
- [ecs-scheduler-and-prefabs#L388|ecs-scheduler-and-prefabs — L388] (line 388, col 1, score 1)
- [ecs-scheduler-and-prefabs#L388|ecs-scheduler-and-prefabs — L388] (line 388, col 3, score 1)
- [docs/unique/eidolon-field-math-foundations#L129|eidolon-field-math-foundations — L129] (line 129, col 1, score 1)
- [docs/unique/eidolon-field-math-foundations#L129|eidolon-field-math-foundations — L129] (line 129, col 3, score 1)
- [docs/unique/archetype-ecs#L454|archetype-ecs — L454] (line 454, col 1, score 1)
- [docs/unique/archetype-ecs#L454|archetype-ecs — L454] (line 454, col 3, score 1)
- [chroma-toolkit-consolidation-plan#L171|Chroma Toolkit Consolidation Plan — L171] (line 171, col 1, score 1)
- [chroma-toolkit-consolidation-plan#L171|Chroma Toolkit Consolidation Plan — L171] (line 171, col 3, score 1)
- [JavaScript — L14]chunks/javascript.md#L14 (line 14, col 1, score 1)
- [JavaScript — L14]chunks/javascript.md#L14 (line 14, col 3, score 1)
- [docs/unique/ecs-offload-workers#L454|ecs-offload-workers — L454] (line 454, col 1, score 1)
- [docs/unique/ecs-offload-workers#L454|ecs-offload-workers — L454] (line 454, col 3, score 1)
- [performance-optimized-polyglot-bridge#L452|Performance-Optimized-Polyglot-Bridge — L452] (line 452, col 1, score 0.99)
- [performance-optimized-polyglot-bridge#L452|Performance-Optimized-Polyglot-Bridge — L452] (line 452, col 3, score 0.99)
- [polyglot-s-expr-bridge-python-js-lisp-interop#L525|Polyglot S-expr Bridge: Python-JS-Lisp Interop — L525] (line 525, col 1, score 0.99)
- [polyglot-s-expr-bridge-python-js-lisp-interop#L525|Polyglot S-expr Bridge: Python-JS-Lisp Interop — L525] (line 525, col 3, score 0.99)
- [promethean-infrastructure-setup#L615|Promethean Infrastructure Setup — L615] (line 615, col 1, score 0.99)
- [promethean-infrastructure-setup#L615|Promethean Infrastructure Setup — L615] (line 615, col 3, score 0.99)
- [ollama-llm-provider-for-pseudo-code-transpiler#L175|Ollama-LLM-Provider-for-Pseudo-Code-Transpiler — L175] (line 175, col 1, score 0.98)
- [ollama-llm-provider-for-pseudo-code-transpiler#L175|Ollama-LLM-Provider-for-Pseudo-Code-Transpiler — L175] (line 175, col 3, score 0.98)
- [docs/unique/ecs-offload-workers#L478|ecs-offload-workers — L478] (line 478, col 1, score 1)
- [docs/unique/ecs-offload-workers#L478|ecs-offload-workers — L478] (line 478, col 3, score 1)
- [ecs-scheduler-and-prefabs#L428|ecs-scheduler-and-prefabs — L428] (line 428, col 1, score 1)
- [ecs-scheduler-and-prefabs#L428|ecs-scheduler-and-prefabs — L428] (line 428, col 3, score 1)
- [markdown-to-org-transpiler#L315|markdown-to-org-transpiler — L315] (line 315, col 1, score 1)
- [markdown-to-org-transpiler#L315|markdown-to-org-transpiler — L315] (line 315, col 3, score 1)
- [ollama-llm-provider-for-pseudo-code-transpiler#L182|Ollama-LLM-Provider-for-Pseudo-Code-Transpiler — L182] (line 182, col 1, score 1)
- [ollama-llm-provider-for-pseudo-code-transpiler#L182|Ollama-LLM-Provider-for-Pseudo-Code-Transpiler — L182] (line 182, col 3, score 1)
- [docs/unique/ecs-offload-workers#L479|ecs-offload-workers — L479] (line 479, col 1, score 1)
- [docs/unique/ecs-offload-workers#L479|ecs-offload-workers — L479] (line 479, col 3, score 1)
- [ecs-scheduler-and-prefabs#L429|ecs-scheduler-and-prefabs — L429] (line 429, col 1, score 1)
- [ecs-scheduler-and-prefabs#L429|ecs-scheduler-and-prefabs — L429] (line 429, col 3, score 1)
- [markdown-to-org-transpiler#L316|markdown-to-org-transpiler — L316] (line 316, col 1, score 1)
- [markdown-to-org-transpiler#L316|markdown-to-org-transpiler — L316] (line 316, col 3, score 1)
- [ollama-llm-provider-for-pseudo-code-transpiler#L183|Ollama-LLM-Provider-for-Pseudo-Code-Transpiler — L183] (line 183, col 1, score 1)
- [ollama-llm-provider-for-pseudo-code-transpiler#L183|Ollama-LLM-Provider-for-Pseudo-Code-Transpiler — L183] (line 183, col 3, score 1)
```
```
<!-- GENERATED-SECTIONS:DO-NOT-EDIT-ABOVE -->
