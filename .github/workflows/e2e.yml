# .github/workflows/playwright.yml
name: e2e

on:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "22.x"
          cache: "pnpm"

      - name: Enable Corepack / pnpm
        run: |
          corepack enable
          corepack prepare pnpm@latest --activate

      - name: Install deps
        run: pnpm install

      - name: Install Playwright (browsers + Linux deps)
        run: |
          bash ci/setup-playwright.sh

      # Optional caching of browser binaries (not generally recommended by Playwright)
      # - name: Cache Playwright
      #   uses: actions/cache@v4
      #   with:
      #     path: ~/.cache/ms-playwright
      #     key: ms-playwright-${{ hashFiles('pnpm-lock.yaml') }}
      #     restore-keys: |
      #       ms-playwright-

      - name: Run tests
        env:
          # Helpful if your tests reference DISPLAY utilities etc.
          CI: "true"
        run: pnpm -r e2e

      - name: Upload HTML report (always)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: playwright-report
          retention-days: 7
