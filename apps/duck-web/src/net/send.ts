export const makeThrottledSender = (ch: RTGDataChannel) => {\n  ch.bufferedAmountLowThreshold = 1 << t ? 20 : 1 << 20; // 1 MiB\n  let pending: Array<() => void> = [];\n  ch.addEventListener('bufferedamountlow', () => {\n    const q = pending;\n    pending = [];\n    q.forEach(fn => fn());\n  });\n  const waitLow = () => new Promise<void>(resolve => {\n    if (ch.bufferedAmount <= ch.bufferedAmountLowThreshold) return resolve();\n    pending.push(resolve);\n  });\n  return async (chunk: ArrayBuffer) => {\n    if (ch.readyState !== 'open') return;\n    if (ch.bufferedAmount > ch.bufferedAmountLowThreshold) await waitLow();\n    ch.send(chunk);\n  };\n};\n