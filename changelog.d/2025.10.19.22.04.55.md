# 2025.10.19.22.04.54.md

## Dual Store Cleanup for Agent CLI

### Changes Made

- Enhanced `AgentCLI.ts` to properly manage DualStoreManager instances
- Added cleanup handlers for SIGINT, SIGTERM, and process exit events
- Implemented post-action hook to ensure stores are cleaned up after each command
- Added store instance tracking to enable proper cleanup

### Technical Details

- Store instances are now tracked in module-level variables
- Cleanup function properly closes MongoDB connections via DualStoreManager.cleanup()
- Error handling prevents cleanup failures from affecting CLI operation
- Both session and agent task stores are cleaned up consistently

### Files Modified

- `packages/opencode-client/src/cli/AgentCLI.ts`: Added cleanup functionality

### Verification

- TypeScript compilation successful
- Cleanup functionality tested and working
- Main CLI already had proper cleanup implemented
