piper: serialize in-process JS steps and restore globals on timeout
