# Fixed: Kanban Column Underscore Normalization Bug

## Issue

Column names with underscores (like "in_progress") were being incorrectly normalized to "inprogress", breaking core kanban functionality and transition validation.

## Root Cause

Multiple components were stripping underscores from column names during normalization:

- `packages/kanban/src/lib/kanban.ts` - regex pattern `/[^a-z0-9]+/g` stripped underscores
- `packages/kanban/src/cli/command-handlers.ts` - regex pattern `/[\s_-]/g` stripped underscores
- `packages/kanban/src/lib/transition-rules.ts` - regex pattern `/[^a-z0-9]+/g` stripped underscores
- `docs/agile/rules/kanban-transitions.clj` - regex pattern `#"[\s_-]"` stripped underscores
- `packages/kanban/src/lib/transition-rules.ts` - workflow array had "inprogress" instead of "in_progress"

## Fix Applied

Changed regex patterns to preserve underscores:

- TypeScript files: Changed `/[^a-z0-9]+/g` to `/[^a-z0-9_]+/g`
- TypeScript files: Changed `/[\s_-]/g` to `/\s+/g`
- Clojure file: Changed `#"[\s_-]"` to `#"\s+"`
- Fixed workflow array to use "in_progress" consistently

## Validation

✅ `pnpm kanban update-status <uuid> in_progress` works without errors
✅ `pnpm kanban show-transitions` shows correct `todo → in_progress` transition
✅ Multiple underscores work: `time_to_completion`
✅ Mixed separators work correctly
✅ Backward compatibility maintained

## Files Updated

1. packages/kanban/src/lib/kanban.ts
2. packages/kanban/src/cli/command-handlers.ts
3. packages/kanban/src/lib/transition-rules.ts
4. docs/agile/rules/kanban-transitions.clj

## Impact

- Restores proper kanban workflow functionality
- Fixes transition validation for underscore column names
- Maintains backward compatibility with existing column names
- Enables proper use of underscore-separated column names
