2025.10.20.22.04.55.md

# Agent State vs Conversation Context Boundary Clarification

## Problem Identified

Two different "context" systems with conflicting names:

- `@promethean-os/persistence` ContextStore → conversation compilation for LLMs
- `@promethean-os/agent-context` ContextManager → agent state via event sourcing

## Solution Implemented

### 1. Functional Factory Added

- Created `makeAgentStateManager(deps)` in `agent-context/src/state.ts`
- Provides FP interface for agent state management
- Avoids class-based DefaultContextManager

### 2. Clear Documentation

- Added package header explaining this is AGENT STATE, not conversation context
- Updated package.json description to clarify purpose
- Added deprecation alias `LegacyAgentStateManager`

### 3. Import Guardrails

- Added ESLint rules preventing incorrect imports:
  - Block `ContextStore` class import (use `makeContextStore`)
  - Block `DefaultContextManager` import (use `makeAgentStateManager`)

## Usage Patterns

### Conversation Context (LLM messages)

```ts
import { makeContextStore } from '@promethean-os/persistence';
const ctx = makeContextStore(deps);
const messages = await ctx.compileContext(opts);
```

### Agent State (event sourcing)

```ts
import { makeAgentStateManager } from '@promethean-os/agents/agent-context';
const state = makeAgentStateManager(deps);
await state.appendEvent(event);
```

## Status

Boundary is now explicit. Both systems can coexist without confusion.
