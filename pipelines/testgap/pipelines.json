{
  "pipelines": [
    {
      "name": "test-gap",
      "steps": [
        {
          "id": "tg-exports",
          "shell": "pnpm --filter @promethean/testgap tg:01-scan-exports --root packages --out .cache/testgap/exports.json",
          "inputs": [
            "packages/**/package.json",
            "packages/**/{src,lib}/**/*.{ts,tsx,js,jsx}"
          ],
          "inputSchema": "packages/testgap/schemas/io.schema.json",
          "outputs": [".cache/testgap/exports.json"],
          "outputSchema": "packages/testgap/schemas/io.schema.json"
        },
        {
          "id": "tg-tests",
          "shell": "pnpm -w -r test -- --coverage"
        },
        {
          "id": "tg-coverage",
          "deps": ["tg-tests"],
          "shell": "pnpm --filter @promethean/testgap tg:02-read-coverage --lcov-globs \"{coverage/lcov.info,packages/**/coverage/lcov.info}\" --out .cache/testgap/coverage.json",
          "inputs": ["coverage/lcov.info", "packages/**/coverage/lcov.info"],
          "inputSchema": "packages/testgap/schemas/io.schema.json",
          "outputs": [".cache/testgap/coverage.json"],
          "outputSchema": "packages/testgap/schemas/io.schema.json"
        },
        {
          "id": "tg-map",
          "deps": ["tg-exports", "tg-coverage"],
          "shell": "pnpm --filter @promethean/testgap tg:03-map-gaps --exports .cache/testgap/exports.json --coverage .cache/testgap/coverage.json --min-lines 3 --out .cache/testgap/gaps.json",
          "inputs": [
            ".cache/testgap/exports.json",
            ".cache/testgap/coverage.json"
          ],
          "inputSchema": "packages/testgap/schemas/io.schema.json",
          "outputs": [".cache/testgap/gaps.json"],
          "outputSchema": "packages/testgap/schemas/io.schema.json"
        },
        {
          "id": "tg-gate",
          "deps": ["tg-map"],
          "shell": "pnpm --filter @promethean/testgap tg:08-gate --gaps .cache/testgap/gaps.json --out .cache/testgap/gate.json --threshold 0.70 --metric symbols",
          "inputs": [".cache/testgap/gaps.json"],
          "inputSchema": "packages/testgap/schemas/io.schema.json",
          "outputs": [".cache/testgap/gate.json"],
          "outputSchema": "packages/testgap/schemas/io.schema.json"
        },
        {
          "id": "tg-cookbook",
          "deps": ["tg-map"],
          "shell": "pnpm --filter @promethean/testgap tg:04-cookbook-cross --recipes docs/cookbook/**/*.md --out .cache/testgap/cookbook.json",
          "inputs": ["docs/cookbook/**/*.md"],
          "inputSchema": "packages/testgap/schemas/io.schema.json",
          "outputs": [".cache/testgap/cookbook.json"],
          "outputSchema": "packages/testgap/schemas/io.schema.json"
        },
        {
          "id": "tg-plan",
          "deps": ["tg-cookbook"],
          "shell": "pnpm --filter @promethean/testgap tg:05-plan --gaps .cache/testgap/gaps.json --cookbook .cache/testgap/cookbook.json --out .cache/testgap/plans.json --model qwen3:4b --threshold 0.5 --max-per-pkg 15",
          "env": {
            "OLLAMA_URL": "${OLLAMA_URL}"
          },
          "inputs": [
            ".cache/testgap/gaps.json",
            ".cache/testgap/cookbook.json"
          ],
          "inputSchema": "packages/testgap/schemas/io.schema.json",
          "outputs": [".cache/testgap/plans.json"],
          "outputSchema": "packages/testgap/schemas/io.schema.json"
        },
        {
          "id": "tg-write",
          "deps": ["tg-plan"],
          "shell": "pnpm --filter @promethean/testgap tg:06-write --plans .cache/testgap/plans.json --out docs/agile/tasks/test-gaps",
          "inputs": [".cache/testgap/plans.json"],
          "inputSchema": "packages/testgap/schemas/io.schema.json",
          "outputs": ["docs/agile/tasks/test-gaps/*.md"],
          "outputSchema": "packages/testgap/schemas/io.schema.json"
        },
        {
          "id": "tg-report",
          "deps": ["tg-map"],
          "shell": "pnpm --filter @promethean/testgap tg:07-report --gaps .cache/testgap/gaps.json --out docs/agile/reports/test-gaps",
          "inputs": [".cache/testgap/gaps.json"],
          "inputSchema": "packages/testgap/schemas/io.schema.json",
          "outputs": ["docs/agile/reports/test-gaps/*.md"],
          "outputSchema": "packages/testgap/schemas/io.schema.json"
        }
      ]
    }
  ]
}
