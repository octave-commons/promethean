---
```
uuid: c03020e1-e3e7-48bf-aa7e-aa740c601b63
```
```
created_at: 2025.08.31.11.25.22.md
```
filename: Per-Domain Policy System for JS Crawler
```
description: >-
```
  A YAML-based policy system for configuring JS crawlers with per-domain rules,
  throttling, authentication, and resource blocking. Enables fine-grained
  control over crawling behavior without Python or SaaS dependencies.
tags:
  - policy
  - crawling
  - yaml
  - throttling
  - authentication
  - resource-blocking
  - domain-specific
```
related_to_title:
```
  - Pure-Node Crawl Stack with Playwright and Crawlee
  - 'Agent Tasks: Persistence Migration to DualStore'
  - Migrate to Provider-Tenant Architecture
  - Promethean Infrastructure Setup
  - eidolon-field-math-foundations
  - Chroma Toolkit Consolidation Plan
  - Promethean Web UI Setup
  - ecs-offload-workers
  - Prometheus Observability Stack
  - prom-lib-rate-limiters-and-replay-api
  - aionian-circuit-math
  - Math Fundamentals
  - Dynamic Context Model for Web Components
  - api-gateway-versioning
  - Debugging Broker Connections and Agent Behavior
  - Cross-Target Macro System in Sibilant
  - Promethean-native config design
  - Promethean Agent Config DSL
  - Promethean Event Bus MVP v0.1
  - Local-Only-LLM-Workflow
  - Shared Package Structure
```
related_to_uuid:
```
  - d527c05d-22e8-4493-8f29-ae3cb67f035b
  - 93d2ba51-8689-49ee-94e2-296092e48058
  - 54382370-1931-4a19-a634-46735708a9ea
  - 6deed6ac-2473-40e0-bee0-ac9ae4c7bff2
  - 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
  - 5020e892-8f18-443a-b707-6d0f3efcfe22
  - bc5172ca-7a09-42ad-b418-8e42bb14d089
  - 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
  - e90b5a16-d58f-424d-bd36-70e9bd2861ad
  - aee4718b-9f8b-4635-a0c1-ef61c9bea8f1
  - f2d83a77-7f86-4c56-8538-1350167a0c6c
  - c6e87433-ec5d-4ded-bb1a-fb8734a3cfd9
  - f7702bf8-f7db-473c-9a5b-8dbf66ad3b9e
  - 0580dcd3-533d-4834-8a2f-eae3771960a9
  - 73d3dbf6-9240-46fd-ada9-cc2e7e00dc5f
  - 5f210ca2-54e9-445b-afe4-fb340d4992c5
  - ab748541-020e-4a7e-b07d-28173bd5bea2
  - 2c00ce45-08cf-4b81-9883-6157f30b7fae
  - fe7193a2-a5f7-4b3c-bea0-bd028815fc2c
  - 9a8ab57e-507c-4c6b-aab4-01cea1bc0501
  - 66a72fc3-4153-41fc-84bd-d6164967a6ff
references:
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 8
    col: 3
    score: 0.95
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 38
    col: 4
    score: 0.93
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 38
    col: 6
    score: 0.93
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 98
    col: 3
    score: 0.92
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 98
    col: 5
    score: 0.92
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 100
    col: 1
    score: 0.89
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 100
    col: 3
    score: 0.89
  - uuid: d527c05d-22e8-4493-8f29-ae3cb67f035b
    line: 107
    col: 1
    score: 1
  - uuid: 6deed6ac-2473-40e0-bee0-ac9ae4c7bff2
    line: 287
    col: 1
    score: 0.86
  - uuid: d527c05d-22e8-4493-8f29-ae3cb67f035b
    line: 223
    col: 1
    score: 0.95
  - uuid: d527c05d-22e8-4493-8f29-ae3cb67f035b
    line: 389
    col: 1
    score: 0.86
  - uuid: d527c05d-22e8-4493-8f29-ae3cb67f035b
    line: 421
    col: 1
    score: 0.91
  - uuid: 6deed6ac-2473-40e0-bee0-ac9ae4c7bff2
    line: 580
    col: 1
    score: 1
  - uuid: 6deed6ac-2473-40e0-bee0-ac9ae4c7bff2
    line: 580
    col: 3
    score: 1
  - uuid: bc5172ca-7a09-42ad-b418-8e42bb14d089
    line: 607
    col: 1
    score: 1
  - uuid: bc5172ca-7a09-42ad-b418-8e42bb14d089
    line: 607
    col: 3
    score: 1
  - uuid: e90b5a16-d58f-424d-bd36-70e9bd2861ad
    line: 509
    col: 1
    score: 1
  - uuid: e90b5a16-d58f-424d-bd36-70e9bd2861ad
    line: 509
    col: 3
    score: 1
  - uuid: 6deed6ac-2473-40e0-bee0-ac9ae4c7bff2
    line: 597
    col: 1
    score: 0.94
  - uuid: 6deed6ac-2473-40e0-bee0-ac9ae4c7bff2
    line: 597
    col: 3
    score: 0.94
  - uuid: 5020e892-8f18-443a-b707-6d0f3efcfe22
    line: 173
    col: 1
    score: 1
  - uuid: 5020e892-8f18-443a-b707-6d0f3efcfe22
    line: 173
    col: 3
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 133
    col: 1
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 133
    col: 3
    score: 1
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 266
    col: 1
    score: 1
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 266
    col: 3
    score: 1
  - uuid: aee4718b-9f8b-4635-a0c1-ef61c9bea8f1
    line: 390
    col: 1
    score: 1
  - uuid: aee4718b-9f8b-4635-a0c1-ef61c9bea8f1
    line: 390
    col: 3
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 131
    col: 1
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 131
    col: 3
    score: 1
  - uuid: 5020e892-8f18-443a-b707-6d0f3efcfe22
    line: 169
    col: 1
    score: 1
  - uuid: 5020e892-8f18-443a-b707-6d0f3efcfe22
    line: 169
    col: 3
    score: 1
  - uuid: 5f210ca2-54e9-445b-afe4-fb340d4992c5
    line: 175
    col: 1
    score: 1
  - uuid: 5f210ca2-54e9-445b-afe4-fb340d4992c5
    line: 175
    col: 3
    score: 1
  - uuid: f7702bf8-f7db-473c-9a5b-8dbf66ad3b9e
    line: 392
    col: 1
    score: 1
  - uuid: f7702bf8-f7db-473c-9a5b-8dbf66ad3b9e
    line: 392
    col: 3
    score: 1
  - uuid: 0580dcd3-533d-4834-8a2f-eae3771960a9
    line: 284
    col: 1
    score: 1
  - uuid: 0580dcd3-533d-4834-8a2f-eae3771960a9
    line: 284
    col: 3
    score: 1
  - uuid: 73d3dbf6-9240-46fd-ada9-cc2e7e00dc5f
    line: 40
    col: 1
    score: 1
  - uuid: 73d3dbf6-9240-46fd-ada9-cc2e7e00dc5f
    line: 40
    col: 3
    score: 1
  - uuid: f7702bf8-f7db-473c-9a5b-8dbf66ad3b9e
    line: 384
    col: 1
    score: 1
  - uuid: f7702bf8-f7db-473c-9a5b-8dbf66ad3b9e
    line: 384
    col: 3
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 458
    col: 1
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 458
    col: 3
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 133
    col: 1
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 133
    col: 3
    score: 1
  - uuid: f2d83a77-7f86-4c56-8538-1350167a0c6c
    line: 151
    col: 1
    score: 1
  - uuid: f2d83a77-7f86-4c56-8538-1350167a0c6c
    line: 151
    col: 3
    score: 1
  - uuid: c6e87433-ec5d-4ded-bb1a-fb8734a3cfd9
    line: 14
    col: 1
    score: 1
  - uuid: c6e87433-ec5d-4ded-bb1a-fb8734a3cfd9
    line: 14
    col: 3
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 460
    col: 1
    score: 1
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 460
    col: 3
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 159
    col: 1
    score: 1
  - uuid: 008f2ac0-bfaa-4d52-9826-2d5e86c0059f
    line: 159
    col: 3
    score: 1
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 288
    col: 1
    score: 1
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 288
    col: 3
    score: 1
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 295
    col: 1
    score: 1
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 295
    col: 3
    score: 1
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 293
    col: 1
    score: 1
  - uuid: 54382370-1931-4a19-a634-46735708a9ea
    line: 293
    col: 3
    score: 1
  - uuid: ab748541-020e-4a7e-b07d-28173bd5bea2
    line: 403
    col: 1
    score: 1
  - uuid: ab748541-020e-4a7e-b07d-28173bd5bea2
    line: 403
    col: 3
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 143
    col: 1
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 143
    col: 3
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 152
    col: 1
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 152
    col: 3
    score: 1
  - uuid: fe7193a2-a5f7-4b3c-bea0-bd028815fc2c
    line: 902
    col: 1
    score: 1
  - uuid: fe7193a2-a5f7-4b3c-bea0-bd028815fc2c
    line: 902
    col: 3
    score: 1
  - uuid: ab748541-020e-4a7e-b07d-28173bd5bea2
    line: 404
    col: 1
    score: 1
  - uuid: ab748541-020e-4a7e-b07d-28173bd5bea2
    line: 404
    col: 3
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 153
    col: 1
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 153
    col: 3
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 144
    col: 1
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 144
    col: 3
    score: 1
  - uuid: fe7193a2-a5f7-4b3c-bea0-bd028815fc2c
    line: 903
    col: 1
    score: 1
  - uuid: fe7193a2-a5f7-4b3c-bea0-bd028815fc2c
    line: 903
    col: 3
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 145
    col: 1
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 145
    col: 3
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 142
    col: 1
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 142
    col: 3
    score: 1
  - uuid: 5020e892-8f18-443a-b707-6d0f3efcfe22
    line: 179
    col: 1
    score: 1
  - uuid: 5020e892-8f18-443a-b707-6d0f3efcfe22
    line: 179
    col: 3
    score: 1
  - uuid: 2c00ce45-08cf-4b81-9883-6157f30b7fae
    line: 321
    col: 1
    score: 1
  - uuid: 2c00ce45-08cf-4b81-9883-6157f30b7fae
    line: 321
    col: 3
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 146
    col: 1
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 146
    col: 3
    score: 1
  - uuid: 2c00ce45-08cf-4b81-9883-6157f30b7fae
    line: 322
    col: 1
    score: 1
  - uuid: 2c00ce45-08cf-4b81-9883-6157f30b7fae
    line: 322
    col: 3
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 141
    col: 1
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 141
    col: 3
    score: 1
  - uuid: 5020e892-8f18-443a-b707-6d0f3efcfe22
    line: 178
    col: 1
    score: 1
  - uuid: 5020e892-8f18-443a-b707-6d0f3efcfe22
    line: 178
    col: 3
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 158
    col: 1
    score: 0.99
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 158
    col: 3
    score: 0.99
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 159
    col: 1
    score: 1
  - uuid: 93d2ba51-8689-49ee-94e2-296092e48058
    line: 159
    col: 3
    score: 1
  - uuid: d527c05d-22e8-4493-8f29-ae3cb67f035b
    line: 432
    col: 1
    score: 1
  - uuid: d527c05d-22e8-4493-8f29-ae3cb67f035b
    line: 432
    col: 3
    score: 1
  - uuid: 9a8ab57e-507c-4c6b-aab4-01cea1bc0501
    line: 189
    col: 1
    score: 0.99
  - uuid: 9a8ab57e-507c-4c6b-aab4-01cea1bc0501
    line: 189
    col: 3
    score: 0.99
  - uuid: 66a72fc3-4153-41fc-84bd-d6164967a6ff
    line: 174
    col: 1
    score: 0.99
  - uuid: 66a72fc3-4153-41fc-84bd-d6164967a6ff
    line: 174
    col: 3
    score: 0.99
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 476
    col: 1
    score: 0.99
  - uuid: 6498b9d7-bd35-4bd3-89fb-af1c415c3cd1
    line: 476
    col: 3
    score: 0.99
---
Roger. Here’s a clean **per-domain policy system** wired into your JS crawler — no Python, no SaaS. You get a single YAML file to tune throttles, allow/deny rules, login steps, headers/cookies, extraction rules, proxy overrides (e.g., Tor via Privoxy), and per-domain limits. Drop these files in, set one env var, and go.

---

## 0) Compose tweak (point crawler at policies file)

Add one env var + mount (keeps your code immutable):

```yaml
  crawler-js:
    # ...
    environment:
      - POLICY_FILE=/workspace/policies.yaml
      # rest unchanged (PROXY_URL still works as global default)
    volumes:
      - ./infra/crawler-js:/workspace:rw
      - crawl_data:/data
      - crawl_storage:/workspace/storage
```

---

## 1) Policy file (YAML)

`infra/crawler-js/policies.yaml`

```yaml
# Global defaults (used when no domain match)
defaults:
  sameDomainOnly: true
  respectRobots: true
  concurrency: 4          # per crawler (we still cap globally)
  rpm: 120                # requests per minute cap
  maxPages: 200           # global cap (crawler’s maxRequestsPerCrawl)
  maxDepth: 3             # link hop depth (0 = only seed)
  delayMs: 250            # base delay between requests
  jitterMs: 200           # random +/- added to delay
  retries: 2              # per-request retries
  dedupNormalize: true
  sitemapDiscover: true
  rssDiscover: true
  blockResources: ["image", "media", "font", "stylesheet"]  # save bandwidth
  allow: []              # regex list (case-insensitive); empty = allow all
  deny: []               # regex list; any match = block
  headers:               # sent on every request for matching domains
    Accept-Language: "en-US,en;q=0.9"
  cookies: []            # [{ name, value, domain, path, httpOnly, secure }]
  proxy: ""              # override (e.g., http://privoxy:8118). Empty = use PROXY_URL env.
  extractor:
    mode: "article"      # 'article' | 'simple' | 'raw'
    keepHtml: false

# Domain-specific overrides (first match wins). domains: list of host globs or regex.
domains:

  - name: "Hacker News"
    domains: ["news.ycombinator.com"]
    sameDomainOnly: true
    rpm: 60
    concurrency: 2
    maxPages: 500
    allow: ["^https://news\\.ycombinator\\.com/"]
    deny: ["\\.gif", "\\.png", "\\.jpg"]
    extractor:
      mode: "simple"
      keepHtml: false

  - name: "Example Blog with login"
    domains: ["blog.example.com", "/^sub\\d+\\.example\\.com/"]
    rpm: 30
    concurrency: 2
    maxDepth: 2
    proxy: "http://privoxy:8118"         # force Tor just for this domain
    headers:
      User-Agent: "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome Safari"
    cookies:
      - name: "cookie_consent"
        value: "yes"
        domain: ".example.com"
        path: "/"
        httpOnly: false
        secure: false
    login:                                # run once per origin before crawling links
      steps:
        - goto: "https://blog.example.com/login"
        - type: { selector: "input[name='username']", text: "local_user" }
        - type: { selector: "input[name='password']", text: "local_pass" }
        - click: { selector: "button[type='submit']" }
        - waitForSelector: { selector: "nav .user-avatar", timeoutMs: 15000 }
    extractor:
      mode: "article"
      keepHtml: false

  - name: "Docs site (HTML only, no JS)"
    domains: ["docs.example.org"]
    blockResources: ["*"]  # block all non-doc requests
    sitemapDiscover: true
    rssDiscover: false
    extractor:
      mode: "raw"
      keepHtml: true

# Optional: explicit seeds (in addition to CRAWL_SEED env)
seeds:
  - "https://news.ycombinator.com/"
  - "https://docs.example.org/"
```

**How matching works:** `domains[].domains` accepts either host globs e.g., `*.example.com` or regex strings delimited with `/.../`. First match wins.

---

## 2) Add a tiny YAML dep

`infra/crawler-js/package.json` — add `yaml`

```json
{
  "name": "crawler-js",
  "private": true,
  "type": "module",
  "scripts": { "start": "node src/crawl.js" },
  "dependencies": {
    "crawlee": "^3.9.2",
    "playwright": "^1.47.2",
    "robots-parser": "^3.0.1",
    "node-fetch": "^3.3.2",
    "fast-xml-parser": "^4.5.0",
    "p-limit": "^6.2.0",
    "yaml": "^2.5.1"
  }
}
```

---

## 3) Wire policies into the crawler

### `infra/crawler-js/src/utils.js` (additions)

```js
import fs from 'node:fs';
import path from 'node:path';
import YAML from 'yaml';

export function loadPolicies(filePath) {
  const p = filePath || process.env.POLICY_FILE || '/workspace/policies.yaml';
  const raw = fs.readFileSync(p, 'utf8');
  const cfg = YAML.parse(raw);
  cfg.defaults ||= {};
  cfg.domains ||= [];
  cfg.seeds ||= [];
  // preprocess domain matchers
  for (const d of cfg.domains) {
    d._matchers = (d.domains || []).map(s => {
      if (s.startsWith('/') && s.endsWith('/')) return { type: 're', re: new RegExp(s.slice(1, -1), 'i') };
      // glob-ish → convert dots and * to regex
      const rx = '^' + s.replace(/[.+?^{}()|[\]\\]/g, '\\&').replace(/\*/g, '.*') + '';
      return { type: 'glob', re: new RegExp(rx, 'i') };
    });
  }
  return cfg;
}

export function matchPolicyFor(url, policies) {
  const host = new URL(url).hostname;
  for (const d of policies.domains) {
    if (d._matchers?.some(m => m.re.test(host))) return d;
  }
  return policies.defaults || {};
}

export function compileRegexList(csvOrList) {
  if (!csvOrList) return [];
  const items = Array.isArray(csvOrList) ? csvOrList : String(csvOrList).split(',');
  return items.map(s => s.trim()).filter(Boolean).map(s => new RegExp(s, 'i'));
}
```

$Keep your previous helpers like `sleep`, `normalizeUrlForDedup`, `buildRobotsForOrigin`, `decideUrl`—they still apply, just feed them policy-specific values.

### `infra/crawler-js/src/crawl.js` replaced core with policy-aware flow

```js
import { PlaywrightCrawler, KeyValueStore, Dataset, log, Configuration } from 'crawlee';
import fs from 'node:fs';
import path from 'node:path';
import { Agent as HttpProxyAgent } from 'node:http';
import { Agent as HttpsProxyAgent } from 'node:https';
import { XMLParser } from 'fast-xml-parser';
import fetch from 'node-fetch';
import uaPool from './ua.json' assert { type: 'json' };
import { sleep, compileRegexList, normalizeUrlForDedup, buildRobotsForOrigin, decideUrl, loadPolicies, matchPolicyFor } from './utils.js';
import { sinkToOpenSearch, sinkToMeili } from './sinks.js';

const policies = loadPolicies();
const globalDefaults = policies.defaults || {};
const envSeed = process.env.CRAWL_SEED;
const initialSeeds = new Set([].concat(policies.seeds || [], envSeed ? [envSeed] : []));

const outputDir = process.env.OUTPUT_DIR || '/data';
fs.mkdirSync(outputDir, { recursive: true });
const outPath = path.join(outputDir, 'out.jsonl');
const appendJSONL = (o) => fs.appendFileSync(outPath, JSON.stringify(o) + '\n');

// sinks (still optional/local)
const OS_URL = process.env.SINK_OPENSEARCH_URL || '';
const OS_INDEX = process.env.SINK_OPENSEARCH_INDEX || 'documents';
const MEILI_URL = process.env.SINK_MEILI_URL || '';
const MEILI_KEY = process.env.SINK_MEILI_KEY || '';
const MEILI_INDEX = process.env.SINK_MEILI_INDEX || 'documents';

function rotateUA(i) {
  return uaPool[i % uaPool.length] || uaPool[0];
}

function buildProxyAgents(url, policy) {
  const override = policy.proxy && policy.proxy.trim() ? policy.proxy.trim() : (process.env.PROXY_URL || '').trim();
  if (!override) return { httpAgent: undefined, httpsAgent: undefined, proxyUrl: '' };
  return {
    httpAgent: new HttpProxyAgent(override),
    httpsAgent: new HttpsProxyAgent(override),
    proxyUrl: override
  };
}

async function discoverSitemaps(origin, agents, enable) {
  if (!enable) return [];
  try {
    const res = await fetch(`{origin}/sitemap.xml`, { agent: origin.startsWith('https') ? agents.httpsAgent : agents.httpAgent, timeout: 10000 });
    if (!res.ok) return [];
    const xml = await res.text();
    const parser = new XMLParser({ ignoreAttributes: false });
    const j = parser.parse(xml);
    const urls = [];
    if (j.urlset?.url) {
      const arr = Array.isArray(j.urlset.url) ? j.urlset.url : [j.urlset.url];
      for (const u of arr) if (u.loc) urls.push(u.loc);
    }
    if (j.sitemapindex?.sitemap) {
      const arr = Array.isArray(j.sitemapindex.sitemap) ? j.sitemapindex.sitemap : [j.sitemapindex.sitemap];
      for (const sm of arr) if (sm.loc) urls.push(sm.loc);
    }
    return urls;
  } catch { return []; }
}

async function discoverRSS(origin, agents, enable) {
  if (!enable) return [];
  try {
    const res = await fetch(origin, { agent: origin.startsWith('https') ? agents.httpsAgent : agents.httpAgent, timeout: 10000 });
    if (!res.ok) return [];
    const html = await res.text();
    const matches = [...html.matchAll(/<link[^>]+type=['"]application\/(rss\+xml|atom\+xml)['"][^>]*>/gi)];
    const urls = [];
    for (const m of matches) {
      const href = (m[0].match(/href=['"]([^'"]+)['"]/i) || [])[1];
      if (href) urls.push(new URL(href, origin).toString());
    }
    return urls;
  } catch { return []; }
}

function extractByMode(mode, keepHtml, page) {
  return page.content().then(async html => {
    if (mode === 'raw') return keepHtml ? { html } : { text: html.replace(/\s+/g, ' ').slice(0, 500000) };
    if (mode === 'simple') {
      const title = await page.title().catch(()=> '');
      const text = await page.eval('body', el => el.innerText).catch(()=> '');
      return keepHtml ? { title, html } : { title, text };
    }
    // 'article' heuristic (cheap)
    const title = await page.title().catch(()=> '');
    const meta = {};
    for (const n of ['og:title','og:description','description','article:author','author','og:site_name','article:published_time']) {
      try {
        meta[n] = await page.eval(`meta[property="{n}"],meta[name="{n}"]`, el => el.content);
      } catch {}
    }
    const mainText = await page.eval('main', el => el.innerText).catch(async () =>
      page.eval('article', el => el.innerText).catch(async () =>
        page.eval('body', el => el.innerText).catch(()=> '')
      )
    );
    return keepHtml ? { title, meta, html } : { title, meta, text: mainText };
  });
}

// cache: per-origin login done
const loginDone = new Set();

Configuration.set({ persistStorage: true, storageDir: './storage' });

const crawler = new PlaywrightCrawler({
  maxRequestsPerCrawl: +(process.env.CRAWL_MAX_PAGES || globalDefaults.maxPages || 200),
  maxConcurrency: +(process.env.CRAWL_CONCURRENCY || globalDefaults.concurrency || 4),
  maxRequestsPerMinute: +(process.env.CRAWL_REQS_PER_MIN || globalDefaults.rpm || 120),
  headless: true,
  requestHandlerTimeoutSecs: 90,
  launchContext: { launchOptions: { args: ['--no-sandbox', '--disable-dev-shm-usage'] } },

  async preNavigationHooks([{ request, page, session }, gotoOptions]) {
    const pol = matchPolicyFor(request.url, policies);
    const seedOrigin = new URL(request.url).origin;
    const allow = compileRegexList(pol.allow || globalDefaults.allow || []);
    const deny = compileRegexList(pol.deny || globalDefaults.deny || []);
    const sameDomainOnly = pol.sameDomainOnly ?? globalDefaults.sameDomainOnly ?? true;
    const respectRobots = pol.respectRobots ?? globalDefaults.respectRobots ?? true;
    const dedupNormalize = pol.dedupNormalize ?? globalDefaults.dedupNormalize ?? true;

    const agents = buildProxyAgents(request.url, pol);
    const urlToFetch = dedupNormalize ? normalizeUrlForDedup(request.url) : request.url;

    if (!decideUrl(urlToFetch, { sameDomainOnly, seedOrigin, allow, deny })) {
      request.noRetry = true; throw new Error('Filtered: allow/deny or cross-domain');
    }

    if (respectRobots) {
      const rb = await buildRobotsForOrigin(new URL(urlToFetch).origin, urlToFetch.startsWith('https') ? agents.httpsAgent : agents.httpAgent);
      if (!rb.isAllowed(urlToFetch, 'PrometheanCrawler')) {
        request.noRetry = true; throw new Error('Robots disallow');
      }
    }

    // headers and cookies
    const headers = { ...(globalDefaults.headers||{}), ...(pol.headers||{}) };
    request.headers = { ...(request.headers||{}), ...headers, 'User-Agent': request.headers?.['User-Agent'] || (session?.id ? rotateUA(parseInt(session.id,10)) : rotateUA(Math.floor(Math.random()*1000))) };

    if ((pol.cookies && pol.cookies.length) || (globalDefaults.cookies && globalDefaults.cookies.length)) {
      const cookies = [...(globalDefaults.cookies || []), ...(pol.cookies || [])];
      if (cookies.length) await page.context().addCookies(cookies);
    }

    // resource blocking
    const blockRules = (pol.blockResources?.length ? pol.blockResources : globalDefaults.blockResources) || [];
    if (blockRules.length) {
      await page.route('**/*', route => {
        const req = route.request();
        const type = req.resourceType();
        if (blockRules.includes('*') || blockRules.includes(type)) return route.abort();
        return route.continue();
      });
    }

    // per-domain login (once per origin)
    if (pol.login && !loginDone.has(seedOrigin)) {
      await page.context().clearCookies().catch(()=>{});
      for (const step of pol.login.steps || []) {
        if (step.goto) await page.goto(step.goto, { waitUntil: 'domcontentloaded', timeout: 30000 });
        if (step.type) await page.fill(step.type.selector, step.type.text, { timeout: 15000 });
        if (step.click) await page.click(step.click.selector, { timeout: 15000 });
        if (step.waitForSelector) await page.waitForSelector(step.waitForSelector.selector, { timeout: step.waitForSelector.timeoutMs || 15000 });
      }
      loginDone.add(seedOrigin);
    }

    // delay/jitter
    const base = +(pol.delayMs ?? globalDefaults.delayMs ?? 0);
    const jit = +(pol.jitterMs ?? globalDefaults.jitterMs ?? 0);
    if (base || jit) await new Promise(r => setTimeout(r, base + Math.floor(Math.random() * (jit + 1))));

    // proxy
    if (agents.proxyUrl) gotoOptions.proxy = { server: agents.proxyUrl };

    gotoOptions.waitUntil = 'domcontentloaded';
  },

  async requestHandler({ request, page, enqueueLinks }) {
    const pol = matchPolicyFor(request.url, policies);
    const dedupNormalize = pol.dedupNormalize ?? globalDefaults.dedupNormalize ?? true;

    const url = dedupNormalize ? normalizeUrlForDedup(request.url) : request.url;
    const title = await page.title().catch(()=>'');
    const now = new Date().toISOString();

    // extraction
    const mode = pol.extractor?.mode || globalDefaults.extractor?.mode || 'article';
    const keepHtml = pol.extractor?.keepHtml ?? globalDefaults.extractor?.keepHtml ?? false;
    const body = await extractByMode(mode, keepHtml, page);

    const doc = { url, title, fetched_at: now, ...body };

    appendJSONL(doc);
    await Dataset.pushData(doc);
    await sinkToOpenSearch([doc], { url: OS_URL, index: OS_INDEX });
    await sinkToMeili([doc], { url: MEILI_URL, index: MEILI_INDEX, apiKey: MEILI_KEY });

    // depth-aware enqueuing
    const sameDomainOnly = pol.sameDomainOnly ?? globalDefaults.sameDomainOnly ?? true;
    const allow = compileRegexList(pol.allow || globalDefaults.allow || []);
    const deny = compileRegexList(pol.deny || globalDefaults.deny || []);
    const maxDepth = +(pol.maxDepth ?? globalDefaults.maxDepth ?? 3);

    const { depth = 0 } = request.userData || {};
    if (depth < maxDepth) {
      await enqueueLinks({
        strategy: sameDomainOnly ? 'same-domain' : 'all',
        transformRequestFunction: (req) => {
          // filter by allow/deny as we queue
          if (!decideUrl(req.url, { sameDomainOnly, seedOrigin: new URL(request.url).origin, allow, deny })) return null;
          const next = dedupNormalize ? normalizeUrlForDedup(req.url) : req.url;
          return { url: next, userData: { depth: depth + 1 } };
        }
      });
    }
  },

  async failedRequestHandler({ request, error }) {
    appendJSONL({ url: request.url, error: String(error), failed_at: new Date().toISOString() });
  }
});

// bootstrap queue with policy seeds + env seed + optional sitemap/rss per domain
const rq = await KeyValueStore.open();
await rq.setValue('__meta__', { seeds: [...initialSeeds], started_at: new Date().toISOString() });

const seeds = new Set(initialSeeds);
for (const s of seeds) {
  const pol = matchPolicyFor(s, policies);
  const agents = buildProxyAgents(s, pol);
  const origin = new URL(s).origin;
  const sm = await discoverSitemaps(origin, agents, pol.sitemapDiscover ?? globalDefaults.sitemapDiscover ?? true);
  const rss = await discoverRSS(origin, agents, pol.rssDiscover ?? globalDefaults.rssDiscover ?? true);
  for (const u of sm) seeds.add(u);
  for (const u of rss) seeds.add(u);
}

log.setLevel(log.LEVELS.INFO);
await crawler.run([...seeds]);
console.log(`JSONL: {outPath}`);
```

---

## 4) Run examples
```
**Local, no Tor:**
```
```bash
POLICY_FILE=./infra/crawler-js/policies.yaml \
docker compose --profile crawl-js up --build crawler-js
```

**Through Tor/Privoxy (for matching domains only):**

```bash
docker compose --profile crawl-js --profile tor up -d tor privoxy
POLICY_FILE=./infra/crawler-js/policies.yaml \
docker compose --profile crawl-js up --build crawler-js
```

(Any domain stanza with `proxy: "http://privoxy:8118"` will route via Tor. Everything else follows `PROXY_URL` if set, otherwise direct.)

---

## 5) Why this setup won’t fight you

* **Single source of truth**: `policies.yaml` controls throttles, RPM, depth, allow/deny, robots, headers, cookies, **login**, extract mode, and per-domain proxy.
* **Login once** per origin using deterministic steps goto/type/click/wait.
* **Bandwidth sane**: resource blocking per domain e.g., kill images/fonts on docs sites.
* **Extraction modes**: `article` (cheap heuristic), `simple` title + body text, `raw` (HTML).
* **No surprise egress**: explicit proxy override per domain; keep the rest local.
* **No Python.** All Node, all the time.

If you want, I can add a **domain-local JavaScript extractor hook** in YAML e.g., `extractor.script: "return document.querySelector('article')?.innerText || ''"` that we `page.evaluate()` — gives you surgical control without editing code.

\#webcrawling #javascript #playwright #crawlee #docker #tor #privoxy #selfhosted #opensearch #meilisearch #config-as-code #policies
<!-- GENERATED-SECTIONS:DO-NOT-EDIT-BELOW -->
## Related content
- [pure-node-crawl-stack-with-playwright-and-crawlee|Pure-Node Crawl Stack with Playwright and Crawlee]
- [docs/unique/agent-tasks-persistence-migration-to-dualstore|Agent Tasks: Persistence Migration to DualStore]
- [migrate-to-provider-tenant-architecture|Migrate to Provider-Tenant Architecture]
- [promethean-infrastructure-setup|Promethean Infrastructure Setup]
- [docs/unique/eidolon-field-math-foundations|eidolon-field-math-foundations]
- [chroma-toolkit-consolidation-plan|Chroma Toolkit Consolidation Plan]
- [promethean-web-ui-setup|Promethean Web UI Setup]
- [docs/unique/ecs-offload-workers|ecs-offload-workers]
- [prometheus-observability-stack|Prometheus Observability Stack]
- [prom-lib-rate-limiters-and-replay-api]
- [docs/unique/aionian-circuit-math|aionian-circuit-math]
- [Math Fundamentals]chunks/math-fundamentals.md
- [dynamic-context-model-for-web-components|Dynamic Context Model for Web Components]
- [api-gateway-versioning]
- [Debugging Broker Connections and Agent Behavior]debugging-broker-connections-and-agent-behavior.md
- [cross-target-macro-system-in-sibilant|Cross-Target Macro System in Sibilant]
- [promethean-native-config-design|Promethean-native config design]
- [promethean-agent-config-dsl|Promethean Agent Config DSL]
- [Promethean Event Bus MVP v0.1]promethean-event-bus-mvp-v0-1.md
- [local-only-llm-workflow]
- [shared-package-structure|Shared Package Structure]

## Sources
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L8|Agent Tasks: Persistence Migration to DualStore — L8] (line 8, col 3, score 0.95)
- [migrate-to-provider-tenant-architecture#L38|Migrate to Provider-Tenant Architecture — L38] (line 38, col 4, score 0.93)
- [migrate-to-provider-tenant-architecture#L38|Migrate to Provider-Tenant Architecture — L38] (line 38, col 6, score 0.93)
- [migrate-to-provider-tenant-architecture#L98|Migrate to Provider-Tenant Architecture — L98] (line 98, col 3, score 0.92)
- [migrate-to-provider-tenant-architecture#L98|Migrate to Provider-Tenant Architecture — L98] (line 98, col 5, score 0.92)
- [migrate-to-provider-tenant-architecture#L100|Migrate to Provider-Tenant Architecture — L100] (line 100, col 1, score 0.89)
- [migrate-to-provider-tenant-architecture#L100|Migrate to Provider-Tenant Architecture — L100] (line 100, col 3, score 0.89)
- [pure-node-crawl-stack-with-playwright-and-crawlee#L107|Pure-Node Crawl Stack with Playwright and Crawlee — L107] (line 107, col 1, score 1)
- [promethean-infrastructure-setup#L287|Promethean Infrastructure Setup — L287] (line 287, col 1, score 0.86)
- [pure-node-crawl-stack-with-playwright-and-crawlee#L223|Pure-Node Crawl Stack with Playwright and Crawlee — L223] (line 223, col 1, score 0.95)
- [pure-node-crawl-stack-with-playwright-and-crawlee#L389|Pure-Node Crawl Stack with Playwright and Crawlee — L389] (line 389, col 1, score 0.86)
- [pure-node-crawl-stack-with-playwright-and-crawlee#L421|Pure-Node Crawl Stack with Playwright and Crawlee — L421] (line 421, col 1, score 0.91)
- [promethean-infrastructure-setup#L580|Promethean Infrastructure Setup — L580] (line 580, col 1, score 1)
- [promethean-infrastructure-setup#L580|Promethean Infrastructure Setup — L580] (line 580, col 3, score 1)
- [promethean-web-ui-setup#L607|Promethean Web UI Setup — L607] (line 607, col 1, score 1)
- [promethean-web-ui-setup#L607|Promethean Web UI Setup — L607] (line 607, col 3, score 1)
- [prometheus-observability-stack#L509|Prometheus Observability Stack — L509] (line 509, col 1, score 1)
- [prometheus-observability-stack#L509|Prometheus Observability Stack — L509] (line 509, col 3, score 1)
- [promethean-infrastructure-setup#L597|Promethean Infrastructure Setup — L597] (line 597, col 1, score 0.94)
- [promethean-infrastructure-setup#L597|Promethean Infrastructure Setup — L597] (line 597, col 3, score 0.94)
- [chroma-toolkit-consolidation-plan#L173|Chroma Toolkit Consolidation Plan — L173] (line 173, col 1, score 1)
- [chroma-toolkit-consolidation-plan#L173|Chroma Toolkit Consolidation Plan — L173] (line 173, col 3, score 1)
- [docs/unique/eidolon-field-math-foundations#L133|eidolon-field-math-foundations — L133] (line 133, col 1, score 1)
- [docs/unique/eidolon-field-math-foundations#L133|eidolon-field-math-foundations — L133] (line 133, col 3, score 1)
- [migrate-to-provider-tenant-architecture#L266|Migrate to Provider-Tenant Architecture — L266] (line 266, col 1, score 1)
- [migrate-to-provider-tenant-architecture#L266|Migrate to Provider-Tenant Architecture — L266] (line 266, col 3, score 1)
- [prom-lib-rate-limiters-and-replay-api#L390|prom-lib-rate-limiters-and-replay-api — L390] (line 390, col 1, score 1)
- [prom-lib-rate-limiters-and-replay-api#L390|prom-lib-rate-limiters-and-replay-api — L390] (line 390, col 3, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L131|Agent Tasks: Persistence Migration to DualStore — L131] (line 131, col 1, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L131|Agent Tasks: Persistence Migration to DualStore — L131] (line 131, col 3, score 1)
- [chroma-toolkit-consolidation-plan#L169|Chroma Toolkit Consolidation Plan — L169] (line 169, col 1, score 1)
- [chroma-toolkit-consolidation-plan#L169|Chroma Toolkit Consolidation Plan — L169] (line 169, col 3, score 1)
- [cross-target-macro-system-in-sibilant#L175|Cross-Target Macro System in Sibilant — L175] (line 175, col 1, score 1)
- [cross-target-macro-system-in-sibilant#L175|Cross-Target Macro System in Sibilant — L175] (line 175, col 3, score 1)
- [dynamic-context-model-for-web-components#L392|Dynamic Context Model for Web Components — L392] (line 392, col 1, score 1)
- [dynamic-context-model-for-web-components#L392|Dynamic Context Model for Web Components — L392] (line 392, col 3, score 1)
- [api-gateway-versioning#L284|api-gateway-versioning — L284] (line 284, col 1, score 1)
- [api-gateway-versioning#L284|api-gateway-versioning — L284] (line 284, col 3, score 1)
- [Debugging Broker Connections and Agent Behavior — L40]debugging-broker-connections-and-agent-behavior.md#L40 (line 40, col 1, score 1)
- [Debugging Broker Connections and Agent Behavior — L40]debugging-broker-connections-and-agent-behavior.md#L40 (line 40, col 3, score 1)
- [dynamic-context-model-for-web-components#L384|Dynamic Context Model for Web Components — L384] (line 384, col 1, score 1)
- [dynamic-context-model-for-web-components#L384|Dynamic Context Model for Web Components — L384] (line 384, col 3, score 1)
- [docs/unique/ecs-offload-workers#L458|ecs-offload-workers — L458] (line 458, col 1, score 1)
- [docs/unique/ecs-offload-workers#L458|ecs-offload-workers — L458] (line 458, col 3, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L133|Agent Tasks: Persistence Migration to DualStore — L133] (line 133, col 1, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L133|Agent Tasks: Persistence Migration to DualStore — L133] (line 133, col 3, score 1)
- [docs/unique/aionian-circuit-math#L151|aionian-circuit-math — L151] (line 151, col 1, score 1)
- [docs/unique/aionian-circuit-math#L151|aionian-circuit-math — L151] (line 151, col 3, score 1)
- [Math Fundamentals — L14]chunks/math-fundamentals.md#L14 (line 14, col 1, score 1)
- [Math Fundamentals — L14]chunks/math-fundamentals.md#L14 (line 14, col 3, score 1)
- [docs/unique/ecs-offload-workers#L460|ecs-offload-workers — L460] (line 460, col 1, score 1)
- [docs/unique/ecs-offload-workers#L460|ecs-offload-workers — L460] (line 460, col 3, score 1)
- [docs/unique/eidolon-field-math-foundations#L159|eidolon-field-math-foundations — L159] (line 159, col 1, score 1)
- [docs/unique/eidolon-field-math-foundations#L159|eidolon-field-math-foundations — L159] (line 159, col 3, score 1)
- [migrate-to-provider-tenant-architecture#L288|Migrate to Provider-Tenant Architecture — L288] (line 288, col 1, score 1)
- [migrate-to-provider-tenant-architecture#L288|Migrate to Provider-Tenant Architecture — L288] (line 288, col 3, score 1)
- [migrate-to-provider-tenant-architecture#L295|Migrate to Provider-Tenant Architecture — L295] (line 295, col 1, score 1)
- [migrate-to-provider-tenant-architecture#L295|Migrate to Provider-Tenant Architecture — L295] (line 295, col 3, score 1)
- [migrate-to-provider-tenant-architecture#L293|Migrate to Provider-Tenant Architecture — L293] (line 293, col 1, score 1)
- [migrate-to-provider-tenant-architecture#L293|Migrate to Provider-Tenant Architecture — L293] (line 293, col 3, score 1)
- [promethean-native-config-design#L403|Promethean-native config design — L403] (line 403, col 1, score 1)
- [promethean-native-config-design#L403|Promethean-native config design — L403] (line 403, col 3, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L143|Agent Tasks: Persistence Migration to DualStore — L143] (line 143, col 1, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L143|Agent Tasks: Persistence Migration to DualStore — L143] (line 143, col 3, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L152|Agent Tasks: Persistence Migration to DualStore — L152] (line 152, col 1, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L152|Agent Tasks: Persistence Migration to DualStore — L152] (line 152, col 3, score 1)
- [Promethean Event Bus MVP v0.1 — L902]promethean-event-bus-mvp-v0-1.md#L902 (line 902, col 1, score 1)
- [Promethean Event Bus MVP v0.1 — L902]promethean-event-bus-mvp-v0-1.md#L902 (line 902, col 3, score 1)
- [promethean-native-config-design#L404|Promethean-native config design — L404] (line 404, col 1, score 1)
- [promethean-native-config-design#L404|Promethean-native config design — L404] (line 404, col 3, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L153|Agent Tasks: Persistence Migration to DualStore — L153] (line 153, col 1, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L153|Agent Tasks: Persistence Migration to DualStore — L153] (line 153, col 3, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L144|Agent Tasks: Persistence Migration to DualStore — L144] (line 144, col 1, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L144|Agent Tasks: Persistence Migration to DualStore — L144] (line 144, col 3, score 1)
- [Promethean Event Bus MVP v0.1 — L903]promethean-event-bus-mvp-v0-1.md#L903 (line 903, col 1, score 1)
- [Promethean Event Bus MVP v0.1 — L903]promethean-event-bus-mvp-v0-1.md#L903 (line 903, col 3, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L145|Agent Tasks: Persistence Migration to DualStore — L145] (line 145, col 1, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L145|Agent Tasks: Persistence Migration to DualStore — L145] (line 145, col 3, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L142|Agent Tasks: Persistence Migration to DualStore — L142] (line 142, col 1, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L142|Agent Tasks: Persistence Migration to DualStore — L142] (line 142, col 3, score 1)
- [chroma-toolkit-consolidation-plan#L179|Chroma Toolkit Consolidation Plan — L179] (line 179, col 1, score 1)
- [chroma-toolkit-consolidation-plan#L179|Chroma Toolkit Consolidation Plan — L179] (line 179, col 3, score 1)
- [promethean-agent-config-dsl#L321|Promethean Agent Config DSL — L321] (line 321, col 1, score 1)
- [promethean-agent-config-dsl#L321|Promethean Agent Config DSL — L321] (line 321, col 3, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L146|Agent Tasks: Persistence Migration to DualStore — L146] (line 146, col 1, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L146|Agent Tasks: Persistence Migration to DualStore — L146] (line 146, col 3, score 1)
- [promethean-agent-config-dsl#L322|Promethean Agent Config DSL — L322] (line 322, col 1, score 1)
- [promethean-agent-config-dsl#L322|Promethean Agent Config DSL — L322] (line 322, col 3, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L141|Agent Tasks: Persistence Migration to DualStore — L141] (line 141, col 1, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L141|Agent Tasks: Persistence Migration to DualStore — L141] (line 141, col 3, score 1)
- [chroma-toolkit-consolidation-plan#L178|Chroma Toolkit Consolidation Plan — L178] (line 178, col 1, score 1)
- [chroma-toolkit-consolidation-plan#L178|Chroma Toolkit Consolidation Plan — L178] (line 178, col 3, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L158|Agent Tasks: Persistence Migration to DualStore — L158] (line 158, col 1, score 0.99)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L158|Agent Tasks: Persistence Migration to DualStore — L158] (line 158, col 3, score 0.99)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L159|Agent Tasks: Persistence Migration to DualStore — L159] (line 159, col 1, score 1)
- [docs/unique/agent-tasks-persistence-migration-to-dualstore#L159|Agent Tasks: Persistence Migration to DualStore — L159] (line 159, col 3, score 1)
- [pure-node-crawl-stack-with-playwright-and-crawlee#L432|Pure-Node Crawl Stack with Playwright and Crawlee — L432] (line 432, col 1, score 1)
- [pure-node-crawl-stack-with-playwright-and-crawlee#L432|Pure-Node Crawl Stack with Playwright and Crawlee — L432] (line 432, col 3, score 1)
- [local-only-llm-workflow#L189|Local-Only-LLM-Workflow — L189] (line 189, col 1, score 0.99)
- [local-only-llm-workflow#L189|Local-Only-LLM-Workflow — L189] (line 189, col 3, score 0.99)
- [shared-package-structure#L174|Shared Package Structure — L174] (line 174, col 1, score 0.99)
- [shared-package-structure#L174|Shared Package Structure — L174] (line 174, col 3, score 0.99)
- [docs/unique/ecs-offload-workers#L476|ecs-offload-workers — L476] (line 476, col 1, score 0.99)
- [docs/unique/ecs-offload-workers#L476|ecs-offload-workers — L476] (line 476, col 3, score 0.99)
<!-- GENERATED-SECTIONS:DO-NOT-EDIT-ABOVE -->
