---
uuid: "2c7e9d46-09b2-4670-a3ac-381cb4f0c21e"
title: "Task 2c7e9d46"
slug: "2025.10.08.15.30.00-fix-kanban-config-resolution"
status: "icebox"
priority: "P1"
labels: ["bug", "cli", "config", "kanban"]
created_at: "2025-10-13T06:32:03.263Z"
estimates:
  complexity: ""
  scale: ""
  time_to_completion: ""
lastCommitSha: "10c74bcdaba8e8e9b62de014a34c9ff90feb31e6"
commitHistory:
  -
    sha: "10c74bcdaba8e8e9b62de014a34c9ff90feb31e6"
    timestamp: "2025-10-24 15:42:45 -0500\n\ndiff --git a/packages/data-stores/src/tests/data-store-manager.test.ts b/packages/data-stores/src/tests/data-store-manager.test.ts\nindex 18e29fd7e..85957a4bc 100644\n--- a/packages/data-stores/src/tests/data-store-manager.test.ts\n+++ b/packages/data-stores/src/tests/data-store-manager.test.ts\n@@ -7,55 +7,166 @@ import {\n   OPENCODE_STORES,\n   FILE_SYSTEM_STORES,\n } from '../index.js';\n+import { ContextStore, __setContextStoreDualFactoryForTests } from '@promethean-os/persistence';\n+import type { DualStoreEntry, DualStoreManager } from '@promethean-os/persistence';\n+\n+type QueryOptions = { limit?: number };\n+\n+const normaliseTimestamp = (value: unknown): number => {\n+  if (value instanceof Date) return value.getTime();\n+  if (typeof value === 'number') return value;\n+  if (typeof value === 'string') return new Date(value).getTime();\n+  return Date.now();\n+};\n+\n+type StoredEntry = DualStoreEntry<'text', 'timestamp'>;\n+\n+class StubDualStore {\n+  readonly name: string;\n+  private readonly textKey: string;\n+  private readonly timeStampKey: string;\n+  private readonly docs: StoredEntry[] = [];\n+  readonly supportsImages = false;\n+  agent_name = 'stub-agent';\n+  embedding_fn = 'stub-embedding';\n+  readonly chromaCollection = {} as unknown;\n+  readonly mongoCollection = {} as unknown;\n+\n+  constructor(name: string, textKey: string, timeStampKey: string) {\n+    this.name = name;\n+    this.textKey = textKey;\n+    this.timeStampKey = timeStampKey;\n+  }\n+\n+  private toStoredEntry(entry: DualStoreEntry<string, string>): StoredEntry {\n+    const rawText = entry[this.textKey as keyof typeof entry];\n+    const text = typeof rawText === 'string' ? rawText : '';\n+    const rawTimestamp = entry[this.timeStampKey as keyof typeof entry];\n+    const timestamp =\n+      rawTimestamp !== undefined ? rawTimestamp : (entry.timestamp as unknown as number"
    message: "Update task: 2c7e9d46-09b2-4670-a3ac-381cb4f0c21e - Update task: Task 2c7e9d46"
    author: "Error"
    type: "update"
---

## Context

The kanban CLI is failing to resolve config paths correctly from subdirectories. Currently it only searches for `promethean.kanban.json` in the directory tree, but should check multiple standard locations:

- `docs/agile/tasks/promethean.kanban.json`
- `docs/agile/promethean.kanban.json`
- `docs/promethean.kanban.json`
- `promethean.kanban.json`

## Problem

The `searchConfigUp()` function in `packages/kanban/src/board/config/sources.ts` only searches for `DEFAULT_CONFIG_BASENAME` ("promethean.kanban.json") in the directory tree. This causes failures when running kanban commands from subdirectories.

Error message: "Failed to load transition rules config: ENOENT"

## Solution

1. Modify `findConfigPath()` function in `sources.ts` to search additional locations
2. Update config resolution logic to try multiple config file locations in priority order
3. Ensure backward compatibility with existing config locations
4. Test config resolution from various subdirectories in the monorepo

## Acceptance Criteria

- [ ] Kanban commands work from any subdirectory in the repository
- [ ] Config files are found in all standard locations
- [ ] Backward compatibility maintained for existing setups
- [ ] Error messages provide clear feedback when config not found
- [ ] Tests cover config resolution from different starting directories

## Technical Details

**Files to modify:**

- `packages/kanban/src/board/config/sources.ts` - Main config path resolution logic
- `packages/kanban/src/board/config/shared.ts` - Update constants if needed

**Key functions:**

- `findConfigPath()` - Needs enhancement for multiple search patterns
- `searchConfigUp()` - Current implementation only searches one basename

**Search priority order:**

1. `docs/agile/tasks/promethean.kanban.json` (task-specific config)
2. `docs/agile/promethean.kanban.json` (agile directory config)
3. `docs/promethean.kanban.json` (docs directory config)
4. `promethean.kanban.json` (repo root config - current behavior)
