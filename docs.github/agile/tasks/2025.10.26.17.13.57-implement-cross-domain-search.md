# Implement Cross-Domain Search

## Overview
Enable search across all indexed content types (files, messages, events, attachments) with unified query interface and result aggregation.

## Context
Current search capabilities are siloed:
- indexer-core: File content search only
- contextStore: Context compilation from specific collections
- Discord indexers: Message/attachment search only
- No unified search across all content types

## Acceptance Criteria
- [ ] Unified search interface across all content types
- [ ] Content type filtering and faceting
- [ ] Relevance ranking across different content types
- [ ] Efficient query processing and result aggregation
- [ ] Search result highlighting and snippets
- [ ] Search analytics and metrics

## Implementation Plan
1. **Phase 1**: Design unified search query model
2. **Phase 2**: Implement cross-storage query execution
3. **Phase 3**: Add result aggregation and ranking
4. **Phase 4**: Implement filtering and faceting
5. **Phase 5**: Add search analytics and optimization

## Technical Details
### Search Query Model
```typescript
interface SearchQuery {
  query: string;
  filters?: {
    contentTypes?: ContentType[];
    sources?: string[];
    dateRange?: { start: Date; end: Date };
    authors?: string[];
    tags?: string[];
  };
  options?: {
    limit?: number;
    offset?: number;
    sortBy?: 'relevance' | 'date' | 'source';
    includeSnippets?: boolean;
    highlightMatches?: boolean;
  };
}

interface SearchResult {
  id: string;
  type: ContentType;
  source: string;
  content: string;
  snippet?: string;
  highlights?: string[];
  score: number;
  metadata: Record<string, any>;
  timestamp: number;
}
```

### Query Execution Strategy
1. **Query Planning**: Analyze query and determine optimal execution plan
2. **Parallel Execution**: Query multiple storage backends concurrently
3. **Result Aggregation**: Combine results from different sources
4. **Relevance Ranking**: Apply unified ranking algorithm
5. **Result Filtering**: Apply post-query filters and faceting

### Storage Backend Integration
- **MongoDB**: Full-text search for documents and metadata
- **ChromaDB**: Vector similarity search for semantic queries
- **Hybrid Search**: Combine text and vector search results
- **Caching**: Cache frequent queries and results

### Performance Optimizations
- Query result caching
- Parallel backend queries
- Result pagination and streaming
- Index optimization for common query patterns
- Search result pre-computation

## Dependencies
- Design unified indexing API (prerequisite)
- Consolidate redundant implementations (prerequisite)

## Risks
- Performance challenges with cross-domain queries
- Complex relevance ranking across content types
- Result consistency and deduplication
- Storage backend performance under load

## Tags
indexing,search,cross-domain,features

## Complexity Score
8 (complex search implementation with multiple backends)

## Status
incoming
