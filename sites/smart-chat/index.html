<>!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>LLM Chat</title>
    <script type="module" src="/components/chat-panel.js"></script>
    <script type="module">
     import { createEventBus, ContextBuilder, filesHttpProvider } from '/lib/context-builder.js';

     const bus = createEventBus();

     // minimal demo data
     const messages = [
         { role:'user', content:'how do we forward tool calls?', ts:Date.now()-5000 },
         { role:'assistant', content:'update backend.chat signature with opts.tools', ts:Date.now()-3000 },
     ];
     const openFiles = [{ path:'services/ts/cephalon/contextManager.ts', cursorLine: 80 }];

     // only files for now; wire RAG/search later
     const files = filesHttpProvider({ baseUrl:'/v1/files' });

     const { chips, blocks, usedTokens } = await ContextBuilder.build({
         messages, openFiles, pins: [], files,
         M:6, K:8, S:3, F:2, ctxBudgetTokens: 6000,
         query: 'tool calling support in codex-context'
     });

     console.log({ chips, blocks, usedTokens });
    </script>

</head>
<body>
<chat-panel endpoint="/v1/chat"></chat-panel>
</body>
</html>

