{
  "pipelines": [
    {
      "name": "codepack",
      "steps": [
        {
          "id": "code-extract",
          "shell": "pnpm --filter @promethean/codepack code:01-extract --roots docs packages --out .cache/codepack/blocks.json --max-context-lines 12\n",
          "inputs": ["docs/**/*.md", "README.md"],
          "inputSchema": "packages/codepack/schemas/io.schema.json",
          "outputs": [".cache/codepack/blocks.json"],
          "outputSchema": "packages/codepack/schemas/io.schema.json"
        },
        {
          "id": "code-embed",
          "deps": ["code-extract"],
          "shell": "pnpm --filter @promethean/codepack code:02-embed --blocks .cache/codepack/blocks.json --cache .cache/codepack/embeds --model nomic-embed-text:latest\n",
          "env": {
            "OLLAMA_URL": "${OLLAMA_URL}"
          },
          "inputs": [".cache/codepack/blocks.json"],
          "inputSchema": "packages/codepack/schemas/io.schema.json",
          "outputs": [".cache/codepack/embeds"],
          "outputSchema": "packages/codepack/schemas/io.schema.json"
        },
        {
          "id": "code-cluster",
          "deps": ["code-embed"],
          "shell": "pnpm --filter @promethean/codepack code:03-cluster --blocks .cache/codepack/blocks.json --cache .cache/codepack/embeds --out .cache/codepack/clusters.json --sim-threshold 0.83 --k 8\n",
          "inputs": [".cache/codepack/embeds", ".cache/codepack/blocks.json"],
          "inputSchema": "packages/codepack/schemas/io.schema.json",
          "outputs": [".cache/codepack/clusters.json"],
          "outputSchema": "packages/codepack/schemas/io.schema.json"
        },
        {
          "id": "code-plan",
          "deps": ["code-cluster"],
          "shell": "pnpm --filter @promethean/codepack code:04-plan --blocks .cache/codepack/blocks.json --clusters .cache/codepack/clusters.json --model qwen3:4b --out .cache/codepack/plan.json\n",
          "env": {
            "OLLAMA_URL": "${OLLAMA_URL}"
          },
          "inputs": [
            ".cache/codepack/blocks.json",
            ".cache/codepack/clusters.json"
          ],
          "inputSchema": "packages/codepack/schemas/io.schema.json",
          "outputs": [".cache/codepack/plan.json"],
          "outputSchema": "packages/codepack/schemas/io.schema.json"
        },
        {
          "id": "code-generate",
          "deps": ["code-plan"],
          "shell": "pnpm --filter @promethean/codepack code:05-generate --plan .cache/codepack/plan.json --base pseudo --overwrite false --readme true\n",
          "inputs": [".cache/codepack/plan.json"],
          "inputSchema": "packages/codepack/schemas/io.schema.json",
          "outputs": ["pseudo/**", ".cache/codepack/generate.touch"],
          "outputSchema": "packages/codepack/schemas/io.schema.json"
        }
      ]
    }
  ]
}
