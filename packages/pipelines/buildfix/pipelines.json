{
  "pipelines": [
    {
      "name": "buildfix",
      "steps": [
        {
          "id": "bf-build",
          "shell": "pnpm --filter @promethean/buildfix build",
          "inputs": [
            "packages/buildfix/tsconfig.json",
            "packages/buildfix/src/**/*"
          ],
          "inputSchema": "packages/buildfix/schemas/io.schema.json",
          "outputs": ["packages/buildfix/dist/**"],
          "outputSchema": "packages/buildfix/schemas/io.schema.json"
        },
        {
          "id": "bf-errors",
          "deps": ["bf-build"],
          "js": {
            "module": "packages/buildfix/dist/01-errors.js",
            "isolate": "worker",
            "args": {
              "tsconfig": "tsconfig.json",
              "out": ".cache/buildfix/errors.json"
            }
          },
          "inputs": [
            "tsconfig.json",
            "packages/**/{src,lib}/**/*.{ts,tsx,js,jsx}"
          ],
          "inputSchema": "packages/buildfix/schemas/io.schema.json",
          "outputs": [".cache/buildfix/errors.json"],
          "outputSchema": "packages/buildfix/schemas/io.schema.json"
        },
        {
          "id": "bf-iterate",
          "deps": ["bf-build", "bf-errors"],
          "js": {
            "module": "packages/buildfix/dist/02-iterate.js",
            "isolate": "worker",
            "args": {
              "errors": ".cache/buildfix/errors.json",
              "out": ".cache/buildfix",
              "model": "qwen3:4b",
              "maxCycles": 5,
              "git": "per-error",
              "commitOn": "always",
              "branchPrefix": "buildfix",
              "remote": "origin",
              "push": false,
              "useGh": false,
              "rollbackOnRegress": true
            }
          },
          "env": {
            "OLLAMA_URL": "${OLLAMA_URL}"
          },
          "inputs": [
            ".cache/buildfix/errors.json",
            "tsconfig.json",
            "packages/**/{src,lib}/**/*.{ts,tsx,js,jsx}"
          ],
          "inputSchema": "packages/buildfix/schemas/io.schema.json",
          "outputs": [
            ".cache/buildfix/summary.json",
            ".cache/buildfix/history/**",
            ".cache/buildfix/snippets/**"
          ],
          "outputSchema": "packages/buildfix/schemas/io.schema.json"
        },
        {
          "id": "bf-report",
          "deps": ["bf-build", "bf-iterate"],
          "js": {
            "module": "packages/buildfix/dist/03-report.js",
            "isolate": "worker",
            "args": {
              "summary": ".cache/buildfix/summary.json",
              "historyRoot": ".cache/buildfix/history",
              "out": "docs/agile/reports/buildfix"
            }
          },
          "inputs": [".cache/buildfix/summary.json"],
          "inputSchema": "packages/buildfix/schemas/io.schema.json",
          "outputs": ["docs/agile/reports/buildfix/*.md"],
          "outputSchema": "packages/buildfix/schemas/io.schema.json"
        }
      ]
    }
  ]
}
