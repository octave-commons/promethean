---
title: "Implement Kanban Assign Command Core Functionality"
status: "incoming"
priority: "P1"
tags: ["kanban", "cli", "agent-management", "opencode", "frontend"]
uuid: "assign-001"
---

## Overview

Implement the core `kanban assign` subcommand that enables assigning agents to tasks using the opencode client SDK. This command will integrate with the existing kanban CLI structure and provide the foundation for agent-task management.

## Description

The assign command will:
- Assign an agent to a specific task based on task status and tags
- Update task frontmatter with assignment metadata (opencode session id)
- Support `--isolate` flag for creating new git worktrees
- Validate agent-task compatibility before assignment
- Integrate with existing kanban command patterns and error handling

## Definition of Done

- [ ] `kanban assign <task-uuid> <agent-name>` command implemented and functional
- [ ] Task frontmatter updated with `assigned_agent` and `session_id` fields
- [ ] Agent compatibility validation based on task status and tags
- [ ] `--isolate` flag creates git worktree using `git worktree add`
- [ ] Proper error handling for invalid tasks, agents, or assignments
- [ ] Integration with existing kanban CLI patterns and help system
- [ ] Comprehensive test coverage for all assignment scenarios
- [ ] Documentation updated with command usage examples

## Subtasks

### 1. Core Assignment Logic
- [ ] Implement agent-task compatibility validation
- [ ] Create opencode session integration
- [ ] Handle task frontmatter updates with assignment metadata
- [ ] Implement assignment status transitions

### 2. Git Worktree Integration
- [ ] Implement `--isolate` flag functionality
- [ ] Create git worktree for isolated agent environments
- [ ] Handle worktree cleanup and management
- [ ] Validate worktree creation success/failure

### 3. Command Interface
- [ ] Add command handler to kanban CLI
- [ ] Implement argument parsing and validation
- [ ] Add help text and usage examples
- [ ] Integrate with existing error handling patterns

### 4. Validation & Error Handling
- [ ] Validate task UUID existence and status
- [ ] Validate agent name and availability
- [ ] Handle opencode session creation failures
- [ ] Provide clear error messages for all failure modes

## Technical Requirements

### Dependencies
- `@promethean/kanban` - existing kanban system
- `@promethean/opencode-session-manager` - opencode client SDK
- Git worktree commands for isolation functionality

### Integration Points
- Extend `packages/kanban/src/cli/command-handlers.ts`
- Add to `COMMAND_HANDLERS` object
- Follow existing command patterns and error handling
- Use existing frontmatter manipulation utilities

### API Design
```bash
# Basic assignment
pnpm kanban assign <task-uuid> <agent-name>

# With isolation
pnpm kanban assign <task-uuid> <agent-name> --isolate

# With custom worktree path
pnpm kanban assign <task-uuid> <agent-name> --isolate --path /custom/path
```

## Context & Resources

### Related Files
- `packages/kanban/src/cli/command-handlers.ts` - command handlers
- `packages/kanban/src/lib/kanban.ts` - core kanban functions
- `packages/opencode-session-manager/src/opencode/client.ts` - opencode SDK
- `promethean.kanban.json` - kanban configuration

### Documentation
- `docs/agile/kanban-cli-reference.md` - CLI documentation
- `AGENTS.md` - agent management patterns

### Similar Implementations
- Existing `update-status` command for status transitions
- Existing `create` command for task creation patterns

## Notes & Considerations

### Assignment Rules
- Only assign agents to tasks in appropriate statuses (ready, todo, in_progress)
- Validate agent compatibility with task tags
- Prevent multiple agents from being assigned to same task
- Handle agent availability checks

### Isolation Requirements
- Git worktree should be named after task UUID or agent name
- Worktree should be created in configurable location
- Clean up worktrees when tasks are completed or unassigned

### Error Scenarios
- Task not found or invalid UUID
- Agent not found or unavailable
- Opencode session creation failure
- Git worktree creation failure
- Task status not eligible for assignment

## Testing Requirements

### Unit Tests
- Agent compatibility validation
- Frontmatter update functionality
- Git worktree creation and cleanup
- Error handling for all failure modes

### Integration Tests
- End-to-end assignment workflow
- Opencode session integration
- Git worktree isolation functionality
- Command line interface validation

### Test Fixtures
- Mock tasks with various statuses and tags
- Mock agent configurations
- Git repository setup for worktree testing

## Blocking Tasks

None - this is a foundational task for the agent management system.

## Tasks This Blocks

- [ ] 2025.10.12.17.01.00-implement-agent-management-commands
- [ ] 2025.10.12.17.02.00-add-task-unassignment-functionality
- [ ] 2025.10.12.17.03.00-implement-agent-status-monitoring

## Success Metrics

- Command successfully assigns agents to eligible tasks
- Task frontmatter correctly updated with assignment metadata
- Git worktrees created successfully when isolation requested
- All error scenarios handled gracefully with clear messages
- Integration tests pass for all assignment workflows